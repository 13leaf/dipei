/*! depei 2013-07-10 */
define(function(require,exports,model){"use strict";var $=require("jquery"),ToolTip=function(){var template=['<div class="tips">','<p node-type="tooltip-content-wrap"></p>','<a href="javascript:void(0);" class="closeWrap" node-type="close-wrap">关闭</a>','<span class="arrow" node-type="arrow"></span>',"</div>"].join(""),Tip=function(cfg){this.config=$.extend({handleElement:null,position:"top",closeAble:!0,width:158,topOff:0,leftOff:0,inner:!1,closeTimer:0,content:"",zIndex:1e6},cfg),this.create().show()};return Tip.prototype={create:function(){var t=this,o=t.config;return t.$wrap=$(template).appendTo(o.inner?o.handleElement:document.body).css("width",o.width),t.$contentWrap=t.$wrap.findNode("tooltip-content-wrap").html(o.content),t.$closeBtn=t.$wrap.findNode("close-wrap"),o.closeAble?t.$closeBtn.click(function(){t.close()}):t.$closeBtn.remove(),this},show:function(){var t=this,o=t.config,$wrap=t.$wrap,wrapH=$wrap.height(),wrapW=$wrap.outerWidth(),$dom=$(o.handleElement),domPos=$dom.offset(),domH=$dom.outerHeight(),domW=$dom.outerWidth(),top=0,left=0,$arrow=$wrap.findNode("arrow"),width="auto"==o.width?wrapW:o.width;switch(o.position){case"top":$arrow.addClass("arrow-t"),top=domH+7+o.topOff,left=Math.max(domW-width-22,-width+10+domW/2)+o.leftOff;break;case"right":$arrow.addClass("arrow-r"),top=Math.min(domH/2-22,0)+o.topOff,left=-wrapW-29+o.leftOff;break;case"left":$arrow.addClass("arrow-l"),top=Math.min(0,domH/2-25)+o.topOff,left=domW+7+o.leftOff;break;case"bottom":$arrow.addClass("arrow-b"),top=-wrapH-18+o.topOff,left=Math.min(0,domW/2-25)+o.leftOff}return o.inner||(top+=domPos.top,left+=domPos.left),$wrap.css({top:Math.ceil(top),left:Math.ceil(left),zIndex:o.zIndex}),this},close:function(){return this.$wrap&&this.$wrap.remove(),this}},Tip}();LP.mix(exports,{createTip:function(cfg){return new Tip(cfg)},btnLoading:function(){},createLoading:function($dom,text){return $dom.html('<span class="i-icon i-loading"></span>'+(text?"<span>"+text+"</span>":"")),{remove:function(){$dom.html("")}}},length:function(str,isByte){if(isByte=void 0===isByte?!0:isByte){var oLength=str.length,tmp=str.replace(/[\u0000-\u0080]/g,"**"),singleLetter=tmp.length-oLength;return singleLetter+2*(oLength-singleLetter)}return str.length},isEmail:function(str){return!!/^[0-9a-zA-Z_][0-9a-zA-Z_.-]*@[0-9a-zA-Z_][0-9a-zA-Z.]+[a-zA-Z]$/.test(str)},tab:function($list,fn,sClass,event){event=event||"click",sClass=sClass||"selected",$list.bind(event,function(){return $list.removeClass(sClass),$(this).addClass(sClass),fn&&fn.call(this,$list.index(this)),!1})},scrollIntoView:function($dom,$scroll){var position=$dom.position(),domHeight=$dom.height(),scrollTop=$scroll.scrollTop(),height=$scroll.parent().height();position.top<=0?$scroll.scrollTop(scrollTop+position.top):position.top+domHeight>=height&&$scroll.scrollTop(position.top-height+scrollTop+domHeight)},loop:function(){},error:function($el){var attr="_e_t_";if(!$el.data(attr)){var colors=["#FFF","#FEE","#FDD","#FCC","#FBB","#FAA","#FBB","#FCC","#FDD","#FEE","#FFF","#FEE","#FDD","#FCC","#FBB","#FAA","#FBB","#FCC","#FDD","#FEE"],runTimer=function(el,index){var cssText=el.style.cssText,_errorTimer=null,_index=0;_errorTimer=setInterval(function(){return _index>=colors.length?(clearInterval(_errorTimer),_errorTimer=null,0==index&&$(el).focus(),el.style.cssText=cssText,$(el).removeData(attr),void 0):(el.style.background=colors[_index],_index++,void 0)},40)};$el.data(attr,1);var off=$el.eq(0).offset(),w_st=$(window).scrollTop(),w_height=$(window).height();off.top<w_st+50||off.top>w_st+w_height?$("html,body").animate({scrollTop:off.top-50},500,"",function(){$el.each(function(index){runTimer(this,index)})}):$el.each(function(index){runTimer(this,index)})}}},!0),!function(){var escape=/["\\\x00-\x1f\x7f-\x9f]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},hasOwn=Object.prototype.hasOwnProperty,stringify="object"==typeof JSON&&JSON.stringify?JSON.stringify:function(o){if(null===o)return"null";var pairs,k,name,val,type=$.type(o);if("undefined"===type)return void 0;if("number"===type||"boolean"===type)return String(o);if("string"===type)return $.quoteString(o);if("function"==typeof o.toJSON)return $.toJSON(o.toJSON());if("date"===type){var month=o.getUTCMonth()+1,day=o.getUTCDate(),year=o.getUTCFullYear(),hours=o.getUTCHours(),minutes=o.getUTCMinutes(),seconds=o.getUTCSeconds(),milli=o.getUTCMilliseconds();return 10>month&&(month="0"+month),10>day&&(day="0"+day),10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),10>seconds&&(seconds="0"+seconds),100>milli&&(milli="0"+milli),10>milli&&(milli="0"+milli),'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"'}if(pairs=[],$.isArray(o)){for(k=0;k<o.length;k++)pairs.push($.toJSON(o[k])||"null");return"["+pairs.join(",")+"]"}if("object"==typeof o){for(k in o)if(hasOwn.call(o,k)){if(type=typeof k,"number"===type)name='"'+k+'"';else{if("string"!==type)continue;name=$.quoteString(k)}type=typeof o[k],"function"!==type&&"undefined"!==type&&(val=$.toJSON(o[k]),pairs.push(name+":"+val))}return"{"+pairs.join(",")+"}"}},parse="object"==typeof JSON&&JSON.parse?JSON.parse:function(str){var filtered=str.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered))return eval("("+str+")");throw new SyntaxError("Error parsing JSON, source is not valid.")};LP.mix(exports,{stringify:stringify,parse:parse},!0)}(),LP.mix(exports,{searchCountry:function($dom,callback){LP.use("autoComplete",function(auto){auto.autoComplete($dom,{availableCssPath:"li",renderData:function(data){var aHtml=["<ul>"],num=10,key=this.key;return $.each(data||[],function(i,v){return i==num?!1:(aHtml.push('<li lid="'+v.id+'">'+[v.name.replace(key,"<em>"+key+"</em>"),'<span class="c999">'+v.parentName+"</span>"].join(" , ")+"</li>"),void 0)}),aHtml.push("</ul>"),aHtml.join("")},onSelect:function($dom,data){$dom.val(data.name),callback&&callback(data)},getData:function(cb){var key=this.key;LP.ajax("countrysug",{k:decodeURIComponent(key)},function(r){cb(r.data)})}})})},searchLoc:function($dom,callback){LP.use("autoComplete",function(auto){auto.autoComplete($dom,{availableCssPath:"li",renderData:function(data){var aHtml=["<ul>"],num=10,key=this.key;return $.each(data||[],function(i,v){return i==num?!1:(aHtml.push('<li lid="'+v.id+'">'+[v.name.replace(key,"<em>"+key+"</em>"),'<span class="c999">'+v.parentName+"</span>"].join(" , ")+"</li>"),void 0)}),aHtml.push("</ul>"),aHtml.join("")},onSelect:function($dom,data){$dom.val(data.name),callback&&callback(data)},getData:function(cb){var key=this.key;LP.ajax("locsug",{k:decodeURIComponent(key)},function(r){cb(r.data)})}})})}},!0),LP.mix(exports,{upload:function($dom,cfg){var config=LP.mix({auto:!0,multi:!1,uploadLimit:1,buttonText:_e("请选择图片"),height:20,width:120,removeCompleted:!1,swf:LP.getUrl("js/uploadify/uploadify.swf"),uploader:"/image/upload/",fileTypeExts:"*.gif; *.jpg; *.jpeg; *.png; *.bmp;",fileSizeLimit:"1024KB",onUploadSuccess:function(file,data){var msg=$.parseJSON(data);msg.err?LP.error(msg.msg):cfg.onSuccess&&cfg.onSuccess(msg.data)},onClearQueue:function(){},onCancel:function(){}},cfg,!0);LP.use(["uploadify"],function(){$($dom).uploadify(config)})}},!0),!function(){var _is_complex_password=function(str){var n=str.length;if(6>n)return!1;for(var cc=0,c_step=0,i=0;n>i;++i)str.charCodeAt(i)==str.charCodeAt(0)&&++cc,i>0&&str.charCodeAt(i)==str.charCodeAt(i-1)+1&&++c_step;return cc==n||c_step==n-1?!1:!0},_num={l:0,L:0,N:0,S:0,lv:.3,Lv:.3,Nv:.3,Sv:1.5},_score=function(value){var score=0;if(_num.l=_num.L=_num.N=_num.S=0,value.length<6||!_is_complex_password(value))return score;value.replace(/./g,function($1){$1>="a"&&"z">=$1?_num.l++:$1>="A"&&"Z">=$1?_num.L++:$1>="0"&&"9">=$1?_num.N++:_num.S++});var val=0;return _num.l>0&&(score+=_num.l*_num.lv,val++),_num.L>0&&(score+=_num.L*_num.Lv,val++),_num.N>0&&(score+=_num.N*_num.Nv,val++),_num.S>0&&(score+=_num.S*_num.Sv+2,val++),score+=val-1,Math.min(~~score/10,1)};LP.mix(exports,{passwordStrength:function($input,cb){$input.bind("keyup",function(){cb&&cb(_score(this.value))})}},!0)}()});