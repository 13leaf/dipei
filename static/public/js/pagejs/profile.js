/*! depei 2013-07-06 */
LP.use(["jquery","util"],function($,util){if($("#J_profile-edit").length){$("#J_profile-edit").click(function(){$(this).closest(".p-setting-view").hide().next().fadeIn()}),util.searchCountry($("#J_country-name"),function(data){$('input[name="country"]').val(data.id)}),util.searchLoc($("#J_lid"),function(data){$('input[name="lid"]').val(data.id)});var initAvatarEdit=function(){function updateCoords(c){$("#x").val(c.x),$("#y").val(c.y),$("#w").val(c.w),$("#h").val(c.h)}function updatePreview(c){if(parseInt(c.w)>0){var rx=112/c.w,ry=112/c.h;$("#preview").css({width:Math.round(rx*boundx)+"px",height:Math.round(ry*boundy)+"px",marginLeft:"-"+Math.round(rx*c.x)+"px",marginTop:"-"+Math.round(ry*c.y)+"px"})}var rx=130/c.w,ry=130/c.h;$("#preview2").css({width:Math.round(rx*boundx)+"px",height:Math.round(ry*boundy)+"px",marginLeft:"-"+Math.round(rx*c.x)+"px",marginTop:"-"+Math.round(ry*c.y)+"px"});var rx=200/c.w,ry=200/c.h;$("#preview3").css({width:Math.round(rx*boundx)+"px",height:Math.round(ry*boundy)+"px",marginLeft:"-"+Math.round(rx*c.x)+"px",marginTop:"-"+Math.round(ry*c.y)+"px"})}util.upload($("#J_avatar-upload"),{onSuccess:function(data){$("#img").val(data.url),$("#target").attr("src",LP.getUrl(data.url,"public")),$(".preview").attr("src",LP.getUrl(data.url,"public")),LP.use("jcrop",function(){$("#target").Jcrop({minSize:[50,50],setSelect:[0,0,200,200],onChange:updatePreview,onSelect:updateCoords,aspectRatio:1},function(){var bounds=this.getBounds();boundx=bounds[0],boundy=bounds[1],jcrop_api=this})}),$(".imgchoose").show(1e3),$("#avatar_submit").show(1e3)}});var jcrop_api,boundx,boundy;$avatarForm.submit(function(){var data=$avatarForm.serialize();return LP.ajax("corpimage",data,function(){}),!1}),$("#J_avatar-cancel").click(function(){$avatarForm.hide(),$lastSetting.fadeIn()})},$avatarForm=$("#J_avatar-form"),$lastSetting=null;$("#J_profile-avatar-edit").click(function(){initAvatarEdit&&(initAvatarEdit(),initAvatarEdit=null),$lastSetting=$(".p-setting:visible").hide(),$avatarForm.fadeIn()}),$("#J_profile-form").submit(function(){var data=$(this).serialize();return LP.ajax("saveProfile",data,function(){LP.reload()}),!1}),$("#J_profile-cancel").click(function(){return $(this).closest(".p-setting-edit").hide().prev().fadeIn(),!1})}});