/*! depei 2013-07-11 */
!function(){function getListener(obj,type,force){var allListeners;return type=type.toLowerCase(),(allListeners=obj.__allListeners||force&&(obj.__allListeners={}))&&(allListeners[type]||force&&(allListeners[type]=[]))}function getDomNode(node,start,ltr,startFromChild,fn,guard){var parent,tmpNode=startFromChild&&node[start];for(!tmpNode&&(tmpNode=node[ltr]);!tmpNode&&(parent=(parent||node).parentNode);){if("BODY"==parent.tagName||guard&&!guard(parent))return null;tmpNode=parent[ltr]}return tmpNode&&fn&&!fn(tmpNode)?getDomNode(tmpNode,start,ltr,!1,fn):tmpNode}UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};var baidu=window.baidu||{};window.baidu=baidu,window.UE=baidu.editor={},UE.plugins={},UE.commands={},UE.instants={},UE.I18N={},UE.version="1.2.6.0";var dom=UE.dom={},browser=UE.browser=function(){var agent=navigator.userAgent.toLowerCase(),opera=window.opera,browser={ie:!!window.ActiveXObject,opera:!!opera&&opera.version,webkit:agent.indexOf(" applewebkit/")>-1,mac:agent.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode};browser.gecko="Gecko"==navigator.product&&!browser.webkit&&!browser.opera;var version=0;if(browser.ie&&(version=parseFloat(agent.match(/msie (\d+)/)[1]),browser.ie9Compat=9==document.documentMode,browser.ie8=!!document.documentMode,browser.ie8Compat=8==document.documentMode,browser.ie7Compat=7==version&&!document.documentMode||7==document.documentMode,browser.ie6Compat=7>version||browser.quirks),browser.gecko){var geckoRelease=agent.match(/rv:([\d\.]+)/);geckoRelease&&(geckoRelease=geckoRelease[1].split("."),version=1e4*geckoRelease[0]+100*(geckoRelease[1]||0)+1*(geckoRelease[2]||0))}return/chrome\/(\d+\.\d)/i.test(agent)&&(browser.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(agent)&&!/chrome/i.test(agent)&&(browser.safari=+(RegExp.$1||RegExp.$2)),browser.opera&&(version=parseFloat(opera.version())),browser.webkit&&(version=parseFloat(agent.match(/ applewebkit\/(\d+)/)[1])),browser.version=version,browser.isCompatible=!browser.mobile&&(browser.ie&&version>=6||browser.gecko&&version>=10801||browser.opera&&version>=9.5||browser.air&&version>=1||browser.webkit&&version>=522||!1),browser}(),ie=browser.ie,opera=(browser.webkit,browser.gecko,browser.opera),utils=UE.utils={each:function(obj,iterator,context){if(null!=obj)if(obj.length===+obj.length){for(var i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)===!1)return!1}else for(var key in obj)if(obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj)===!1)return!1},makeInstance:function(obj){var noop=new Function;return noop.prototype=obj,obj=new noop,noop.prototype=null,obj},extend:function(t,s,b){if(s)for(var k in s)b&&t.hasOwnProperty(k)||(t[k]=s[k]);return t},extend2:function(t){for(var a=arguments,i=1;i<a.length;i++){var x=a[i];for(var k in x)t.hasOwnProperty(k)||(t[k]=x[k])}return t},inherits:function(subClass,superClass){var oldP=subClass.prototype,newP=utils.makeInstance(superClass.prototype);return utils.extend(newP,oldP,!0),subClass.prototype=newP,newP.constructor=subClass},bind:function(fn,context){return function(){return fn.apply(context,arguments)}},defer:function(fn,delay,exclusion){var timerID;return function(){exclusion&&clearTimeout(timerID),timerID=setTimeout(fn,delay)}},indexOf:function(array,item,start){var index=-1;return start=this.isNumber(start)?start:0,this.each(array,function(v,i){return i>=start&&v===item?(index=i,!1):void 0}),index},removeItem:function(array,item){for(var i=0,l=array.length;l>i;i++)array[i]===item&&(array.splice(i,1),i--)},trim:function(str){return str.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(list){if(!list)return{};list=utils.isArray(list)?list:list.split(",");for(var ci,i=0,obj={};ci=list[i++];)obj[ci.toUpperCase()]=obj[ci]=1;return obj},unhtml:function(str,reg){return str?str.replace(reg||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(a,b){return b?a:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}):""},html:function(str){return str?str.replace(/&((g|l|quo)t|amp|#39);/g,function(m){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[m]}):""},cssStyleToDomStyle:function(){var test=document.createElement("div").style,cache={"float":void 0!=test.cssFloat?"cssFloat":void 0!=test.styleFloat?"styleFloat":"float"};return function(cssName){return cache[cssName]||(cache[cssName]=cssName.toLowerCase().replace(/-./g,function(match){return match.charAt(1).toUpperCase()}))}}(),loadFile:function(){function getItem(doc,obj){try{for(var ci,i=0;ci=tmpList[i++];)if(ci.doc===doc&&ci.url==(obj.src||obj.href))return ci}catch(e){return null}}var tmpList=[];return function(doc,obj,fn){var item=getItem(doc,obj);if(item)return item.ready?fn&&fn():item.funs.push(fn),void 0;if(tmpList.push({doc:doc,url:obj.src||obj.href,funs:[fn]}),!doc.body){var html=[];for(var p in obj)"tag"!=p&&html.push(p+'="'+obj[p]+'"');return doc.write("<"+obj.tag+" "+html.join(" ")+" ></"+obj.tag+">"),void 0}if(!obj.id||!doc.getElementById(obj.id)){var element=doc.createElement(obj.tag);delete obj.tag;for(var p in obj)element.setAttribute(p,obj[p]);element.onload=element.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(item=getItem(doc,obj),item.funs.length>0){item.ready=1;for(var fi;fi=item.funs.pop();)fi()}element.onload=element.onreadystatechange=null}},element.onerror=function(){throw Error("The load "+(obj.href||obj.src)+" fails,check the url settings of file ueditor.config.js ")},doc.getElementsByTagName("head")[0].appendChild(element)}}}(),isEmptyObject:function(obj){if(null==obj)return!0;if(this.isArray(obj)||this.isString(obj))return 0===obj.length;for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0},fixColor:function(name,value){if(/color/i.test(name)&&/rgba?/.test(value)){var array=value.split(",");if(array.length>3)return"";value="#";for(var color,i=0;color=array[i++];)color=parseInt(color.replace(/[^\d]/gi,""),10).toString(16),value+=1==color.length?"0"+color:color;value=value.toUpperCase()}return value},optCss:function(val){function opt(obj,name){if(!obj)return"";var t=obj.top,b=obj.bottom,l=obj.left,r=obj.right,val="";if(t&&l&&b&&r)val+=";"+name+":"+(t==b&&b==l&&l==r?t:t==b&&l==r?t+" "+l:l==r?t+" "+l+" "+b:t+" "+r+" "+b+" "+l)+";";else for(var p in obj)val+=";"+name+"-"+p+":"+obj[p]+";";return val}var padding,margin;return val=val.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(str,key,name,val){if(1==val.split(" ").length)switch(key){case"padding":return!padding&&(padding={}),padding[name]=val,"";case"margin":return!margin&&(margin={}),margin[name]=val,"";case"border":return"initial"==val?"":str}return str}),val+=opt(padding,"padding")+opt(margin,"margin"),val.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(a,b){return b?b+";;":";"})},clone:function(source,target){var tmp;target=target||{};for(var i in source)source.hasOwnProperty(i)&&(tmp=source[i],"object"==typeof tmp?(target[i]=utils.isArray(tmp)?[]:{},utils.clone(source[i],target[i])):target[i]=tmp);return target},transUnitToPx:function(val){if(!/(pt|cm)/.test(val))return val;var unit;switch(val.replace(/([\d.]+)(\w+)/,function(str,v,u){val=v,unit=u}),unit){case"cm":val=25*parseFloat(val);break;case"pt":val=Math.round(96*parseFloat(val)/72)}return val+(val?"px":"")},domReady:function(){function doReady(doc){doc.isReady=!0;for(var ci;ci=fnArr.pop();ci());}var fnArr=[];return function(onready,win){win=win||window;var doc=win.document;onready&&fnArr.push(onready),"complete"===doc.readyState?doReady(doc):(doc.isReady&&doReady(doc),browser.ie?(function(){if(!doc.isReady){try{doc.documentElement.doScroll("left")}catch(error){return setTimeout(arguments.callee,0),void 0}doReady(doc)}}(),win.attachEvent("onload",function(){doReady(doc)})):(doc.addEventListener("DOMContentLoaded",function(){doc.removeEventListener("DOMContentLoaded",arguments.callee,!1),doReady(doc)},!1),win.addEventListener("load",function(){doReady(doc)},!1)))}}(),cssRule:browser.ie?function(key,style,doc){var indexList,index;doc=doc||document,indexList=doc.indexList?doc.indexList:doc.indexList={};var sheetStyle;if(indexList[key])sheetStyle=doc.styleSheets[indexList[key]];else{if(void 0===style)return"";sheetStyle=doc.createStyleSheet("",index=doc.styleSheets.length),indexList[key]=index}return void 0===style?sheetStyle.cssText:(sheetStyle.cssText=style||"",void 0)}:function(key,style,doc){doc=doc||document;var node,head=doc.getElementsByTagName("head")[0];if(!(node=doc.getElementById(key))){if(void 0===style)return"";node=doc.createElement("style"),node.id=key,head.appendChild(node)}return void 0===style?node.innerHTML:(""!==style?node.innerHTML=style:head.removeChild(node),void 0)},sort:function(array,compareFn){compareFn=compareFn||function(item1,item2){return item1.localeCompare(item2)};for(var i=0,len=array.length;len>i;i++)for(var j=i,length=array.length;length>j;j++)if(compareFn(array[i],array[j])>0){var t=array[i];array[i]=array[j],array[j]=t}return array}};utils.each(["String","Function","Array","Number","RegExp","Object"],function(v){UE.utils["is"+v]=function(obj){return Object.prototype.toString.apply(obj)=="[object "+v+"]"}});var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(types,listener){types=utils.trim(types).split(" ");for(var ti,i=0;ti=types[i++];)getListener(this,ti,!0).push(listener)},removeListener:function(types,listener){types=utils.trim(types).split(" ");for(var ti,i=0;ti=types[i++];)utils.removeItem(getListener(this,ti)||[],listener)},fireEvent:function(){var types=arguments[0];types=utils.trim(types).split(" ");for(var ti,i=0;ti=types[i++];){var r,t,k,listeners=getListener(this,ti);if(listeners)for(k=listeners.length;k--;)if(listeners[k]){if(t=listeners[k].apply(this,arguments),t===!0)return t;void 0!==t&&(r=t)}(t=this["on"+ti.toLowerCase()])&&(r=t.apply(this,arguments))}return r}};var dtd=dom.dtd=function(){function _(s){for(var k in s)s[k.toUpperCase()]=s[k];return s}var X=utils.extend2,A=_({isindex:1,fieldset:1}),B=_({input:1,button:1,select:1,textarea:1,label:1}),C=X(_({a:1}),B),D=X({iframe:1},C),E=_({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),F=_({ins:1,del:1,script:1,style:1}),G=X(_({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),F),H=X(_({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),G),I=X(_({p:1}),H),J=X(_({iframe:1}),H,B),K=_({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),L=X(_({a:0}),J),M=_({tr:1}),N=_({"#":1}),O=X(_({param:1}),K),P=X(_({form:1}),A,D,E,I),Q=_({li:1,ol:1,ul:1}),R=_({style:1,script:1}),S=_({base:1,link:1,meta:1,title:1}),T=X(S,R),U=_({head:1,body:1}),V=_({html:1}),block=_({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),empty=_({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return _({$nonBodyContent:X(V,U,S),$block:block,$inline:L,$inlineWithA:X(_({a:1}),L),$body:X(_({script:1,style:1}),block),$cdata:_({script:1,style:1}),$empty:empty,$nonChild:_({iframe:1,textarea:1}),$listItem:_({dd:1,dt:1,li:1}),$list:_({ul:1,ol:1,dl:1}),$isNotEmpty:_({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:_({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:_({p:1,div:1}),$tableContent:_({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:_({pre:1,script:1,style:1,textarea:1}),html:U,head:T,style:N,script:N,body:P,base:{},link:{},meta:{},title:N,col:{},tr:_({td:1,th:1}),img:{},embed:{},colgroup:_({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:P,td:P,br:{},th:P,center:P,kbd:L,button:X(I,E),basefont:{},h5:L,h4:L,samp:L,h6:L,ol:Q,h1:L,h3:L,option:N,h2:L,form:X(A,D,E,I),select:_({optgroup:1,option:1}),font:L,ins:L,menu:Q,abbr:L,label:L,table:_({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:L,tfoot:M,cite:L,li:P,input:{},iframe:P,strong:L,textarea:N,noframes:P,big:L,small:L,span:_({"#":1,br:1}),hr:L,dt:L,sub:L,optgroup:_({option:1}),param:{},bdo:L,"var":L,div:P,object:O,sup:L,dd:P,strike:L,area:{},dir:Q,map:X(_({area:1,form:1,p:1}),A,F,E),applet:O,dl:_({dt:1,dd:1}),del:L,isindex:{},fieldset:X(_({legend:1}),K),thead:M,ul:Q,acronym:L,b:L,a:X(_({a:1}),J),blockquote:X(_({td:1,tr:1,tbody:1,li:1}),P),caption:L,i:L,u:L,tbody:M,s:L,address:X(D,I),tt:L,legend:L,q:L,pre:X(G,C),p:X(_({a:1}),L),em:L,dfn:L})}(),attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&"6"==browser.version?"﻿":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(nodeA,nodeB){if(nodeA===nodeB)return 0;var node,parentsA=[nodeA],parentsB=[nodeB];for(node=nodeA;node=node.parentNode;){if(node===nodeB)return 10;parentsA.push(node)}for(node=nodeB;node=node.parentNode;){if(node===nodeA)return 20;parentsB.push(node)}if(parentsA.reverse(),parentsB.reverse(),parentsA[0]!==parentsB[0])return 1;for(var i=-1;i++,parentsA[i]===parentsB[i];);for(nodeA=parentsA[i],nodeB=parentsB[i];nodeA=nodeA.nextSibling;)if(nodeA===nodeB)return 4;return 2},getNodeIndex:function(node,ignoreTextNode){for(var preNode=node,i=0;preNode=preNode.previousSibling;)ignoreTextNode&&3==preNode.nodeType?preNode.nodeType!=preNode.nextSibling.nodeType&&i++:i++;return i},inDoc:function(node,doc){return 10==domUtils.getPosition(node,doc)},findParent:function(node,filterFn,includeSelf){if(node&&!domUtils.isBody(node))for(node=includeSelf?node:node.parentNode;node;){if(!filterFn||filterFn(node)||domUtils.isBody(node))return filterFn&&!filterFn(node)&&domUtils.isBody(node)?null:node;node=node.parentNode}return null},findParentByTagName:function(node,tagNames,includeSelf,excludeFn){return tagNames=utils.listToMap(utils.isArray(tagNames)?tagNames:[tagNames]),domUtils.findParent(node,function(node){return tagNames[node.tagName]&&!(excludeFn&&excludeFn(node))},includeSelf)},findParents:function(node,includeSelf,filterFn,closerFirst){for(var parents=includeSelf&&(filterFn&&filterFn(node)||!filterFn)?[node]:[];node=domUtils.findParent(node,filterFn);)parents.push(node);return closerFirst?parents:parents.reverse()},insertAfter:function(node,newNode){return node.parentNode.insertBefore(newNode,node.nextSibling)},remove:function(node,keepChildren){var child,parent=node.parentNode;if(parent){if(keepChildren&&node.hasChildNodes())for(;child=node.firstChild;)parent.insertBefore(child,node);parent.removeChild(node)}return node},getNextDomNode:function(node,startFromChild,filterFn,guard){return getDomNode(node,"firstChild","nextSibling",startFromChild,filterFn,guard)},isBookmarkNode:function(node){return 1==node.nodeType&&node.id&&/^_baidu_bookmark_/i.test(node.id)},getWindow:function(node){var doc=node.ownerDocument||node;return doc.defaultView||doc.parentWindow},getCommonAncestor:function(nodeA,nodeB){if(nodeA===nodeB)return nodeA;for(var parentsA=[nodeA],parentsB=[nodeB],parent=nodeA,i=-1;parent=parent.parentNode;){if(parent===nodeB)return parent;parentsA.push(parent)}for(parent=nodeB;parent=parent.parentNode;){if(parent===nodeA)return parent;parentsB.push(parent)}for(parentsA.reverse(),parentsB.reverse();i++,parentsA[i]===parentsB[i];);return 0==i?null:parentsA[i-1]},clearEmptySibling:function(node,ignoreNext,ignorePre){function clear(next,dir){for(var tmpNode;next&&!domUtils.isBookmarkNode(next)&&(domUtils.isEmptyInlineElement(next)||!new RegExp("[^	\n\r"+domUtils.fillChar+"]").test(next.nodeValue));)tmpNode=next[dir],domUtils.remove(next),next=tmpNode}!ignoreNext&&clear(node.nextSibling,"nextSibling"),!ignorePre&&clear(node.previousSibling,"previousSibling")},split:function(node,offset){var doc=node.ownerDocument;if(browser.ie&&offset==node.nodeValue.length){var next=doc.createTextNode("");return domUtils.insertAfter(node,next)}var retval=node.splitText(offset);if(browser.ie8){var tmpNode=doc.createTextNode("");domUtils.insertAfter(retval,tmpNode),domUtils.remove(tmpNode)}return retval},isWhitespace:function(node){return!new RegExp("[^ 	\n\r"+domUtils.fillChar+"]").test(node.nodeValue)},getXY:function(element){for(var x=0,y=0;element.offsetParent;)y+=element.offsetTop,x+=element.offsetLeft,element=element.offsetParent;return{x:x,y:y}},on:function(element,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k)for(;k--;)if(type=types[k],element.addEventListener)element.addEventListener(type,handler,!1);else{handler._d||(handler._d={els:[]});var key=type+handler.toString(),index=utils.indexOf(handler._d.els,element);handler._d[key]&&-1!=index||(-1==index&&handler._d.els.push(element),handler._d[key]||(handler._d[key]=function(evt){return handler.call(evt.srcElement,evt||window.event)}),element.attachEvent("on"+type,handler._d[key]))}element=null},un:function(element,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k)for(;k--;)if(type=types[k],element.removeEventListener)element.removeEventListener(type,handler,!1);else{var key=type+handler.toString();try{element.detachEvent("on"+type,handler._d?handler._d[key]:handler)}catch(e){}if(handler._d&&handler._d[key]){var index=utils.indexOf(handler._d.els,element);-1!=index&&handler._d.els.splice(index,1),0==handler._d.els.length&&delete handler._d[key]}}},isSameElement:function(nodeA,nodeB){if(nodeA.tagName!=nodeB.tagName)return!1;var thisAttrs=nodeA.attributes,otherAttrs=nodeB.attributes;if(!ie&&thisAttrs.length!=otherAttrs.length)return!1;for(var attrA,attrB,al=0,bl=0,i=0;attrA=thisAttrs[i++];){if("style"==attrA.nodeName){if(attrA.specified&&al++,domUtils.isSameStyle(nodeA,nodeB))continue;return!1}if(ie){if(!attrA.specified)continue;al++,attrB=otherAttrs.getNamedItem(attrA.nodeName)}else attrB=nodeB.attributes[attrA.nodeName];if(!attrB.specified||attrA.nodeValue!=attrB.nodeValue)return!1}if(ie){for(i=0;attrB=otherAttrs[i++];)attrB.specified&&bl++;if(al!=bl)return!1}return!0},isSameStyle:function(nodeA,nodeB){var styleA=nodeA.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),styleB=nodeB.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){if(styleA=nodeA.style,styleB=nodeB.style,styleA.length!=styleB.length)return!1;for(var p in styleA)if(!/^(\d+|csstext)$/i.test(p)&&styleA[p]!=styleB[p])return!1;return!0}if(!styleA||!styleB)return styleA==styleB;if(styleA=styleA.split(";"),styleB=styleB.split(";"),styleA.length!=styleB.length)return!1;for(var ci,i=0;ci=styleA[i++];)if(-1==utils.indexOf(styleB,ci))return!1;return!0},isBlockElm:function(node){return 1==node.nodeType&&(dtd.$block[node.tagName]||styleBlock[domUtils.getComputedStyle(node,"display")])&&!dtd.$nonChild[node.tagName]},isBody:function(node){return node&&1==node.nodeType&&"body"==node.tagName.toLowerCase()},breakParent:function(node,parent){var tmpNode,leftNodes,rightNodes,parentClone=node,clone=node;do{for(parentClone=parentClone.parentNode,leftNodes?(tmpNode=parentClone.cloneNode(!1),tmpNode.appendChild(leftNodes),leftNodes=tmpNode,tmpNode=parentClone.cloneNode(!1),tmpNode.appendChild(rightNodes),rightNodes=tmpNode):(leftNodes=parentClone.cloneNode(!1),rightNodes=leftNodes.cloneNode(!1));tmpNode=clone.previousSibling;)leftNodes.insertBefore(tmpNode,leftNodes.firstChild);for(;tmpNode=clone.nextSibling;)rightNodes.appendChild(tmpNode);clone=parentClone}while(parent!==parentClone);return tmpNode=parent.parentNode,tmpNode.insertBefore(leftNodes,parent),tmpNode.insertBefore(rightNodes,parent),tmpNode.insertBefore(node,rightNodes),domUtils.remove(parent),node},isEmptyInlineElement:function(node){if(1!=node.nodeType||!dtd.$removeEmpty[node.tagName])return 0;for(node=node.firstChild;node;){if(domUtils.isBookmarkNode(node))return 0;if(1==node.nodeType&&!domUtils.isEmptyInlineElement(node)||3==node.nodeType&&!domUtils.isWhitespace(node))return 0;node=node.nextSibling}return 1},trimWhiteTextNode:function(node){function remove(dir){for(var child;(child=node[dir])&&3==child.nodeType&&domUtils.isWhitespace(child);)node.removeChild(child)}remove("firstChild"),remove("lastChild")},mergeChild:function(node,tagName,attrs){for(var ci,list=domUtils.getElementsByTagName(node,node.tagName.toLowerCase()),i=0;ci=list[i++];)if(ci.parentNode&&!domUtils.isBookmarkNode(ci))if("span"!=ci.tagName.toLowerCase())domUtils.isSameElement(node,ci)&&domUtils.remove(ci,!0);else{if(node===ci.parentNode&&(domUtils.trimWhiteTextNode(node),1==node.childNodes.length)){node.style.cssText=ci.style.cssText+";"+node.style.cssText,domUtils.remove(ci,!0);continue}if(ci.style.cssText=node.style.cssText+";"+ci.style.cssText,attrs){var style=attrs.style;if(style){style=style.split(";");for(var s,j=0;s=style[j++];)ci.style[utils.cssStyleToDomStyle(s.split(":")[0])]=s.split(":")[1]}}domUtils.isSameStyle(ci,node)&&domUtils.remove(ci,!0)}},getElementsByTagName:function(node,name,filter){if(filter&&utils.isString(filter)){var className=filter;filter=function(node){return domUtils.hasClass(node,className)}}name=utils.trim(name).replace(/[ ]{2,}/g," ").split(" ");for(var ni,arr=[],n=0;ni=name[n++];)for(var ci,list=node.getElementsByTagName(ni),i=0;ci=list[i++];)(!filter||filter(ci))&&arr.push(ci);return arr},mergeToParent:function(node){for(var parent=node.parentNode;parent&&dtd.$removeEmpty[parent.tagName];){if(parent.tagName==node.tagName||"A"==parent.tagName){if(domUtils.trimWhiteTextNode(parent),"SPAN"==parent.tagName&&!domUtils.isSameStyle(parent,node)||"A"==parent.tagName&&"SPAN"==node.tagName){if(parent.childNodes.length>1||parent!==node.parentNode){node.style.cssText=parent.style.cssText+";"+node.style.cssText,parent=parent.parentNode;continue}parent.style.cssText+=";"+node.style.cssText,"A"==parent.tagName&&(parent.style.textDecoration="underline")}if("A"!=parent.tagName){parent===node.parentNode&&domUtils.remove(node,!0);break}}parent=parent.parentNode}},mergeSibling:function(node,ignorePre,ignoreNext){function merge(rtl,start,node){var next;if((next=node[rtl])&&!domUtils.isBookmarkNode(next)&&1==next.nodeType&&domUtils.isSameElement(node,next)){for(;next.firstChild;)"firstChild"==start?node.insertBefore(next.lastChild,node.firstChild):node.appendChild(next.firstChild);domUtils.remove(next)}}!ignorePre&&merge("previousSibling","firstChild",node),!ignoreNext&&merge("nextSibling","lastChild",node)},unSelectable:ie||browser.opera?function(node){node.onselectstart=function(){return!1},node.onclick=node.onkeyup=node.onkeydown=function(){return!1},node.unselectable="on",node.setAttribute("unselectable","on");for(var ci,i=0;ci=node.all[i++];)switch(ci.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:ci.unselectable="on",node.setAttribute("unselectable","on")}}:function(node){node.style.MozUserSelect=node.style.webkitUserSelect=node.style.KhtmlUserSelect="none"},removeAttributes:function(node,attrNames){attrNames=utils.isArray(attrNames)?attrNames:utils.trim(attrNames).replace(/[ ]{2,}/g," ").split(" ");for(var ci,i=0;ci=attrNames[i++];){switch(ci=attrFix[ci]||ci){case"className":node[ci]="";break;case"style":node.style.cssText="",!browser.ie&&node.removeAttributeNode(node.getAttributeNode("style"))}node.removeAttribute(ci)}},createElement:function(doc,tag,attrs){return domUtils.setAttributes(doc.createElement(tag),attrs)},setAttributes:function(node,attrs){for(var attr in attrs)if(attrs.hasOwnProperty(attr)){var value=attrs[attr];switch(attr){case"class":node.className=value;break;case"style":node.style.cssText=node.style.cssText+";"+value;break;case"innerHTML":node[attr]=value;break;case"value":node.value=value;break;default:node.setAttribute(attrFix[attr]||attr,value)}}return node},getComputedStyle:function(element,styleName){var pros="width height top left";if(pros.indexOf(styleName)>-1)return element["offset"+styleName.replace(/^\w/,function(s){return s.toUpperCase()})]+"px";if(3==element.nodeType&&(element=element.parentNode),browser.ie&&browser.version<9&&"font-size"==styleName&&!element.style.fontSize&&!dtd.$empty[element.tagName]&&!dtd.$nonChild[element.tagName]){var span=element.ownerDocument.createElement("span");span.style.cssText="padding:0;border:0;font-family:simsun;",span.innerHTML=".",element.appendChild(span);var result=span.offsetHeight;return element.removeChild(span),span=null,result+"px"}try{var value=domUtils.getStyle(element,styleName)||(window.getComputedStyle?domUtils.getWindow(element).getComputedStyle(element,"").getPropertyValue(styleName):(element.currentStyle||element.style)[utils.cssStyleToDomStyle(styleName)])}catch(e){return""}return utils.transUnitToPx(utils.fixColor(styleName,value))},removeClasses:function(elm,classNames){classNames=utils.isArray(classNames)?classNames:utils.trim(classNames).replace(/[ ]{2,}/g," ").split(" ");for(var ci,i=0,cls=elm.className;ci=classNames[i++];)cls=cls.replace(new RegExp("\\b"+ci+"\\b"),"");cls=utils.trim(cls).replace(/[ ]{2,}/g," "),cls?elm.className=cls:domUtils.removeAttributes(elm,["class"])},addClass:function(elm,classNames){if(elm){classNames=utils.trim(classNames).replace(/[ ]{2,}/g," ").split(" ");for(var ci,i=0,cls=elm.className;ci=classNames[i++];)new RegExp("\\b"+ci+"\\b").test(cls)||(elm.className+=" "+ci)}},hasClass:function(element,className){if(utils.isRegExp(className))return className.test(element.className);className=utils.trim(className).replace(/[ ]{2,}/g," ").split(" ");for(var ci,i=0,cls=element.className;ci=className[i++];)if(!new RegExp("\\b"+ci+"\\b","i").test(cls))return!1;return i-1==className.length},preventDefault:function(evt){evt.preventDefault?evt.preventDefault():evt.returnValue=!1},removeStyle:function(element,name){browser.ie?element.style.cssText=element.style.cssText.replace(new RegExp(name+"[^:]*:[^;]+;?","ig"),""):element.style.removeProperty?element.style.removeProperty(name):element.style.removeAttribute(utils.cssStyleToDomStyle(name)),element.style.cssText||domUtils.removeAttributes(element,["style"])},getStyle:function(element,name){var value=element.style[utils.cssStyleToDomStyle(name)];return utils.fixColor(name,value)},setStyle:function(element,name,value){element.style[utils.cssStyleToDomStyle(name)]=value,utils.trim(element.style.cssText)||this.removeAttributes(element,"style")},setStyles:function(element,styles){for(var name in styles)styles.hasOwnProperty(name)&&domUtils.setStyle(element,name,styles[name])},removeDirtyAttr:function(node){for(var ci,i=0,nodes=node.getElementsByTagName("*");ci=nodes[i++];)ci.removeAttribute("_moz_dirty");node.removeAttribute("_moz_dirty")},getChildCount:function(node,fn){var count=0,first=node.firstChild;for(fn=fn||function(){return 1};first;)fn(first)&&count++,first=first.nextSibling;return count},isEmptyNode:function(node){return!node.firstChild||0==domUtils.getChildCount(node,function(node){return!domUtils.isBr(node)&&!domUtils.isBookmarkNode(node)&&!domUtils.isWhitespace(node)})},clearSelectedArr:function(nodes){for(var node;node=nodes.pop();)domUtils.removeAttributes(node,["class"])},scrollToView:function(node,win,offsetTop){var getViewPaneSize=function(){var doc=win.document,mode="CSS1Compat"==doc.compatMode;return{width:(mode?doc.documentElement.clientWidth:doc.body.clientWidth)||0,height:(mode?doc.documentElement.clientHeight:doc.body.clientHeight)||0}},getScrollPosition=function(win){if("pageXOffset"in win)return{x:win.pageXOffset||0,y:win.pageYOffset||0};var doc=win.document;return{x:doc.documentElement.scrollLeft||doc.body.scrollLeft||0,y:doc.documentElement.scrollTop||doc.body.scrollTop||0}},winHeight=getViewPaneSize().height,offset=-1*winHeight+offsetTop;offset+=node.offsetHeight||0;var elementPosition=domUtils.getXY(node);offset+=elementPosition.y;var currentScroll=getScrollPosition(win).y;(offset>currentScroll||currentScroll-winHeight>offset)&&win.scrollTo(0,offset+(0>offset?-20:20))},isBr:function(node){return 1==node.nodeType&&"BR"==node.tagName},isFillChar:function(node,isInStart){return 3==node.nodeType&&!node.nodeValue.replace(new RegExp((isInStart?"^":"")+domUtils.fillChar),"").length},isStartInblock:function(range){var tmp,tmpRange=range.cloneRange(),flag=0,start=tmpRange.startContainer;if(1==start.nodeType&&start.childNodes[tmpRange.startOffset]){start=start.childNodes[tmpRange.startOffset];for(var pre=start.previousSibling;pre&&domUtils.isFillChar(pre);)start=pre,pre=pre.previousSibling}for(this.isFillChar(start,!0)&&1==tmpRange.startOffset&&(tmpRange.setStartBefore(start),start=tmpRange.startContainer);start&&domUtils.isFillChar(start);)tmp=start,start=start.previousSibling;for(tmp&&(tmpRange.setStartBefore(tmp),start=tmpRange.startContainer),1==start.nodeType&&domUtils.isEmptyNode(start)&&1==tmpRange.startOffset&&tmpRange.setStart(start,0).collapse(!0);!tmpRange.startOffset;){if(start=tmpRange.startContainer,domUtils.isBlockElm(start)||domUtils.isBody(start)){flag=1;break}var tmpNode,pre=tmpRange.startContainer.previousSibling;if(pre){for(;pre&&domUtils.isFillChar(pre);)tmpNode=pre,pre=pre.previousSibling;tmpNode?tmpRange.setStartBefore(tmpNode):tmpRange.setStartBefore(tmpRange.startContainer)}else tmpRange.setStartBefore(tmpRange.startContainer)}return flag&&!domUtils.isBody(tmpRange.startContainer)?1:0},isEmptyBlock:function(node,reg){if(reg=reg||new RegExp("[ 	\r\n"+domUtils.fillChar+"]","g"),node[browser.ie?"innerText":"textContent"].replace(reg,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(node.getElementsByTagName(n).length)return 0;return 1},setViewportOffset:function(element,offset){var left=0|parseInt(element.style.left),top=0|parseInt(element.style.top),rect=element.getBoundingClientRect(),offsetLeft=offset.left-rect.left,offsetTop=offset.top-rect.top;offsetLeft&&(element.style.left=left+offsetLeft+"px"),offsetTop&&(element.style.top=top+offsetTop+"px")},fillNode:function(doc,node){var tmpNode=browser.ie?doc.createTextNode(domUtils.fillChar):doc.createElement("br");node.innerHTML="",node.appendChild(tmpNode)},moveChild:function(src,tag,dir){for(;src.firstChild;)dir&&tag.firstChild?tag.insertBefore(src.lastChild,tag.firstChild):tag.appendChild(src.firstChild)},hasNoAttributes:function(node){return browser.ie?/^<\w+\s*?>/.test(node.outerHTML):0==node.attributes.length},isCustomeNode:function(node){return 1==node.nodeType&&node.getAttribute("_ue_custom_node_")},isTagNode:function(node,tagName){return 1==node.nodeType&&new RegExp(node.tagName,"i").test(tagName)},filterNodeList:function(nodelist,filter,forAll){var results=[];if(!utils.isFunction(filter)){var str=filter;
filter=function(n){return-1!=utils.indexOf(utils.isArray(str)?str:str.split(" "),n.tagName.toLowerCase())}}return utils.each(nodelist,function(n){filter(n)&&results.push(n)}),0==results.length?null:1!=results.length&&forAll?results:results[0]},isInNodeEndBoundary:function(rng,node){var start=rng.startContainer;if(3==start.nodeType&&rng.startOffset!=start.nodeValue.length)return 0;if(1==start.nodeType&&rng.startOffset!=start.childNodes.length)return 0;for(;start!==node;){if(start.nextSibling)return 0;start=start.parentNode}return 1},isBoundaryNode:function(node,dir){for(var tmp;!domUtils.isBody(node);)if(tmp=node,node=node.parentNode,tmp!==node[dir])return!1;return!0}},fillCharReg=new RegExp(domUtils.fillChar,"g");!function(){function updateCollapse(range){range.collapsed=range.startContainer&&range.endContainer&&range.startContainer===range.endContainer&&range.startOffset==range.endOffset}function selectOneNode(rng){return!rng.collapsed&&1==rng.startContainer.nodeType&&rng.startContainer===rng.endContainer&&1==rng.endOffset-rng.startOffset}function setEndPoint(toStart,node,offset,range){return 1==node.nodeType&&(dtd.$empty[node.tagName]||dtd.$nonChild[node.tagName])&&(offset=domUtils.getNodeIndex(node)+(toStart?0:1),node=node.parentNode),toStart?(range.startContainer=node,range.startOffset=offset,range.endContainer||range.collapse(!0)):(range.endContainer=node,range.endOffset=offset,range.startContainer||range.collapse(!1)),updateCollapse(range),range}function execContentsAction(range,action){var tmpStart,tmpEnd,start=range.startContainer,end=range.endContainer,startOffset=range.startOffset,endOffset=range.endOffset,doc=range.document,frag=doc.createDocumentFragment();if(1==start.nodeType&&(start=start.childNodes[startOffset]||(tmpStart=start.appendChild(doc.createTextNode("")))),1==end.nodeType&&(end=end.childNodes[endOffset]||(tmpEnd=end.appendChild(doc.createTextNode("")))),start===end&&3==start.nodeType)return frag.appendChild(doc.createTextNode(start.substringData(startOffset,endOffset-startOffset))),action&&(start.deleteData(startOffset,endOffset-startOffset),range.collapse(!0)),frag;for(var current,currentLevel,clone=frag,startParents=domUtils.findParents(start,!0),endParents=domUtils.findParents(end,!0),i=0;startParents[i]==endParents[i];)i++;for(var si,j=i;si=startParents[j];j++){for(current=si.nextSibling,si==start?tmpStart||(3==range.startContainer.nodeType?(clone.appendChild(doc.createTextNode(start.nodeValue.slice(startOffset))),action&&start.deleteData(startOffset,start.nodeValue.length-startOffset)):clone.appendChild(action?start:start.cloneNode(!0))):(currentLevel=si.cloneNode(!1),clone.appendChild(currentLevel));current&&current!==end&&current!==endParents[j];)si=current.nextSibling,clone.appendChild(action?current:current.cloneNode(!0)),current=si;clone=currentLevel}clone=frag,startParents[i]||(clone.appendChild(startParents[i-1].cloneNode(!1)),clone=clone.firstChild);for(var ei,j=i;ei=endParents[j];j++){if(current=ei.previousSibling,ei==end?tmpEnd||3!=range.endContainer.nodeType||(clone.appendChild(doc.createTextNode(end.substringData(0,endOffset))),action&&end.deleteData(0,endOffset)):(currentLevel=ei.cloneNode(!1),clone.appendChild(currentLevel)),j!=i||!startParents[i])for(;current&&current!==start;)ei=current.previousSibling,clone.insertBefore(action?current:current.cloneNode(!0),clone.firstChild),current=ei;clone=currentLevel}return action&&range.setStartBefore(endParents[i]?startParents[i]?endParents[i]:startParents[i-1]:endParents[i-1]).collapse(!0),tmpStart&&domUtils.remove(tmpStart),tmpEnd&&domUtils.remove(tmpEnd),frag}function removeFillData(doc,excludeNode){try{if(fillData&&domUtils.inDoc(fillData,doc))if(fillData.nodeValue.replace(fillCharReg,"").length)fillData.nodeValue=fillData.nodeValue.replace(fillCharReg,"");else{var tmpNode=fillData.parentNode;for(domUtils.remove(fillData);tmpNode&&domUtils.isEmptyInlineElement(tmpNode)&&(browser.safari?!(domUtils.getPosition(tmpNode,excludeNode)&domUtils.POSITION_CONTAINS):!tmpNode.contains(excludeNode));)fillData=tmpNode.parentNode,domUtils.remove(tmpNode),tmpNode=fillData}}catch(e){}}function mergeSibling(node,dir){var tmpNode;for(node=node[dir];node&&domUtils.isFillChar(node);)tmpNode=node[dir],domUtils.remove(node),node=tmpNode}var fillData,guid=0,fillChar=domUtils.fillChar,Range=dom.Range=function(document){var me=this;me.startContainer=me.startOffset=me.endContainer=me.endOffset=null,me.document=document,me.collapsed=!0};Range.prototype={cloneContents:function(){return this.collapsed?null:execContentsAction(this,0)},deleteContents:function(){var txt;return this.collapsed||execContentsAction(this,1),browser.webkit&&(txt=this.startContainer,3!=txt.nodeType||txt.nodeValue.length||(this.setStartBefore(txt).collapse(!0),domUtils.remove(txt))),this},extractContents:function(){return this.collapsed?null:execContentsAction(this,2)},setStart:function(node,offset){return setEndPoint(!0,node,offset,this)},setEnd:function(node,offset){return setEndPoint(!1,node,offset,this)},setStartAfter:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node)+1)},setStartBefore:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node))},setEndAfter:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node)+1)},setEndBefore:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node))},setStartAtFirst:function(node){return this.setStart(node,0)},setStartAtLast:function(node){return this.setStart(node,3==node.nodeType?node.nodeValue.length:node.childNodes.length)},setEndAtFirst:function(node){return this.setEnd(node,0)},setEndAtLast:function(node){return this.setEnd(node,3==node.nodeType?node.nodeValue.length:node.childNodes.length)},selectNode:function(node){return this.setStartBefore(node).setEndAfter(node)},selectNodeContents:function(node){return this.setStart(node,0).setEndAtLast(node)},cloneRange:function(){var me=this;return new Range(me.document).setStart(me.startContainer,me.startOffset).setEnd(me.endContainer,me.endOffset)},collapse:function(toStart){var me=this;return toStart?(me.endContainer=me.startContainer,me.endOffset=me.startOffset):(me.startContainer=me.endContainer,me.startOffset=me.endOffset),me.collapsed=!0,me},shrinkBoundary:function(ignoreEnd){function check(node){return 1==node.nodeType&&!domUtils.isBookmarkNode(node)&&!dtd.$empty[node.tagName]&&!dtd.$nonChild[node.tagName]}for(var child,me=this,collapsed=me.collapsed;1==me.startContainer.nodeType&&(child=me.startContainer.childNodes[me.startOffset])&&check(child);)me.setStart(child,0);if(collapsed)return me.collapse(!0);if(!ignoreEnd)for(;1==me.endContainer.nodeType&&me.endOffset>0&&(child=me.endContainer.childNodes[me.endOffset-1])&&check(child);)me.setEnd(child,child.childNodes.length);return me},getCommonAncestor:function(includeSelf,ignoreTextNode){var me=this,start=me.startContainer,end=me.endContainer;return start===end?includeSelf&&selectOneNode(this)&&(start=start.childNodes[me.startOffset],1==start.nodeType)?start:ignoreTextNode&&3==start.nodeType?start.parentNode:start:domUtils.getCommonAncestor(start,end)},trimBoundary:function(ignoreEnd){this.txtToElmBoundary();var start=this.startContainer,offset=this.startOffset,collapsed=this.collapsed,end=this.endContainer;if(3==start.nodeType){if(0==offset)this.setStartBefore(start);else if(offset>=start.nodeValue.length)this.setStartAfter(start);else{var textNode=domUtils.split(start,offset);start===end?this.setEnd(textNode,this.endOffset-offset):start.parentNode===end&&(this.endOffset+=1),this.setStartBefore(textNode)}if(collapsed)return this.collapse(!0)}return ignoreEnd||(offset=this.endOffset,end=this.endContainer,3==end.nodeType&&(0==offset?this.setEndBefore(end):(offset<end.nodeValue.length&&domUtils.split(end,offset),this.setEndAfter(end)))),this},txtToElmBoundary:function(){function adjust(r,c){var container=r[c+"Container"],offset=r[c+"Offset"];3==container.nodeType&&(offset?offset>=container.nodeValue.length&&r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase()})+"After"](container):r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase()})+"Before"](container))}return this.collapsed||(adjust(this,"start"),adjust(this,"end")),this},insertNode:function(node){var first=node,length=1;11==node.nodeType&&(first=node.firstChild,length=node.childNodes.length),this.trimBoundary(!0);var start=this.startContainer,offset=this.startOffset,nextNode=start.childNodes[offset];return nextNode?start.insertBefore(node,nextNode):start.appendChild(node),first.parentNode===this.endContainer&&(this.endOffset=this.endOffset+length),this.setStartBefore(first)},setCursor:function(toEnd,noFillData){return this.collapse(!toEnd).select(noFillData)},createBookmark:function(serialize,same){var endNode,startNode=this.document.createElement("span");return startNode.style.cssText="display:none;line-height:0px;",startNode.appendChild(this.document.createTextNode("‍")),startNode.id="_baidu_bookmark_start_"+(same?"":guid++),this.collapsed||(endNode=startNode.cloneNode(!0),endNode.id="_baidu_bookmark_end_"+(same?"":guid++)),this.insertNode(startNode),endNode&&this.collapse().insertNode(endNode).setEndBefore(endNode),this.setStartAfter(startNode),{start:serialize?startNode.id:startNode,end:endNode?serialize?endNode.id:endNode:null,id:serialize}},moveToBookmark:function(bookmark){var start=bookmark.id?this.document.getElementById(bookmark.start):bookmark.start,end=bookmark.end&&bookmark.id?this.document.getElementById(bookmark.end):bookmark.end;return this.setStartBefore(start),domUtils.remove(start),end?(this.setEndBefore(end),domUtils.remove(end)):this.collapse(!0),this},enlarge:function(toBlock,stopFn){var pre,node,isBody=domUtils.isBody,tmp=this.document.createTextNode("");if(toBlock){for(node=this.startContainer,1==node.nodeType?node.childNodes[this.startOffset]?pre=node=node.childNodes[this.startOffset]:(node.appendChild(tmp),pre=node=tmp):pre=node;;){if(domUtils.isBlockElm(node)){for(node=pre;(pre=node.previousSibling)&&!domUtils.isBlockElm(pre);)node=pre;this.setStartBefore(node);break}pre=node,node=node.parentNode}for(node=this.endContainer,1==node.nodeType?((pre=node.childNodes[this.endOffset])?node.insertBefore(tmp,pre):node.appendChild(tmp),pre=node=tmp):pre=node;;){if(domUtils.isBlockElm(node)){for(node=pre;(pre=node.nextSibling)&&!domUtils.isBlockElm(pre);)node=pre;this.setEndAfter(node);break}pre=node,node=node.parentNode}tmp.parentNode===this.endContainer&&this.endOffset--,domUtils.remove(tmp)}if(!this.collapsed){for(;!(0!=this.startOffset||stopFn&&stopFn(this.startContainer)||isBody(this.startContainer));)this.setStartBefore(this.startContainer);for(;!(this.endOffset!=(1==this.endContainer.nodeType?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)||stopFn&&stopFn(this.endContainer)||isBody(this.endContainer));)this.setEndAfter(this.endContainer)}return this},adjustmentBoundary:function(){if(!this.collapsed){for(;!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length&&this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length;)this.setStartAfter(this.startContainer);for(;!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[3==this.endContainer.nodeType?"nodeValue":"childNodes"].length;)this.setEndBefore(this.endContainer)}return this},applyInlineStyle:function(tagName,attrs,list){if(this.collapsed)return this;this.trimBoundary().enlarge(!1,function(node){return 1==node.nodeType&&domUtils.isBlockElm(node)}).adjustmentBoundary();for(var node,pre,bookmark=this.createBookmark(),end=bookmark.end,filterFn=function(node){return 1==node.nodeType?"br"!=node.tagName.toLowerCase():!domUtils.isWhitespace(node)},current=domUtils.getNextDomNode(bookmark.start,!1,filterFn),range=this.cloneRange();current&&domUtils.getPosition(current,end)&domUtils.POSITION_PRECEDING;)if(3==current.nodeType||dtd[tagName][current.tagName]){for(range.setStartBefore(current),node=current;node&&(3==node.nodeType||dtd[tagName][node.tagName])&&node!==end;)pre=node,node=domUtils.getNextDomNode(node,1==node.nodeType,null,function(parent){return dtd[tagName][parent.tagName]});var elm,frag=range.setEndAfter(pre).extractContents();if(list&&list.length>0){var level,top;top=level=list[0].cloneNode(!1);for(var ci,i=1;ci=list[i++];)level.appendChild(ci.cloneNode(!1)),level=level.firstChild;elm=level}else elm=range.document.createElement(tagName);attrs&&domUtils.setAttributes(elm,attrs),elm.appendChild(frag),range.insertNode(list?top:elm);var aNode;if("span"==tagName&&attrs.style&&/text\-decoration/.test(attrs.style)&&(aNode=domUtils.findParentByTagName(elm,"a",!0))?(domUtils.setAttributes(aNode,attrs),domUtils.remove(elm,!0),elm=aNode):(domUtils.mergeSibling(elm),domUtils.clearEmptySibling(elm)),domUtils.mergeChild(elm,attrs),current=domUtils.getNextDomNode(elm,!1,filterFn),domUtils.mergeToParent(elm),node===end)break}else current=domUtils.getNextDomNode(current,!0,filterFn);return this.moveToBookmark(bookmark)},removeInlineStyle:function(tagNames){if(this.collapsed)return this;tagNames=utils.isArray(tagNames)?tagNames:[tagNames],this.shrinkBoundary().adjustmentBoundary();for(var start=this.startContainer,end=this.endContainer;;){if(1==start.nodeType){if(utils.indexOf(tagNames,start.tagName.toLowerCase())>-1)break;if("body"==start.tagName.toLowerCase()){start=null;break}}start=start.parentNode}for(;;){if(1==end.nodeType){if(utils.indexOf(tagNames,end.tagName.toLowerCase())>-1)break;if("body"==end.tagName.toLowerCase()){end=null;break}}end=end.parentNode}var frag,tmpRange,bookmark=this.createBookmark();start&&(tmpRange=this.cloneRange().setEndBefore(bookmark.start).setStartBefore(start),frag=tmpRange.extractContents(),tmpRange.insertNode(frag),domUtils.clearEmptySibling(start,!0),start.parentNode.insertBefore(bookmark.start,start)),end&&(tmpRange=this.cloneRange().setStartAfter(bookmark.end).setEndAfter(end),frag=tmpRange.extractContents(),tmpRange.insertNode(frag),domUtils.clearEmptySibling(end,!1,!0),end.parentNode.insertBefore(bookmark.end,end.nextSibling));for(var next,current=domUtils.getNextDomNode(bookmark.start,!1,function(node){return 1==node.nodeType});current&&current!==bookmark.end;)next=domUtils.getNextDomNode(current,!0,function(node){return 1==node.nodeType}),utils.indexOf(tagNames,current.tagName.toLowerCase())>-1&&domUtils.remove(current,!0),current=next;return this.moveToBookmark(bookmark)},getClosedNode:function(){var node;if(!this.collapsed){var range=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(selectOneNode(range)){var child=range.startContainer.childNodes[range.startOffset];child&&1==child.nodeType&&(dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName])&&(node=child)}}return node},select:browser.ie?function(noFillData,textRange){var nativeRange;this.collapsed||this.shrinkBoundary();var node=this.getClosedNode();if(node&&!textRange){try{nativeRange=this.document.body.createControlRange(),nativeRange.addElement(node),nativeRange.select()}catch(e){}return this}var end,bookmark=this.createBookmark(),start=bookmark.start;if(nativeRange=this.document.body.createTextRange(),nativeRange.moveToElementText(start),nativeRange.moveStart("character",1),this.collapsed){if(!noFillData&&3!=this.startContainer.nodeType){var tmpText=this.document.createTextNode(fillChar),tmp=this.document.createElement("span");tmp.appendChild(this.document.createTextNode(fillChar)),start.parentNode.insertBefore(tmp,start),start.parentNode.insertBefore(tmpText,start),removeFillData(this.document,tmpText),fillData=tmpText,mergeSibling(tmp,"previousSibling"),mergeSibling(start,"nextSibling"),nativeRange.moveStart("character",-1),nativeRange.collapse(!0)}}else{var nativeRangeEnd=this.document.body.createTextRange();end=bookmark.end,nativeRangeEnd.moveToElementText(end),nativeRange.setEndPoint("EndToEnd",nativeRangeEnd)}this.moveToBookmark(bookmark),tmp&&domUtils.remove(tmp);try{nativeRange.select()}catch(e){}return this}:function(notInsertFillData){function checkOffset(rng){function check(node,offset,dir){3==node.nodeType&&node.nodeValue.length<offset&&(rng[dir+"Offset"]=node.nodeValue.length)}check(rng.startContainer,rng.startOffset,"start"),check(rng.endContainer,rng.endOffset,"end")}var txtNode,win=domUtils.getWindow(this.document),sel=win.getSelection();if(browser.gecko?this.document.body.focus():win.focus(),sel){if(sel.removeAllRanges(),this.collapsed&&!notInsertFillData){var start=this.startContainer,child=start;1==start.nodeType&&(child=start.childNodes[this.startOffset]),3==start.nodeType&&this.startOffset||(child?child.previousSibling&&3==child.previousSibling.nodeType:start.lastChild&&3==start.lastChild.nodeType)||(txtNode=this.document.createTextNode(fillChar),this.insertNode(txtNode),removeFillData(this.document,txtNode),mergeSibling(txtNode,"previousSibling"),mergeSibling(txtNode,"nextSibling"),fillData=txtNode,this.setStart(txtNode,browser.webkit?1:0).collapse(!0))}var nativeRange=this.document.createRange();if(this.collapsed&&browser.opera&&1==this.startContainer.nodeType){var child=this.startContainer.childNodes[this.startOffset];if(child){for(;child&&domUtils.isBlockElm(child)&&1==child.nodeType&&child.childNodes[0];)child=child.childNodes[0];child&&this.setStartBefore(child).collapse(!0)}else child=this.startContainer.lastChild,child&&domUtils.isBr(child)&&this.setStartBefore(child).collapse(!0)}checkOffset(this),nativeRange.setStart(this.startContainer,this.startOffset),nativeRange.setEnd(this.endContainer,this.endOffset),sel.addRange(nativeRange)}return this},scrollToView:function(win,offset){win=win?window:domUtils.getWindow(this.document);var me=this,span=me.document.createElement("span");return span.innerHTML="&nbsp;",me.cloneRange().insertNode(span),domUtils.scrollToView(span,win,offset),domUtils.remove(span),me},inFillChar:function(){var start=this.startContainer;return this.collapsed&&3==start.nodeType&&start.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==start.nodeValue.length?!0:!1},createAddress:function(ignoreEnd,ignoreTxt){function getAddress(isStart){for(var ci,node=isStart?me.startContainer:me.endContainer,parents=domUtils.findParents(node,!0,function(node){return!domUtils.isBody(node)}),addrs=[],i=0;ci=parents[i++];)addrs.push(domUtils.getNodeIndex(ci,ignoreTxt));var firstIndex=0;if(ignoreTxt)if(3==node.nodeType){for(var tmpNode=node.previousSibling;tmpNode&&3==tmpNode.nodeType;)firstIndex+=tmpNode.nodeValue.replace(fillCharReg,"").length,tmpNode=tmpNode.previousSibling;firstIndex+=isStart?me.startOffset:me.endOffset}else if(node=node.childNodes[isStart?me.startOffset:me.endOffset])firstIndex=domUtils.getNodeIndex(node,ignoreTxt);else{node=isStart?me.startContainer:me.endContainer;for(var first=node.firstChild;first;)if(domUtils.isFillChar(first))first=first.nextSibling;else if(firstIndex++,3==first.nodeType)for(;first&&3==first.nodeType;)first=first.nextSibling;else first=first.nextSibling}else firstIndex=isStart?domUtils.isFillChar(node)?0:me.startOffset:me.endOffset;return 0>firstIndex&&(firstIndex=0),addrs.push(firstIndex),addrs}var addr={},me=this;return addr.startAddress=getAddress(!0),ignoreEnd||(addr.endAddress=me.collapsed?[].concat(addr.startAddress):getAddress()),addr},moveToAddress:function(addr,ignoreEnd){function getNode(address,isStart){for(var parentNode,offset,ci,tmpNode=me.document.body,i=0,l=address.length;l>i;i++)if(ci=address[i],parentNode=tmpNode,tmpNode=tmpNode.childNodes[ci],!tmpNode){offset=ci;break}isStart?tmpNode?me.setStartBefore(tmpNode):me.setStart(parentNode,offset):tmpNode?me.setEndBefore(tmpNode):me.setEnd(parentNode,offset)}var me=this;return getNode(addr.startAddress,!0),!ignoreEnd&&addr.endAddress&&getNode(addr.endAddress),me},equals:function(rng){for(var p in this)if(this.hasOwnProperty(p)&&this[p]!==rng[p])return!1;return!0},traversal:function(doFn,filterFn){if(this.collapsed)return this;for(var bookmark=this.createBookmark(),end=bookmark.end,current=domUtils.getNextDomNode(bookmark.start,!1,filterFn);current&&current!==end&&domUtils.getPosition(current,end)&domUtils.POSITION_PRECEDING;){var tmpNode=domUtils.getNextDomNode(current,!1,filterFn);doFn(current),current=tmpNode}return this.moveToBookmark(bookmark)}}}(),function(){function getBoundaryInformation(range,start){var getIndex=domUtils.getNodeIndex;range=range.duplicate(),range.collapse(start);var parent=range.parentElement();if(!parent.hasChildNodes())return{container:parent,offset:0};for(var child,distance,siblings=parent.children,testRange=range.duplicate(),startIndex=0,endIndex=siblings.length-1,index=-1;endIndex>=startIndex;){index=Math.floor((startIndex+endIndex)/2),child=siblings[index],testRange.moveToElementText(child);var position=testRange.compareEndPoints("StartToStart",range);if(position>0)endIndex=index-1;else{if(!(0>position))return{container:parent,offset:getIndex(child)};startIndex=index+1}}if(-1==index){if(testRange.moveToElementText(parent),testRange.setEndPoint("StartToStart",range),distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length,siblings=parent.childNodes,!distance)return child=siblings[siblings.length-1],{container:child,offset:child.nodeValue.length};for(var i=siblings.length;distance>0;)distance-=siblings[--i].nodeValue.length;return{container:siblings[i],offset:-distance}}if(testRange.collapse(position>0),testRange.setEndPoint(position>0?"StartToStart":"EndToStart",range),distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length,!distance)return dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName]?{container:parent,offset:getIndex(child)+(position>0?0:1)}:{container:child,offset:position>0?0:child.childNodes.length};for(;distance>0;)try{var pre=child;child=child[position>0?"previousSibling":"nextSibling"],distance-=child.nodeValue.length}catch(e){return{container:parent,offset:getIndex(pre)}}return{container:child,offset:position>0?-distance:child.nodeValue.length+distance}}function transformIERangeToRange(ieRange,range){if(ieRange.item)range.selectNode(ieRange.item(0));else{var bi=getBoundaryInformation(ieRange,!0);range.setStart(bi.container,bi.offset),0!=ieRange.compareEndPoints("StartToEnd",ieRange)&&(bi=getBoundaryInformation(ieRange,!1),range.setEnd(bi.container,bi.offset))}return range}function _getIERange(sel){var ieRange;try{ieRange=sel.getNative().createRange()}catch(e){return null}var el=ieRange.item?ieRange.item(0):ieRange.parentElement();return(el.ownerDocument||el)===sel.document?ieRange:null}var Selection=dom.Selection=function(doc){var iframe,me=this;me.document=doc,ie&&(iframe=domUtils.getWindow(doc).frameElement,domUtils.on(iframe,"beforedeactivate",function(){me._bakIERange=me.getIERange()}),domUtils.on(iframe,"activate",function(){try{!_getIERange(me)&&me._bakIERange&&me._bakIERange.select()}catch(ex){}me._bakIERange=null})),iframe=doc=null};Selection.prototype={getNative:function(){var doc=this.document;try{return doc?ie?doc.selection:domUtils.getWindow(doc).getSelection():null}catch(e){return null}},getIERange:function(){var ieRange=_getIERange(this);return!ieRange&&this._bakIERange?this._bakIERange:ieRange},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var start=this.getStart();return start?domUtils.findParents(start,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){try{return browser.ie&&_getIERange(this)||!browser.ie&&this.getNative().rangeCount?!0:!1}catch(e){return!1}},getRange:function(){function optimze(range){for(var child=me.document.body.firstChild,collapsed=range.collapsed;child&&child.firstChild;)range.setStart(child,0),child=child.firstChild;range.startContainer||range.setStart(me.document.body,0),collapsed&&range.collapse(!0)}var me=this;if(null!=me._cachedRange)return this._cachedRange;var range=new baidu.editor.dom.Range(me.document);if(ie){var nativeRange=me.getIERange();if(nativeRange)try{transformIERangeToRange(nativeRange,range)}catch(e){optimze(range)}else optimze(range)}else{var sel=me.getNative();if(sel&&sel.rangeCount){var firstRange=sel.getRangeAt(0),lastRange=sel.getRangeAt(sel.rangeCount-1);range.setStart(firstRange.startContainer,firstRange.startOffset).setEnd(lastRange.endContainer,lastRange.endOffset),range.collapsed&&domUtils.isBody(range.startContainer)&&!range.startOffset&&optimze(range)}else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document))return this._bakRange;optimze(range)}}return this._bakRange=range},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var tmpRange,start,tmp,parent,range=ie?this.getIERange():this.getRange();if(ie){if(!range)return this.document.body.firstChild;if(range.item)return range.item(0);for(tmpRange=range.duplicate(),tmpRange.text.length>0&&tmpRange.moveStart("character",1),tmpRange.collapse(1),start=tmpRange.parentElement(),parent=tmp=range.parentElement();tmp=tmp.parentNode;)if(tmp==start){start=parent;break}}else if(range.shrinkBoundary(),start=range.startContainer,1==start.nodeType&&start.hasChildNodes()&&(start=start.childNodes[Math.min(start.childNodes.length-1,range.startOffset)]),3==start.nodeType)return start.parentNode;return start},getText:function(){var nativeSel,nativeRange;return this.isFocus()&&(nativeSel=this.getNative())?(nativeRange=browser.ie?nativeSel.createRange():nativeSel.getRangeAt(0),browser.ie?nativeRange.text:nativeRange.toString()):""},clearRange:function(){this.getNative()[browser.ie?"empty":"removeAllRanges"]()}}}(),function(){function setValue(form,editor){var textarea;if(editor.textarea)if(utils.isString(editor.textarea)){for(var ti,i=0,tis=domUtils.getElementsByTagName(form,"textarea");ti=tis[i++];)if(ti.id=="ueditor_textarea_"+editor.options.textarea){textarea=ti;break}}else textarea=editor.textarea;textarea||(form.appendChild(textarea=domUtils.createElement(document,"textarea",{name:editor.options.textarea,id:"ueditor_textarea_"+editor.options.textarea,style:"display:none"})),editor.textarea=textarea),textarea.value=editor.hasContents()?editor.options.allHtmlEnabled?editor.getAllHtml():editor.getContent(null,null,!0):""}var _selectionChangeTimer,uid=0,Editor=UE.Editor=function(options){var me=this;me.uid=uid++,EventBase.call(me),me.commands={},me.options=utils.extend(utils.clone(options||{}),UEDITOR_CONFIG,!0),me.shortcutkeys={},me.inputRules=[],me.outputRules=[],me.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,iframeCssUrl:me.options.UEDITOR_HOME_URL+"themes/iframe.css",textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,imagePopup:!0,enterTag:"p",customDomain:!1,lang:"zh-cn",langPath:me.options.UEDITOR_HOME_URL+"lang/",theme:"default",themePath:me.options.UEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,scaleEnabled:!1,tableNativeEditInFF:!1,autoSyncData:!0}),utils.loadFile(document,{src:me.options.langPath+me.options.lang+"/"+me.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){for(var pi in UE.plugins)UE.plugins[pi].call(me);me.langIsReady=!0,me.fireEvent("langReady")}),UE.instants["ueditorInstant"+me.uid]=me};Editor.prototype={ready:function(fn){var me=this;fn&&(me.isReady?fn.apply(me):me.addListener("ready",fn))},setOpt:function(key,val){var obj={};utils.isString(key)?obj[key]=val:obj=key,utils.extend(this.options,obj,!0)},destroy:function(){var me=this;me.fireEvent("destroy");var container=me.container.parentNode,textarea=me.textarea;textarea?textarea.style.display="":(textarea=document.createElement("textarea"),container.parentNode.insertBefore(textarea,container)),textarea.style.width=me.iframe.offsetWidth+"px",textarea.style.height=me.iframe.offsetHeight+"px",textarea.value=me.getContent(),textarea.id=me.key,container.innerHTML="",domUtils.remove(container);var key=me.key;for(var p in me)me.hasOwnProperty(p)&&delete this[p];UE.delEditor(key)},render:function(container){var me=this,options=me.options;if(utils.isString(container)&&(container=document.getElementById(container)),container){var useBodyAsViewport=ie&&browser.version<9,html=(ie&&browser.version<9?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml'"+(useBodyAsViewport?"":" class='view'")+"><head>"+(options.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(options.iframeCssUrl)+"'/>":"")+"<style type='text/css'>"+".view{padding:0;word-wrap:break-word;cursor:text;height:100%;}\n"+"body{margin:8px;font-family:sans-serif;font-size:16px;}"+"p{margin:5px 0;}"+(options.initialStyle||"")+"</style></head><body"+(useBodyAsViewport?" class='view'":"")+"></body>";if(options.customDomain&&document.domain!=location.hostname)html+="<script>window.parent.UE.instants['ueditorInstant"+me.uid+"']._setup(document);</script></html>",container.appendChild(domUtils.createElement(document,"iframe",{id:"ueditor_"+me.uid,width:"100%",height:"100%",frameborder:"0",src:'javascript:void(function(){document.open();document.domain="'+document.domain+'";'+'document.write("'+html+'");document.close();}())'}));else{options.minFrameWidth=options.initialFrameWidth?options.initialFrameWidth:options.initialFrameWidth=container.offsetWidth,options.initialFrameHeight?options.minFrameHeight=options.initialFrameHeight:options.initialFrameHeight=options.minFrameHeight=container.offsetHeight,container.style.width=options.initialFrameWidth+"px",container.style.height=options.initialFrameHeight+"px",container.style.zIndex=options.zIndex,container.innerHTML='<iframe id="ueditor_'+this.uid+'"'+'width="100%" height="100%" scroll="no" frameborder="0" ></iframe>';var doc=container.firstChild.contentWindow.document;doc.open(),doc.write(html+"</html>"),doc.close(),me._setup(doc)}container.style.overflow="hidden"}},_setup:function(doc){var me=this,options=me.options;ie?(doc.body.disabled=!0,doc.body.contentEditable=!0,doc.body.disabled=!1):(doc.body.contentEditable=!0,doc.body.spellcheck=!1),me.document=doc,me.window=doc.defaultView||doc.parentWindow,me.iframe=me.window.frameElement,me.body=doc.body,me.selection=new dom.Selection(doc);var geckoSel;browser.gecko&&(geckoSel=this.selection.getNative())&&geckoSel.removeAllRanges(),this._initEvents();for(var form=this.iframe.parentNode;!domUtils.isBody(form);form=form.parentNode)if("FORM"==form.tagName){me.form=form,me.options.autoSyncData?domUtils.on(me.window,"blur",function(){setValue(form,me)}):domUtils.on(form,"submit",function(){setValue(this,me)});break}if(options.initialContent)if(options.autoClearinitialContent){var oldExecCommand=me.execCommand;me.execCommand=function(){return me.fireEvent("firstBeforeExecCommand"),oldExecCommand.apply(me,arguments)},this._setDefaultContent(options.initialContent)}else this.setContent(options.initialContent,!1,!0);domUtils.isEmptyNode(me.body)&&(me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),options.focus&&setTimeout(function(){me.focus(me.options.focusInEnd),!me.options.autoClearinitialContent&&me._selectionChange()},0),me.container||(me.container=this.iframe.parentNode),options.fullscreen&&me.ui&&me.ui.setFullScreen(!0);try{me.document.execCommand("2D-position",!1,!1)}catch(e){}try{me.document.execCommand("enableInlineTableEditing",!1,!1)}catch(e){}try{me.document.execCommand("enableObjectResizing",!1,!1)}catch(e){}me._bindshortcutKeys(),me.isReady=1,me.fireEvent("ready"),options.onready&&options.onready.call(me),browser.ie||domUtils.on(me.window,["blur","focus"],function(e){if("blur"==e.type){me._bakRange=me.selection.getRange();try{me.selection.getNative().removeAllRanges()}catch(e){}}else try{me._bakRange&&me._bakRange.select()}catch(e){}}),browser.gecko&&browser.version<=10902&&(me.body.contentEditable=!1,setTimeout(function(){me.body.contentEditable=!0
},100),setInterval(function(){me.body.style.height=me.iframe.offsetHeight-20+"px"},100)),!options.isShow&&me.setHide(),options.readonly&&me.setDisabled()},sync:function(formId){var me=this,form=formId?document.getElementById(formId):domUtils.findParent(me.iframe.parentNode,function(node){return"FORM"==node.tagName},!0);form&&setValue(form,me)},setHeight:function(height){height!==parseInt(this.iframe.parentNode.style.height)&&(this.iframe.parentNode.style.height=height+"px"),this.document.body.style.height=height-20+"px"},addshortcutkey:function(cmd,keys){var obj={};keys?obj[cmd]=keys:obj=cmd,utils.extend(this.shortcutkeys,obj)},_bindshortcutKeys:function(){var me=this,shortcutkeys=this.shortcutkeys;me.addListener("keydown",function(type,e){var keyCode=e.keyCode||e.which;for(var i in shortcutkeys)for(var ti,tmp=shortcutkeys[i].split(","),t=0;ti=tmp[t++];){ti=ti.split(":");var key=ti[0],param=ti[1];(/^(ctrl)(\+shift)?\+(\d+)$/.test(key.toLowerCase())||/^(\d+)$/.test(key))&&(("ctrl"==RegExp.$1?e.ctrlKey||e.metaKey:0)&&(""!=RegExp.$2?e[RegExp.$2.slice(1)+"Key"]:1)&&keyCode==RegExp.$3||keyCode==RegExp.$1)&&(-1!=me.queryCommandState(i,param)&&me.execCommand(i,param),domUtils.preventDefault(e))}})},getContent:function(cmd,fn,notSetCursor,ignoreBlank,formatter){var me=this;if(cmd&&utils.isFunction(cmd)&&(fn=cmd,cmd=""),fn?!fn():!this.hasContents())return"";me.fireEvent("beforegetcontent");var root=UE.htmlparser(me.body.innerHTML,ignoreBlank);return me.filterOutputRule(root),me.fireEvent("aftergetcontent",cmd),root.toHtml(formatter)},getAllHtml:function(){var me=this,headHtml=[];if(me.fireEvent("getAllHtml",headHtml),browser.ie&&browser.version>8){var headHtmlForIE9="";utils.each(me.document.styleSheets,function(si){headHtmlForIE9+=si.href?'<link rel="stylesheet" type="text/css" href="'+si.href+'" />':"<style>"+si.cssText+"</style>"}),utils.each(me.document.getElementsByTagName("script"),function(si){headHtmlForIE9+=si.outerHTML})}return"<html><head>"+(me.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+me.options.charset+'"/>':"")+(headHtmlForIE9||me.document.getElementsByTagName("head")[0].innerHTML)+headHtml.join("\n")+"</head>"+"<body "+(ie&&browser.version<9?'class="view"':"")+">"+me.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var reg=new RegExp(domUtils.fillChar,"g"),html=this.body.innerHTML.replace(/[\n\r]/g,"");return html=html.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(a,b,c){return dtd.$block[c]?"\n":b?b:""}),html.replace(reg,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var reg=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(reg,"").replace(/\u00a0/g," ")},setContent:function(html,isAppendTo,notFireSelectionchange){function isCdataDiv(node){return"DIV"==node.tagName&&node.getAttribute("cdata_tag")}var me=this;me.fireEvent("beforesetcontent",html);var root=UE.htmlparser(html);if(me.filterInputRule(root),html=root.toHtml(),me.body.innerHTML=(isAppendTo?me.body.innerHTML:"")+html,"p"==me.options.enterTag){var tmpNode,child=this.body.firstChild;if(!child||1==child.nodeType&&(dtd.$cdata[child.tagName]||isCdataDiv(child)||domUtils.isCustomeNode(child))&&child===this.body.lastChild)this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else for(var p=me.document.createElement("p");child;){for(;child&&(3==child.nodeType||1==child.nodeType&&dtd.p[child.tagName]&&!dtd.$cdata[child.tagName]);)tmpNode=child.nextSibling,p.appendChild(child),child=tmpNode;if(p.firstChild){if(!child){me.body.appendChild(p);break}child.parentNode.insertBefore(p,child),p=me.document.createElement("p")}child=child.nextSibling}}me.fireEvent("aftersetcontent"),me.fireEvent("contentchange"),!notFireSelectionchange&&me._selectionChange(),me._bakRange=me._bakIERange=null;var geckoSel;browser.gecko&&(geckoSel=this.selection.getNative())&&geckoSel.removeAllRanges(),me.options.autoSyncData&&me.form&&setValue(me.form,me)},focus:function(toEnd){try{var me=this,rng=me.selection.getRange();toEnd?rng.setStartAtLast(me.body.lastChild).setCursor(!1,!0):rng.select(!0),this.fireEvent("focus")}catch(e){}},_initEvents:function(){var me=this,doc=me.document,win=me.window;me._proxyDomEvent=utils.bind(me._proxyDomEvent,me),domUtils.on(doc,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],me._proxyDomEvent),domUtils.on(win,["focus","blur"],me._proxyDomEvent),domUtils.on(doc,["mouseup","keydown"],function(evt){"keydown"==evt.type&&(evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)||2!=evt.button&&me._selectionChange(250,evt)});var dragoverHandler,innerDrag=0,source=browser.ie?me.body:me.document;domUtils.on(source,"dragstart",function(){innerDrag=1}),domUtils.on(source,browser.webkit?"dragover":"drop",function(){return browser.webkit?function(){clearTimeout(dragoverHandler),dragoverHandler=setTimeout(function(){if(!innerDrag){var sel=me.selection,range=sel.getRange();if(range){var common=range.getCommonAncestor();if(common&&me.serialize){var f=me.serialize,node=f.filter(f.transformInput(f.parseHTML(f.word(common.innerHTML))));common.innerHTML=f.toHTML(node)}}}innerDrag=0},200)}:function(e){innerDrag||(e.preventDefault?e.preventDefault():e.returnValue=!1),innerDrag=0}}())},_proxyDomEvent:function(evt){return this.fireEvent(evt.type.replace(/^on/,""),evt)},_selectionChange:function(delay,evt){var mouseX,mouseY,me=this,hackForMouseUp=!1;if(browser.ie&&browser.version<9&&evt&&"mouseup"==evt.type){var range=this.selection.getRange();range.collapsed||(hackForMouseUp=!0,mouseX=evt.clientX,mouseY=evt.clientY)}clearTimeout(_selectionChangeTimer),_selectionChangeTimer=setTimeout(function(){if(me.selection.getNative()){var ieRange;if(hackForMouseUp&&"None"==me.selection.getNative().type){ieRange=me.document.body.createTextRange();try{ieRange.moveToPoint(mouseX,mouseY)}catch(ex){ieRange=null}}var bakGetIERange;ieRange&&(bakGetIERange=me.selection.getIERange,me.selection.getIERange=function(){return ieRange}),me.selection.cache(),bakGetIERange&&(me.selection.getIERange=bakGetIERange),me.selection._cachedRange&&me.selection._cachedStartElement&&(me.fireEvent("beforeselectionchange"),me.fireEvent("selectionchange",!!evt),me.fireEvent("afterselectionchange"),me.selection.clear())}},delay||50)},_callCmdFn:function(fnName,args){var cmd,cmdFn,cmdName=args[0].toLowerCase();return cmd=this.commands[cmdName]||UE.commands[cmdName],cmdFn=cmd&&cmd[fnName],cmd&&cmdFn||"queryCommandState"!=fnName?cmdFn?cmdFn.apply(this,args):void 0:0},execCommand:function(cmdName){cmdName=cmdName.toLowerCase();var result,me=this,cmd=me.commands[cmdName]||UE.commands[cmdName];return cmd&&cmd.execCommand?(cmd.notNeedUndo||me.__hasEnterExecCommand?(result=this._callCmdFn("execCommand",arguments),!me._ignoreContentChange&&me.fireEvent("contentchange")):(me.__hasEnterExecCommand=!0,-1!=me.queryCommandState.apply(me,arguments)&&(me.fireEvent("beforeexeccommand",cmdName),result=this._callCmdFn("execCommand",arguments),!me._ignoreContentChange&&me.fireEvent("contentchange"),me.fireEvent("afterexeccommand",cmdName)),me.__hasEnterExecCommand=!1),!me._ignoreContentChange&&me._selectionChange(),result):null},queryCommandState:function(){return this._callCmdFn("queryCommandState",arguments)},queryCommandValue:function(){return this._callCmdFn("queryCommandValue",arguments)},hasContents:function(tags){if(tags)for(var ci,i=0;ci=tags[i++];)if(this.document.getElementsByTagName(ci).length>0)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;for(tags=["div"],i=0;ci=tags[i++];)for(var cn,nodes=domUtils.getElementsByTagName(this.document,ci),n=0;cn=nodes[n++];)if(domUtils.isCustomeNode(cn))return!0;return!1},reset:function(){this.fireEvent("reset")},setEnabled:function(){var range,me=this;if("false"==me.body.contentEditable){me.body.contentEditable=!0,range=me.selection.getRange();try{range.moveToBookmark(me.lastBk),delete me.lastBk}catch(e){range.setStartAtFirst(me.body).collapse(!0)}range.select(!0),me.bkqueryCommandState&&(me.queryCommandState=me.bkqueryCommandState,delete me.bkqueryCommandState),me.fireEvent("selectionchange")}},enable:function(){return this.setEnabled()},setDisabled:function(except){var me=this;except=except?utils.isArray(except)?except:[except]:[],"true"==me.body.contentEditable&&(me.lastBk||(me.lastBk=me.selection.getRange().createBookmark(!0)),me.body.contentEditable=!1,me.bkqueryCommandState=me.queryCommandState,me.queryCommandState=function(type){return-1!=utils.indexOf(except,type)?me.bkqueryCommandState.apply(me,arguments):-1},me.fireEvent("selectionchange"))},disable:function(except){return this.setDisabled(except)},_setDefaultContent:function(){function clear(){var me=this;me.document.getElementById("initContent")&&(me.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",me.removeListener("firstBeforeExecCommand focus",clear),setTimeout(function(){me.focus(),me._selectionChange()},0))}return function(cont){var me=this;me.body.innerHTML='<p id="initContent">'+cont+"</p>",me.addListener("firstBeforeExecCommand focus",clear)}}(),setShow:function(){var me=this,range=me.selection.getRange();if("none"==me.container.style.display){try{range.moveToBookmark(me.lastBk),delete me.lastBk}catch(e){range.setStartAtFirst(me.body).collapse(!0)}setTimeout(function(){range.select(!0)},100),me.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var me=this;me.lastBk||(me.lastBk=me.selection.getRange().createBookmark(!0)),me.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(path){var lang=UE.I18N[this.options.lang];if(!lang)throw Error("not import language file");path=(path||"").split(".");for(var ci,i=0;(ci=path[i++])&&(lang=lang[ci],lang););return lang},getContentLength:function(ingoneHtml,tagNames){var count=this.getContent(!1,!1,!0).length;if(ingoneHtml){tagNames=(tagNames||[]).concat(["hr","img","iframe"]),count=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var ci,i=0;ci=tagNames[i++];)count+=this.document.getElementsByTagName(ci).length}return count},addInputRule:function(rule){this.inputRules.push(rule)},filterInputRule:function(root){for(var ci,i=0;ci=this.inputRules[i++];)ci.call(this,root)},addOutputRule:function(rule){this.outputRules.push(rule)},filterOutputRule:function(root){for(var ci,i=0;ci=this.outputRules[i++];)ci.call(this,root)}},utils.inherits(Editor,EventBase)}(),UE.ajax=function(){function json2str(json){var strArr=[];for(var i in json)"method"!=i&&"timeout"!=i&&"async"!=i&&"function"!=(typeof json[i]).toLowerCase()&&"object"!=(typeof json[i]).toLowerCase()&&strArr.push(encodeURIComponent(i)+"="+encodeURIComponent(json[i]));return strArr.join("&")}var fnStr="XMLHttpRequest()";try{new ActiveXObject("Msxml2.XMLHTTP"),fnStr="ActiveXObject('Msxml2.XMLHTTP')"}catch(e){try{new ActiveXObject("Microsoft.XMLHTTP"),fnStr="ActiveXObject('Microsoft.XMLHTTP')"}catch(e){}}var creatAjaxRequest=new Function("return new "+fnStr);return{request:function(url,ajaxOptions){var ajaxRequest=creatAjaxRequest(),timeIsOut=!1,defaultAjaxOptions={method:"POST",timeout:5e3,async:!0,data:{},onsuccess:function(){},onerror:function(){}};if("object"==typeof url&&(ajaxOptions=url,url=ajaxOptions.url),ajaxRequest&&url){var ajaxOpts=ajaxOptions?utils.extend(defaultAjaxOptions,ajaxOptions):defaultAjaxOptions,submitStr=json2str(ajaxOpts);utils.isEmptyObject(ajaxOpts.data)||(submitStr+=(submitStr?"&":"")+json2str(ajaxOpts.data));var timerID=setTimeout(function(){4!=ajaxRequest.readyState&&(timeIsOut=!0,ajaxRequest.abort(),clearTimeout(timerID))},ajaxOpts.timeout),method=ajaxOpts.method.toUpperCase(),str=url+(-1==url.indexOf("?")?"?":"&")+("POST"==method?"":submitStr+"&noCache="+ +new Date);ajaxRequest.open(method,str,ajaxOpts.async),ajaxRequest.onreadystatechange=function(){4==ajaxRequest.readyState&&(timeIsOut||200!=ajaxRequest.status?ajaxOpts.onerror(ajaxRequest):ajaxOpts.onsuccess(ajaxRequest))},"POST"==method?(ajaxRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),ajaxRequest.send(submitStr)):ajaxRequest.send(null)}}}}(),UE.filterWord=function(){function isWordDocument(str){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<v:)/gi.test(str)}function transUnit(v){return v=v.replace(/[\d.]+\w+/g,function(m){return utils.transUnitToPx(m)})}function filterPasteWord(str){return str.replace(/[\t\r\n]+/g,"").replace(/<!--[\s\S]*?-->/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(str){if(browser.opera)return"";try{var width=str.match(/width:([ \d.]*p[tx])/i)[1],height=str.match(/height:([ \d.]*p[tx])/i)[1],src=str.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+transUnit(width)+'" height="'+transUnit(height)+'" src="'+src+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/gi,function(str,name,marks,val){return"class"==name&&"MsoListParagraph"==val?str:""}).replace(/<(font|span)[^>]*>\s*<\/\1>/gi,"").replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(str,tag,tmp,style){for(var v,n=[],s=style.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),i=0;v=s[i];i++){var name,value,parts=v.split(":");if(2==parts.length){if(name=parts[0].toLowerCase(),value=parts[1].toLowerCase(),/^(background)\w*/.test(name)&&0==value.replace(/(initial|\s)/g,"").length||/^(margin)\w*/.test(name)&&/^0\w+$/.test(value))continue;switch(name){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(tag)||(n[i]=name.replace(/^mso-|-alt$/g,"")+":"+transUnit(value));continue;case"horiz-align":n[i]="text-align:"+value;continue;case"vert-align":n[i]="vertical-align:"+value;continue;case"font-color":case"mso-foreground":n[i]="color:"+value;continue;case"mso-background":case"mso-highlight":n[i]="background:"+value;continue;case"mso-default-height":n[i]="min-height:"+transUnit(value);continue;case"mso-default-width":n[i]="min-width:"+transUnit(value);continue;case"mso-padding-between-alt":n[i]="border-collapse:separate;border-spacing:"+transUnit(value);continue;case"text-line-through":("single"==value||"double"==value)&&(n[i]="text-decoration:line-through");continue;case"mso-zero-height":"yes"==value&&(n[i]="display:none");continue;case"background":break;case"margin":if(!/[1-9]/.test(value))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(name)||/text\-indent|padding|margin/.test(name)&&/\-[\d.]+/.test(value))continue;n[i]=name+":"+parts[1]}}return tag+(n.length?' style="'+n.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(str){return utils.transUnitToPx(str)})}return function(html){return isWordDocument(html)?filterPasteWord(html):html}}(),function(){function insertLine(arr,current,begin){return arr.push(breakChar),current+(begin?1:-1)}function insertIndent(arr,current){for(var i=0;current>i;i++)arr.push(indentChar)}function nodeToHtml(node,arr,formatter,current){switch(node.type){case"root":for(var ci,i=0;ci=node.children[i++];)formatter&&"element"==ci.type&&!dtd.$inlineWithA[ci.tagName]&&i>1&&(insertLine(arr,current,!0),insertIndent(arr,current)),nodeToHtml(ci,arr,formatter,current);break;case"text":isText(node,arr);break;case"element":isElement(node,arr,formatter,current);break;case"comment":isComment(node,arr,formatter)}return arr}function isText(node,arr){arr.push("pre"==node.parentNode.tagName?node.data:node.data.replace(/[ ]{2}/g," &nbsp;"))}function isElement(node,arr,formatter,current){var attrhtml="";if(node.attrs){attrhtml=[];var attrs=node.attrs;for(var a in attrs)attrhtml.push(a+(void 0!==attrs[a]?'="'+utils.unhtml(attrs[a])+'"':""));attrhtml=attrhtml.join(" ")}if(arr.push("<"+node.tagName+(attrhtml?" "+attrhtml:"")+(dtd.$empty[node.tagName]?"/":"")+">"),formatter&&!dtd.$inlineWithA[node.tagName]&&"pre"!=node.tagName&&node.children&&node.children.length&&(current=insertLine(arr,current,!0),insertIndent(arr,current)),node.children&&node.children.length)for(var ci,i=0;ci=node.children[i++];)formatter&&"element"==ci.type&&!dtd.$inlineWithA[ci.tagName]&&i>1&&(insertLine(arr,current),insertIndent(arr,current)),nodeToHtml(ci,arr,formatter,current);dtd.$empty[node.tagName]||(formatter&&!dtd.$inlineWithA[node.tagName]&&"pre"!=node.tagName&&node.children&&node.children.length&&(current=insertLine(arr,current),insertIndent(arr,current)),arr.push("</"+node.tagName+">"))}function isComment(node,arr){arr.push("<!--"+node.data+"-->")}function getNodeById(root,id){var node;if("element"==root.type&&root.getAttr("id")==id)return root;if(root.children&&root.children.length)for(var ci,i=0;ci=root.children[i++];)if(node=getNodeById(ci,id))return node}function getNodesByTagName(node,tagName,arr){if("element"==node.type&&node.tagName==tagName&&arr.push(node),node.children&&node.children.length)for(var ci,i=0;ci=node.children[i++];)getNodesByTagName(ci,tagName,arr)}function nodeTraversal(root,fn){if(root.children&&root.children.length)for(var ci,i=0;ci=root.children[i];)nodeTraversal(ci,fn),ci.parentNode&&(ci.children&&ci.children.length&&fn(ci),ci.parentNode&&i++);else fn(root)}var uNode=UE.uNode=function(obj){this.type=obj.type,this.data=obj.data,this.tagName=obj.tagName,this.parentNode=obj.parentNode,this.attrs=obj.attrs||{},this.children=obj.children},indentChar="    ",breakChar="\n";uNode.createElement=function(html){return/[<>]/.test(html)?UE.htmlparser(html).children[0]:new uNode({type:"element",children:[],tagName:html})},uNode.createText=function(data){return new UE.uNode({type:"text",data:utils.unhtml(data||"")})},uNode.prototype={toHtml:function(formatter){var arr=[];return nodeToHtml(this,arr,formatter,0),arr.join("")},innerHTML:function(htmlstr){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(utils.isString(htmlstr)){if(this.children)for(var ci,i=0;ci=this.children[i++];)ci.parentNode=null;this.children=[];for(var ci,tmpRoot=UE.htmlparser(htmlstr),i=0;ci=tmpRoot.children[i++];)this.children.push(ci),ci.parentNode=this;return this}var tmpRoot=new UE.uNode({type:"root",children:this.children});return tmpRoot.toHtml()},innerText:function(textStr){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(textStr){if(this.children)for(var ci,i=0;ci=this.children[i++];)ci.parentNode=null;return this.children=[],this.appendChild(uNode.createText(textStr)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return"element"==this.type?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var ci,parent=this.parentNode,i=0;ci=parent.children[i];i++)if(ci===this)return 0==i?null:parent.children[i-1]},nextSibling:function(){for(var ci,parent=this.parentNode,i=0;ci=parent.children[i++];)if(ci===this)return parent.children[i]},replaceChild:function(target,source){if(this.children){target.parentNode&&target.parentNode.removeChild(target);for(var ci,i=0;ci=this.children[i];i++)if(ci===source)return this.children.splice(i,1,target),source.parentNode=null,target.parentNode=this,target}},appendChild:function(node){if("root"==this.type||"element"==this.type&&!dtd.$empty[this.tagName]){this.children||(this.children=[]),node.parentNode&&node.parentNode.removeChild(node);for(var ci,i=0;ci=this.children[i];i++)if(ci===node){this.children.splice(i,1);break}return this.children.push(node),node.parentNode=this,node}},insertBefore:function(target,source){if(this.children){target.parentNode&&target.parentNode.removeChild(target);for(var ci,i=0;ci=this.children[i];i++)if(ci===source)return this.children.splice(i,0,target),target.parentNode=this,target}},insertAfter:function(target,source){if(this.children){target.parentNode&&target.parentNode.removeChild(target);for(var ci,i=0;ci=this.children[i];i++)if(ci===source)return this.children.splice(i+1,0,target),target.parentNode=this,target}},removeChild:function(node,keepChildren){if(this.children)for(var ci,i=0;ci=this.children[i];i++)if(ci===node){if(this.children.splice(i,1),ci.parentNode=null,keepChildren&&ci.children&&ci.children.length)for(var cj,j=0;cj=ci.children[j];j++)this.children.splice(i+j,0,cj),cj.parentNode=this;return ci}},getAttr:function(attrName){return this.attrs&&this.attrs[attrName.toLowerCase()]},setAttr:function(attrName,attrVal){if(!attrName)return delete this.attrs,void 0;if(this.attrs||(this.attrs={}),utils.isObject(attrName))for(var a in attrName)attrName[a]?this.attrs[a.toLowerCase()]=attrName[a]:delete this.attrs[a];else attrVal?this.attrs[attrName.toLowerCase()]=attrVal:delete this.attrs[attrName]},getIndex:function(){for(var ci,parent=this.parentNode,i=0;ci=parent.children[i];i++)if(ci===this)return i;return-1},getNodeById:function(id){var node;if(this.children&&this.children.length)for(var ci,i=0;ci=this.children[i++];)if(node=getNodeById(ci,id))return node},getNodesByTagName:function(tagNames){tagNames=utils.trim(tagNames).replace(/[ ]{2,}/g," ").split(" ");var arr=[],me=this;return utils.each(tagNames,function(tagName){if(me.children&&me.children.length)for(var ci,i=0;ci=me.children[i++];)getNodesByTagName(ci,tagName,arr)}),arr},getStyle:function(name){var cssStyle=this.getAttr("style");if(!cssStyle)return"";var reg=new RegExp(name+":([^;]+)","i"),match=cssStyle.match(reg);return match&&match[0]?match[1]:""},setStyle:function(name,val){function exec(name,val){var reg=new RegExp(name+":([^;]+;?)","gi");cssStyle=cssStyle.replace(reg,""),val&&(cssStyle=name+":"+utils.unhtml(val)+";"+cssStyle)}var cssStyle=this.getAttr("style");if(cssStyle||(cssStyle=""),utils.isObject(name))for(var a in name)exec(a,name[a]);else exec(name,val);this.setAttr("style",cssStyle)},traversal:function(fn){return this.children&&this.children.length&&nodeTraversal(this,fn),this}}}(),UE.htmlparser=function(htmlstr,ignoreBlank){function text(parent,data){if(needChild[parent.tagName]){var tmpNode=uNode.createElement(needChild[parent.tagName]);parent.appendChild(tmpNode),tmpNode.appendChild(uNode.createText(data)),parent=tmpNode}else parent.appendChild(uNode.createText(data))}function element(parent,tagName,htmlattr){var needParentTag;if(needParentTag=needParentNode[tagName]){for(var hasParent,tmpParent=parent;"root"!=tmpParent.type;){if(utils.isArray(needParentTag)?-1!=utils.indexOf(needParentTag,tmpParent.tagName):needParentTag==tmpParent.tagName){parent=tmpParent,hasParent=!0;break}tmpParent=tmpParent.parentNode}hasParent||(parent=element(parent,utils.isArray(needParentTag)?needParentTag[0]:needParentTag))}var elm=new uNode({parentNode:parent,type:"element",tagName:tagName.toLowerCase(),children:dtd.$empty[tagName]?null:[]});if(htmlattr){for(var match,attrs={};match=re_attr.exec(htmlattr);)attrs[match[1].toLowerCase()]=utils.unhtml(match[2]||match[3]||match[4]);elm.attrs=attrs}return parent.children.push(elm),dtd.$empty[tagName]?parent:elm}function comment(parent,data){parent.children.push(new uNode({type:"comment",data:data,parentNode:parent}))}var re_tag=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,re_attr=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,allowEmptyTags={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};htmlstr=htmlstr.replace(new RegExp(domUtils.fillChar,"g"),""),ignoreBlank||(htmlstr=htmlstr.replace(new RegExp("[\\r\\t\\n"+(ignoreBlank?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(ignoreBlank?"":" ")+"]*","g"),function(a,b){return b&&allowEmptyTags[b.toLowerCase()]?a.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):a.replace(new RegExp("^[\\r\\n"+(ignoreBlank?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(ignoreBlank?"":" ")+"]+$"),"")}));for(var match,uNode=UE.uNode,needParentNode={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},needChild={ol:"li",ul:"li"},currentIndex=0,nextIndex=0,root=new uNode({type:"root",children:[]}),currentParent=root;match=re_tag.exec(htmlstr);){currentIndex=match.index;try{if(currentIndex>nextIndex&&text(currentParent,htmlstr.slice(nextIndex,currentIndex)),match[3])currentParent=element(currentParent,match[3].toLowerCase(),match[4]);else if(match[1]){if("root"!=currentParent.type){for(var tmpParent=currentParent;"element"==currentParent.type&&currentParent.tagName!=match[1].toLowerCase();)if(currentParent=currentParent.parentNode,"root"==currentParent.type)throw currentParent=tmpParent,"break";currentParent=currentParent.parentNode}}else match[2]&&comment(currentParent,match[2])}catch(e){}nextIndex=re_tag.lastIndex}return nextIndex<htmlstr.length&&text(currentParent,htmlstr.slice(nextIndex)),root},UE.filterNode=function(){function filterNode(node,rules){switch(node.type){case"text":break;case"element":var val;if(val=rules[node.tagName])if("-"===val)node.parentNode.removeChild(node);else if(utils.isFunction(val)){var parentNode=node.parentNode,index=node.getIndex();if(val(node),node.parentNode){if(node.children)for(var ci,i=0;ci=node.children[i];)filterNode(ci,rules),ci.parentNode&&i++}else for(var ci,i=index;ci=parentNode.children[i];)filterNode(ci,rules),ci.parentNode&&i++}else{var attrs=val.$;if(attrs&&node.attrs){var tmpVal,tmpAttrs={};for(var a in attrs){if(tmpVal=node.getAttr(a),"style"==a&&utils.isArray(attrs[a])){var tmpCssStyle=[];utils.each(attrs[a],function(v){var tmp;(tmp=node.getStyle(v))&&tmpCssStyle.push(v+":"+tmp)}),tmpVal=tmpCssStyle.join(";")}tmpVal&&(tmpAttrs[a]=tmpVal)}node.attrs=tmpAttrs}if(node.children)for(var ci,i=0;ci=node.children[i];)filterNode(ci,rules),ci.parentNode&&i++}else if(dtd.$cdata[node.tagName])node.parentNode.removeChild(node);else{var parentNode=node.parentNode,index=node.getIndex();node.parentNode.removeChild(node,!0);for(var ci,i=index;ci=parentNode.children[i];)filterNode(ci,rules),ci.parentNode&&i++}break;case"comment":node.parentNode.removeChild(node)}}return function(root,rules){if(utils.isEmptyObject(rules))return root;var val;(val=rules["-"])&&utils.each(val.split(" "),function(k){rules[k]="-"});for(var ci,i=0;ci=root.children[i];)filterNode(ci,rules),ci.parentNode&&i++;return root}}(),UE.commands.inserthtml={execCommand:function(command,html,notNeedFilter){var range,div,me=this;if(html&&me.fireEvent("beforeinserthtml",html)!==!0){if(range=me.selection.getRange(),div=range.document.createElement("div"),div.style.display="inline",!notNeedFilter){var root=UE.htmlparser(html);me.options.filterRules&&UE.filterNode(root,me.options.filterRules),me.filterInputRule(root),html=root.toHtml()}if(div.innerHTML=utils.trim(html),!range.collapsed){var tmpNode=range.startContainer;if(domUtils.isFillChar(tmpNode)&&range.setStartBefore(tmpNode),tmpNode=range.endContainer,domUtils.isFillChar(tmpNode)&&range.setEndAfter(tmpNode),range.txtToElmBoundary(),range.endContainer&&1==range.endContainer.nodeType&&(tmpNode=range.endContainer.childNodes[range.endOffset],tmpNode&&domUtils.isBr(tmpNode)&&range.setEndAfter(tmpNode)),0==range.startOffset&&(tmpNode=range.startContainer,domUtils.isBoundaryNode(tmpNode,"firstChild")&&(tmpNode=range.endContainer,range.endOffset==(3==tmpNode.nodeType?tmpNode.nodeValue.length:tmpNode.childNodes.length)&&domUtils.isBoundaryNode(tmpNode,"lastChild")&&(me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",range.setStart(me.body.firstChild,0).collapse(!0)))),!range.collapsed&&range.deleteContents(),1==range.startContainer.nodeType){var pre,child=range.startContainer.childNodes[range.startOffset];if(child&&domUtils.isBlockElm(child)&&(pre=child.previousSibling)&&domUtils.isBlockElm(pre)){for(range.setEnd(pre,pre.childNodes.length).collapse();child.firstChild;)pre.appendChild(child.firstChild);domUtils.remove(child)}}}var child,parent,pre,tmp,nextNode,hadBreak=0;range.inFillChar()&&(child=range.startContainer,domUtils.isFillChar(child)?(range.setStartBefore(child).collapse(!0),domUtils.remove(child)):domUtils.isFillChar(child,!0)&&(child.nodeValue=child.nodeValue.replace(fillCharReg,""),range.startOffset--,range.collapsed&&range.collapse(!0)));var li=domUtils.findParentByTagName(range.startContainer,"li",!0);if(li){for(var next,last;child=div.firstChild;){for(;child&&(3==child.nodeType||!domUtils.isBlockElm(child)||"HR"==child.tagName);)next=child.nextSibling,range.insertNode(child).collapse(),last=child,child=next;if(child)if(/^(ol|ul)$/i.test(child.tagName)){for(;child.firstChild;)last=child.firstChild,domUtils.insertAfter(li,child.firstChild),li=li.nextSibling;domUtils.remove(child)}else{var tmpLi;next=child.nextSibling,tmpLi=me.document.createElement("li"),domUtils.insertAfter(li,tmpLi),tmpLi.appendChild(child),last=child,child=next,li=tmpLi}}li=domUtils.findParentByTagName(range.startContainer,"li",!0),domUtils.isEmptyBlock(li)&&domUtils.remove(li),last&&range.setStartAfter(last).collapse(!0).select(!0)}else{for(;child=div.firstChild;){if(hadBreak){for(var p=me.document.createElement("p");child&&(3==child.nodeType||!dtd.$block[child.tagName]);)nextNode=child.nextSibling,p.appendChild(child),child=nextNode;p.firstChild&&(child=p)}if(range.insertNode(child),nextNode=child.nextSibling,!hadBreak&&child.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(child)&&(parent=domUtils.findParent(child,function(node){return domUtils.isBlockElm(node)}),parent&&"body"!=parent.tagName.toLowerCase()&&(!dtd[parent.tagName][child.nodeName]||child.parentNode!==parent))){if(dtd[parent.tagName][child.nodeName])for(tmp=child.parentNode;tmp!==parent;)pre=tmp,tmp=tmp.parentNode;else pre=parent;domUtils.breakParent(child,pre||tmp);var pre=child.previousSibling;domUtils.trimWhiteTextNode(pre),pre.childNodes.length||domUtils.remove(pre),!browser.ie&&(next=child.nextSibling)&&domUtils.isBlockElm(next)&&next.lastChild&&!domUtils.isBr(next.lastChild)&&next.appendChild(me.document.createElement("br")),hadBreak=1}var next=child.nextSibling;if(!div.firstChild&&next&&domUtils.isBlockElm(next)){range.setStart(next,0).collapse(!0);break}range.setEndAfter(child).collapse()}if(child=range.startContainer,nextNode&&domUtils.isBr(nextNode)&&domUtils.remove(nextNode),domUtils.isBlockElm(child)&&domUtils.isEmptyNode(child))if(nextNode=child.nextSibling)domUtils.remove(child),1==nextNode.nodeType&&dtd.$block[nextNode.tagName]&&range.setStart(nextNode,0).collapse(!0).shrinkBoundary();else try{child.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(e){range.setStartBefore(child),domUtils.remove(child)}try{range.select(!0)}catch(e){}}setTimeout(function(){range=me.selection.getRange(),range.scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0),me.fireEvent("afterinserthtml")},200)}}},UE.commands.imagefloat={execCommand:function(cmd,align){var me=this,range=me.selection.getRange();if(!range.collapsed){var img=range.getClosedNode();if(img&&"IMG"==img.tagName)switch(align){case"left":case"right":case"none":for(var tmpNode,pre,next,pN=img.parentNode;dtd.$inline[pN.tagName]||"A"==pN.tagName;)pN=pN.parentNode;if(tmpNode=pN,"P"==tmpNode.tagName&&"center"==domUtils.getStyle(tmpNode,"text-align")){if(!domUtils.isBody(tmpNode)&&1==domUtils.getChildCount(tmpNode,function(node){return!domUtils.isBr(node)&&!domUtils.isWhitespace(node)
}))if(pre=tmpNode.previousSibling,next=tmpNode.nextSibling,pre&&next&&1==pre.nodeType&&1==next.nodeType&&pre.tagName==next.tagName&&domUtils.isBlockElm(pre)){for(pre.appendChild(tmpNode.firstChild);next.firstChild;)pre.appendChild(next.firstChild);domUtils.remove(tmpNode),domUtils.remove(next)}else domUtils.setStyle(tmpNode,"text-align","");range.selectNode(img).select()}domUtils.setStyle(img,"float","none"==align?"":align),"none"==align&&domUtils.removeAttributes(img,"align");break;case"center":if("center"!=me.queryCommandValue("imagefloat")){for(pN=img.parentNode,domUtils.setStyle(img,"float",""),domUtils.removeAttributes(img,"align"),tmpNode=img;pN&&1==domUtils.getChildCount(pN,function(node){return!domUtils.isBr(node)&&!domUtils.isWhitespace(node)})&&(dtd.$inline[pN.tagName]||"A"==pN.tagName);)tmpNode=pN,pN=pN.parentNode;range.setStartBefore(tmpNode).setCursor(!1),pN=me.document.createElement("div"),pN.appendChild(tmpNode),domUtils.setStyle(tmpNode,"float",""),me.execCommand("insertHtml",'<p id="_img_parent_tmp" style="text-align:center">'+pN.innerHTML+"</p>"),tmpNode=me.document.getElementById("_img_parent_tmp"),tmpNode.removeAttribute("id"),tmpNode=tmpNode.firstChild,range.selectNode(tmpNode).select(),next=tmpNode.parentNode.nextSibling,next&&domUtils.isEmptyNode(next)&&domUtils.remove(next)}}}},queryCommandValue:function(){var startNode,floatStyle,range=this.selection.getRange();return range.collapsed?"none":(startNode=range.getClosedNode(),startNode&&1==startNode.nodeType&&"IMG"==startNode.tagName?(floatStyle=startNode.getAttribute("align")||domUtils.getComputedStyle(startNode,"float"),"none"==floatStyle&&(floatStyle="center"==domUtils.getComputedStyle(startNode.parentNode,"text-align")?"center":floatStyle),{left:1,right:1,center:1}[floatStyle]?floatStyle:"none"):"none")},queryCommandState:function(){var startNode,range=this.selection.getRange();return range.collapsed?-1:(startNode=range.getClosedNode(),startNode&&1==startNode.nodeType&&"IMG"==startNode.tagName?0:-1)}},UE.commands.insertimage={execCommand:function(cmd,opt){if(opt=utils.isArray(opt)?opt:[opt],opt.length){var me=this,range=me.selection.getRange(),img=range.getClosedNode();if(img&&/img/i.test(img.tagName)&&"edui-faked-video"!=img.className&&!img.getAttribute("word_img")){var first=opt.shift(),floatStyle=first.floatStyle;delete first.floatStyle,domUtils.setAttributes(img,first),me.execCommand("imagefloat",floatStyle),opt.length>0&&(range.setStartAfter(img).setCursor(!1,!0),me.execCommand("insertimage",opt))}else{var ci,html=[],str="";if(ci=opt[0],1==opt.length)str='<img src="'+ci.src+'" '+(ci._src?' _src="'+ci._src+'" ':"")+(ci.width?'width="'+ci.width+'" ':"")+(ci.height?' height="'+ci.height+'" ':"")+("left"==ci.floatStyle||"right"==ci.floatStyle?' style="float:'+ci.floatStyle+';"':"")+(ci.title&&""!=ci.title?' title="'+ci.title+'"':"")+(ci.border&&"0"!=ci.border?' border="'+ci.border+'"':"")+(ci.alt&&""!=ci.alt?' alt="'+ci.alt+'"':"")+(ci.hspace&&"0"!=ci.hspace?' hspace = "'+ci.hspace+'"':"")+(ci.vspace&&"0"!=ci.vspace?' vspace = "'+ci.vspace+'"':"")+"/>","center"==ci.floatStyle&&(str='<p style="text-align: center">'+str+"</p>"),html.push(str);else for(var i=0;ci=opt[i++];)str="<p "+("center"==ci.floatStyle?'style="text-align: center" ':"")+'><img src="'+ci.src+'" '+(ci.width?'width="'+ci.width+'" ':"")+(ci._src?' _src="'+ci._src+'" ':"")+(ci.height?' height="'+ci.height+'" ':"")+' style="'+(ci.floatStyle&&"center"!=ci.floatStyle?"float:"+ci.floatStyle+";":"")+(ci.border||"")+'" '+(ci.title?' title="'+ci.title+'"':"")+" /></p>",html.push(str);me.execCommand("insertHtml",html.join(""))}}}},UE.plugins.undo=function(){function compareAddr(indexA,indexB){if(indexA.length!=indexB.length)return 0;for(var i=0,l=indexA.length;l>i;i++)if(indexA[i]!=indexB[i])return 0;return 1}function compareRangeAddress(rngAddrA,rngAddrB){return rngAddrA.collapsed!=rngAddrB.collapsed?0:compareAddr(rngAddrA.startAddress,rngAddrB.startAddress)&&compareAddr(rngAddrA.endAddress,rngAddrB.endAddress)?1:0}function UndoManager(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&1==this.list.length)return this.reset(),void 0;for(;this.list[this.index].content==this.list[this.index-1].content;)if(this.index--,0==this.index)return this.restore(0);this.restore(--this.index)}},this.redo=function(){if(this.hasRedo){for(;this.list[this.index].content==this.list[this.index+1].content;)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},this.restore=function(){var me=this.editor,scene=this.list[this.index],root=UE.htmlparser(scene.content.replace(fillchar,""));me.options.autoClearEmptyNode=!1,me.filterInputRule(root),me.options.autoClearEmptyNode=orgState,me.document.body.innerHTML=root.toHtml(),me.fireEvent("afterscencerestore"),browser.ie&&utils.each(domUtils.getElementsByTagName(me.document,"td th caption p"),function(node){domUtils.isEmptyNode(node)&&domUtils.fillNode(me.document,node)});try{var rng=new dom.Range(me.document).moveToAddress(scene.address);rng.select(noNeedFillCharTags[rng.startContainer.nodeName.toLowerCase()])}catch(e){}this.update(),this.clearKey(),me.fireEvent("reset",!0)},this.getScene=function(){var me=this.editor,rng=me.selection.getRange(),rngAddress=rng.createAddress(!1,!0);me.fireEvent("beforegetscene");var root=UE.htmlparser(me.body.innerHTML,!0);me.options.autoClearEmptyNode=!1,me.filterOutputRule(root),me.options.autoClearEmptyNode=orgState;var cont=root.toHtml();browser.ie&&(cont=cont.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">")),me.fireEvent("aftergetscene");try{}catch(e){}return{address:rngAddress,content:cont}},this.save=function(notCompareRange,notSetCursor){clearTimeout(saveSceneTimer);var currentScene=this.getScene(notSetCursor),lastScene=this.list[this.index];lastScene&&lastScene.content==currentScene.content&&(notCompareRange?1:compareRangeAddress(lastScene.address,currentScene.address))||(this.list=this.list.slice(0,this.index+1),this.list.push(currentScene),this.list.length>maxUndoCount&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())},this.update=function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1]},this.reset=function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.clearKey()},this.clearKey=function(){keycont=0,lastKeyCode=null}}function saveScene(){this.undoManger.save()}var saveSceneTimer,me=this,maxUndoCount=me.options.maxUndoCount||20,maxInputCount=me.options.maxInputCount||20,fillchar=new RegExp(domUtils.fillChar+"|</hr>","gi"),noNeedFillCharTags={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},orgState=me.options.autoClearEmptyNode;me.undoManger=new UndoManager,me.undoManger.editor=me,me.addListener("saveScene",function(){var args=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,args)}),me.addListener("beforeexeccommand",saveScene),me.addListener("afterexeccommand",saveScene),me.addListener("reset",function(type,exclude){exclude||this.undoManger.reset()}),me.commands.redo=me.commands.undo={execCommand:function(cmdName){this.undoManger[cmdName]()},queryCommandState:function(cmdName){return this.undoManger["has"+("undo"==cmdName.toLowerCase()?"Undo":"Redo")]?0:-1},notNeedUndo:1};var lastKeyCode,keys={16:1,17:1,18:1,37:1,38:1,39:1,40:1},keycont=0,inputType=!1;me.addListener("ready",function(){domUtils.on(this.body,"compositionstart",function(){inputType=!0}),domUtils.on(this.body,"compositionend",function(){inputType=!1})}),me.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89"});var isCollapsed=!0;me.addListener("keydown",function(type,evt){function save(cont){cont.selection.getRange().collapsed&&cont.fireEvent("contentchange"),cont.undoManger.save(!1,!0),cont.fireEvent("selectionchange")}var me=this,keyCode=evt.keyCode||evt.which;if(!(keys[keyCode]||evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)){if(inputType)return;if(!me.selection.getRange().collapsed)return me.undoManger.save(!1,!0),isCollapsed=!1,void 0;0==me.undoManger.list.length&&me.undoManger.save(!0),clearTimeout(saveSceneTimer),saveSceneTimer=setTimeout(function(){if(inputType)var interalTimer=setInterval(function(){inputType||(save(me),clearInterval(interalTimer))},300);else save(me)},200),lastKeyCode=keyCode,keycont++,keycont>=maxInputCount&&save(me)}}),me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(!(keys[keyCode]||evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)){if(inputType)return;isCollapsed||(this.undoManger.save(!1,!0),isCollapsed=!0)}})},UE.plugins.font=function(){function mergesibling(rng){var common,collapsed=rng.collapsed,bk=rng.createBookmark();if(collapsed)for(common=bk.start.parentNode;dtd.$inline[common.tagName];)common=common.parentNode;else common=domUtils.getCommonAncestor(bk.start,bk.end);utils.each(domUtils.getElementsByTagName(common,"span"),function(span){if(span.parentNode&&!domUtils.isBookmarkNode(span)){if(/^\s*border\s*:\s*none;\s*/i.test(span.style.cssText))return domUtils.remove(span,!0),void 0;/border/i.test(span.style.cssText)&&"SPAN"==span.parentNode.tagName&&/border/i.test(span.parentNode.style.cssText)&&(span.style.cssText=span.style.cssText.replace(/border[^:]*:[^;]+;?/gi,""));for(var next=span.nextSibling;next&&1==next.nodeType&&"SPAN"==next.tagName&&(domUtils.isBookmarkNode(next)?span.appendChild(next):next.style.cssText==span.style.cssText&&(domUtils.moveChild(next,span),domUtils.remove(next)),span.nextSibling!==next);)next=span.nextSibling}}),rng.moveToBookmark(bk)}var me=this,fonts={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration",fontborder:"border"},needCmd={underline:1,strikethrough:1,fontborder:1};me.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"}],fontsize:[10,11,12,14,16,18,20,24,36]}),me.addInputRule(function(root){utils.each(root.getNodesByTagName("u s del font"),function(node){if("font"==node.tagName){var cssStyle=[];for(var p in node.attrs)switch(p){case"size":cssStyle.push("font-size:"+node.attrs[p]+"px");break;case"color":cssStyle.push("color:"+node.attrs[p]);break;case"face":cssStyle.push("font-family:"+node.attrs[p]);break;case"style":cssStyle.push(node.attrs[p])}node.attrs={style:cssStyle.join(";")}}else{var val="u"==node.tagName?"underline":"line-through";node.attrs={style:(node.getAttr("style")||"")+"text-decoration:"+val+";"}}node.tagName="span"})});for(var p in fonts)!function(cmd,style){UE.commands[cmd]={execCommand:function(cmdName,value){value=value||(this.queryCommandState(cmdName)?"none":"underline"==cmdName?"underline":"fontborder"==cmdName?"1px solid #000":"line-through");var text,me=this,range=this.selection.getRange();if("default"==value)range.collapsed&&(text=me.document.createTextNode("font"),range.insertNode(text).select()),me.execCommand("removeFormat","span,a",style),text&&(range.setStartBefore(text).setCursor(),domUtils.remove(text));else if(range.collapsed){var span=domUtils.findParentByTagName(range.startContainer,"span",!0);if(text=me.document.createTextNode("font"),!span||span.children.length||span[browser.ie?"innerText":"textContent"].replace(fillCharReg,"").length){if(range.insertNode(text),range.selectNode(text).select(),span=range.document.createElement("span"),needCmd[cmd]){if(domUtils.findParentByTagName(text,"a",!0))return range.setStartBefore(text).setCursor(),domUtils.remove(text),void 0;me.execCommand("removeFormat","span,a",style)}if(span.style.cssText=style+":"+value,text.parentNode.insertBefore(span,text),!browser.ie||browser.ie&&9==browser.version)for(var spanParent=span.parentNode;!domUtils.isBlockElm(spanParent);)"SPAN"==spanParent.tagName&&(span.style.cssText=spanParent.style.cssText+";"+span.style.cssText),spanParent=spanParent.parentNode;opera?setTimeout(function(){range.setStart(span,0).collapse(!0),mergesibling(range,me),range.select()}):(range.setStart(span,0).collapse(!0),mergesibling(range,me),range.select())}else range.insertNode(text),needCmd[cmd]&&(range.selectNode(text).select(),me.execCommand("removeFormat","span,a",style,null),span=domUtils.findParentByTagName(text,"span",!0),range.setStartBefore(text)),span&&(span.style.cssText+=";"+style+":"+value),range.collapse(!0).select();domUtils.remove(text)}else needCmd[cmd]&&me.queryCommandValue(cmd)&&me.execCommand("removeFormat","span,a",style),range=me.selection.getRange(),range.applyInlineStyle("span",{style:style+":"+value}),mergesibling(range,me),range.select();return!0},queryCommandValue:function(cmdName){var startNode=this.selection.getStart();if("underline"==cmdName||"strikethrough"==cmdName){for(var value,tmpNode=startNode;tmpNode&&!domUtils.isBlockElm(tmpNode)&&!domUtils.isBody(tmpNode);){if(1==tmpNode.nodeType&&(value=domUtils.getComputedStyle(tmpNode,style),"none"!=value))return value;tmpNode=tmpNode.parentNode}return"none"}if("fontborder"==cmdName){for(var val,tmp=startNode;tmp&&dtd.$inline[tmp.tagName];){if((val=domUtils.getComputedStyle(tmp,"border"))&&/1px/.test(val)&&/solid/.test(val))return val;tmp=tmp.parentNode}return""}return domUtils.getComputedStyle(startNode,style)},queryCommandState:function(cmdName){if(!needCmd[cmdName])return 0;var val=this.queryCommandValue(cmdName);return"fontborder"==cmdName?/1px/.test(val)&&/solid/.test(val):val==("underline"==cmdName?"underline":"line-through")}}}(p,fonts[p])},UE.plugins.basestyle=function(){var basestyles={bold:["strong","b"],italic:["em","i"],subscript:["sub"],superscript:["sup"]},getObj=function(editor,tagNames){return domUtils.filterNodeList(editor.selection.getStartElementPath(),tagNames)},me=this;me.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+85"}),me.addInputRule(function(root){utils.each(root.getNodesByTagName("b i"),function(node){switch(node.tagName){case"b":node.tagName="strong";break;case"i":node.tagName="em"}})});for(var style in basestyles)!function(cmd,tagNames){me.commands[cmd]={execCommand:function(cmdName){var range=me.selection.getRange(),obj=getObj(this,tagNames);if(range.collapsed){if(obj){var tmpText=me.document.createTextNode("");range.insertNode(tmpText).removeInlineStyle(tagNames),range.setStartBefore(tmpText),domUtils.remove(tmpText)}else{var tmpNode=range.document.createElement(tagNames[0]);("superscript"==cmdName||"subscript"==cmdName)&&(tmpText=me.document.createTextNode(""),range.insertNode(tmpText).removeInlineStyle(["sub","sup"]).setStartBefore(tmpText).collapse(!0)),range.insertNode(tmpNode).setStart(tmpNode,0)}range.collapse(!0)}else("superscript"==cmdName||"subscript"==cmdName)&&(obj&&obj.tagName.toLowerCase()==cmdName||range.removeInlineStyle(["sub","sup"])),obj?range.removeInlineStyle(tagNames):range.applyInlineStyle(tagNames[0]);range.select()},queryCommandState:function(){return getObj(this,tagNames)?1:0}}}(style,basestyles[style])},UE.plugins.justify=function(){var block=domUtils.isBlockElm,defaultValue={left:1,right:1,center:1,justify:1},doJustify=function(range,style){var bookmark=range.createBookmark(),filterFn=function(node){return 1==node.nodeType?"br"!=node.tagName.toLowerCase()&&!domUtils.isBookmarkNode(node):!domUtils.isWhitespace(node)};range.enlarge(!0);for(var tmpNode,bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,!1,filterFn),tmpRange=range.cloneRange();current&&!(domUtils.getPosition(current,bookmark2.end)&domUtils.POSITION_FOLLOWING);)if(3!=current.nodeType&&block(current))current=domUtils.getNextDomNode(current,!0,filterFn);else{for(tmpRange.setStartBefore(current);current&&current!==bookmark2.end&&!block(current);)tmpNode=current,current=domUtils.getNextDomNode(current,!1,null,function(node){return!block(node)});tmpRange.setEndAfter(tmpNode);var common=tmpRange.getCommonAncestor();if(!domUtils.isBody(common)&&block(common))domUtils.setStyles(common,utils.isString(style)?{"text-align":style}:style),current=common;else{var p=range.document.createElement("p");domUtils.setStyles(p,utils.isString(style)?{"text-align":style}:style);var frag=tmpRange.extractContents();p.appendChild(frag),tmpRange.insertNode(p),current=p}current=domUtils.getNextDomNode(current,!1,filterFn)}return range.moveToBookmark(bookmark2).moveToBookmark(bookmark)};UE.commands.justify={execCommand:function(cmdName,align){var txt,range=this.selection.getRange();return range.collapsed&&(txt=this.document.createTextNode("p"),range.insertNode(txt)),doJustify(range,align),txt&&(range.setStartBefore(txt).collapse(!0),domUtils.remove(txt)),range.select(),!0},queryCommandValue:function(){var startNode=this.selection.getStart(),value=domUtils.getComputedStyle(startNode,"text-align");return defaultValue[value]?value:"left"},queryCommandState:function(){var start=this.selection.getStart(),cell=start&&domUtils.findParentByTagName(start,["td","th","caption"],!0);return cell?-1:0}}},UE.plugins.link=function(){function optimize(range){var start=range.startContainer,end=range.endContainer;(start=domUtils.findParentByTagName(start,"a",!0))&&range.setStartBefore(start),(end=domUtils.findParentByTagName(end,"a",!0))&&range.setEndAfter(end)}function doLink(range,opt,me){var rngClone=range.cloneRange(),link=me.queryCommandValue("link");optimize(range=range.adjustmentBoundary());var start=range.startContainer;if(1==start.nodeType&&link&&(start=start.childNodes[range.startOffset],start&&1==start.nodeType&&"A"==start.tagName&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(start[browser.ie?"innerText":"textContent"])&&(start[browser.ie?"innerText":"textContent"]=utils.html(opt.textValue||opt.href))),(!rngClone.collapsed||link)&&(range.removeInlineStyle("a"),rngClone=range.cloneRange()),rngClone.collapsed){var a=range.document.createElement("a"),text="";opt.textValue?(text=utils.html(opt.textValue),delete opt.textValue):text=utils.html(opt.href),domUtils.setAttributes(a,opt),start=domUtils.findParentByTagName(rngClone.startContainer,"a",!0),start&&domUtils.isInNodeEndBoundary(rngClone,start)&&range.setStartAfter(start).collapse(!0),a[browser.ie?"innerText":"textContent"]=text,range.insertNode(a).selectNode(a)}else range.applyInlineStyle("a",opt)}UE.commands.unlink={execCommand:function(){var bookmark,range=this.selection.getRange();(!range.collapsed||domUtils.findParentByTagName(range.startContainer,"a",!0))&&(bookmark=range.createBookmark(),optimize(range),range.removeInlineStyle("a").moveToBookmark(bookmark).select())},queryCommandState:function(){return!this.highlight&&this.queryCommandValue("link")?0:-1}},UE.commands.link={execCommand:function(cmdName,opt){var range;opt._href&&(opt._href=utils.unhtml(opt._href,/[<">]/g)),opt.href&&(opt.href=utils.unhtml(opt.href,/[<">]/g)),opt.textValue&&(opt.textValue=utils.unhtml(opt.textValue,/[<">]/g)),doLink(range=this.selection.getRange(),opt,this),range.collapse().select(!0)},queryCommandValue:function(){var node,range=this.selection.getRange();if(!range.collapsed){range.shrinkBoundary();var start=3!=range.startContainer.nodeType&&range.startContainer.childNodes[range.startOffset]?range.startContainer.childNodes[range.startOffset]:range.startContainer,end=3==range.endContainer.nodeType||0==range.endOffset?range.endContainer:range.endContainer.childNodes[range.endOffset-1],common=range.getCommonAncestor();if(node=domUtils.findParentByTagName(common,"a",!0),!node&&1==common.nodeType)for(var ps,pe,ci,as=common.getElementsByTagName("a"),i=0;ci=as[i++];)if(ps=domUtils.getPosition(ci,start),pe=domUtils.getPosition(ci,end),(ps&domUtils.POSITION_FOLLOWING||ps&domUtils.POSITION_CONTAINS)&&(pe&domUtils.POSITION_PRECEDING||pe&domUtils.POSITION_CONTAINS)){node=ci;break}return node}return node=range.startContainer,node=1==node.nodeType?node:node.parentNode,node&&(node=domUtils.findParentByTagName(node,"a",!0))&&!domUtils.isInNodeEndBoundary(range,node)?node:void 0},queryCommandState:function(){var img=this.selection.getRange().getClosedNode(),flag=img&&"edui-faked-video"==img.className;return flag?-1:0}}},UE.plugins.removeformat=function(){var me=this;me.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),me.commands.removeformat={execCommand:function(cmdName,tags,style,attrs,notIncludeA){function isRedundantSpan(node){if(3==node.nodeType||"span"!=node.tagName.toLowerCase())return 0;if(browser.ie){var attrs=node.attributes;if(attrs.length){for(var i=0,l=attrs.length;l>i;i++)if(attrs[i].specified)return 0;return 1}}return!node.attributes.length}function doRemove(range){var bookmark1=range.createBookmark();if(range.collapsed&&range.enlarge(!0),!notIncludeA){var aNode=domUtils.findParentByTagName(range.startContainer,"a",!0);aNode&&range.setStartBefore(aNode),aNode=domUtils.findParentByTagName(range.endContainer,"a",!0),aNode&&range.setEndAfter(aNode)}for(bookmark=range.createBookmark(),node=bookmark.start;(parent=node.parentNode)&&!domUtils.isBlockElm(parent);)domUtils.breakParent(node,parent),domUtils.clearEmptySibling(node);if(bookmark.end){for(node=bookmark.end;(parent=node.parentNode)&&!domUtils.isBlockElm(parent);)domUtils.breakParent(node,parent),domUtils.clearEmptySibling(node);for(var next,current=domUtils.getNextDomNode(bookmark.start,!1,filter);current&&current!=bookmark.end;)next=domUtils.getNextDomNode(current,!0,filter),dtd.$empty[current.tagName.toLowerCase()]||domUtils.isBookmarkNode(current)||(tagReg.test(current.tagName)?style?(domUtils.removeStyle(current,style),isRedundantSpan(current)&&"text-decoration"!=style&&domUtils.remove(current,!0)):domUtils.remove(current,!0):dtd.$tableContent[current.tagName]||dtd.$list[current.tagName]||(domUtils.removeAttributes(current,removeFormatAttributes),isRedundantSpan(current)&&domUtils.remove(current,!0))),current=next}var pN=bookmark.start.parentNode;!domUtils.isBlockElm(pN)||dtd.$tableContent[pN.tagName]||dtd.$list[pN.tagName]||domUtils.removeAttributes(pN,removeFormatAttributes),pN=bookmark.end.parentNode,bookmark.end&&domUtils.isBlockElm(pN)&&!dtd.$tableContent[pN.tagName]&&!dtd.$list[pN.tagName]&&domUtils.removeAttributes(pN,removeFormatAttributes),range.moveToBookmark(bookmark).moveToBookmark(bookmark1);for(var tmp,node=range.startContainer,collapsed=range.collapsed;1==node.nodeType&&domUtils.isEmptyNode(node)&&dtd.$removeEmpty[node.tagName];)tmp=node.parentNode,range.setStartBefore(node),range.startContainer===range.endContainer&&range.endOffset--,domUtils.remove(node),node=tmp;if(!collapsed)for(node=range.endContainer;1==node.nodeType&&domUtils.isEmptyNode(node)&&dtd.$removeEmpty[node.tagName];)tmp=node.parentNode,range.setEndBefore(node),domUtils.remove(node),node=tmp}var bookmark,parent,tagReg=new RegExp("^(?:"+(tags||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),removeFormatAttributes=style?[]:(attrs||this.options.removeFormatAttributes).split(","),range=new dom.Range(this.document),filter=function(node){return 1==node.nodeType};range=this.selection.getRange(),doRemove(range),range.select()}}},UE.plugins.autotypeset=function(){function isLine(node,notEmpty){return node&&3!=node.nodeType?domUtils.isBr(node)?1:node&&node.parentNode&&tags[node.tagName.toLowerCase()]?highlightCont&&highlightCont.contains(node)||node.getAttribute("pagebreak")?0:notEmpty?!domUtils.isEmptyBlock(node):domUtils.isEmptyBlock(node,new RegExp("[\\s"+domUtils.fillChar+"]","g")):void 0:0}function removeNotAttributeSpan(node){node.style.cssText||(domUtils.removeAttributes(node,["style"]),"span"==node.tagName.toLowerCase()&&domUtils.hasNoAttributes(node)&&domUtils.remove(node,!0))}function autotype(type,html){var cont,me=this;if(html){if(!opt.pasteFilter)return;cont=me.document.createElement("div"),cont.innerHTML=html.html}else cont=me.document.body;for(var ci,nodes=domUtils.getElementsByTagName(cont,"*"),i=0;ci=nodes[i++];)if(me.fireEvent("excludeNodeinautotype",ci)!==!0){if(opt.clearFontSize&&ci.style.fontSize&&(domUtils.removeStyle(ci,"font-size"),removeNotAttributeSpan(ci)),opt.clearFontFamily&&ci.style.fontFamily&&(domUtils.removeStyle(ci,"font-family"),removeNotAttributeSpan(ci)),isLine(ci)){if(opt.mergeEmptyline)for(var tmpNode,next=ci.nextSibling,isBr=domUtils.isBr(ci);isLine(next)&&(tmpNode=next,next=tmpNode.nextSibling,!isBr||next&&(!next||domUtils.isBr(next)));)domUtils.remove(tmpNode);if(opt.removeEmptyline&&domUtils.inDoc(ci,cont)&&!remainTag[ci.parentNode.tagName.toLowerCase()]){if(domUtils.isBr(ci)&&(next=ci.nextSibling,next&&!domUtils.isBr(next)))continue;domUtils.remove(ci);continue}}if(isLine(ci,!0)&&"SPAN"!=ci.tagName&&(opt.indent&&(ci.style.textIndent=opt.indentValue),opt.textAlign&&(ci.style.textAlign=opt.textAlign)),opt.removeClass&&ci.className&&!remainClass[ci.className.toLowerCase()]){if(highlightCont&&highlightCont.contains(ci))continue;domUtils.removeAttributes(ci,["class"])}if(opt.imageBlockLine&&"img"==ci.tagName.toLowerCase()&&!ci.getAttribute("emotion"))if(html){var img=ci;switch(opt.imageBlockLine){case"left":case"right":case"none":for(var tmpNode,pre,next,pN=img.parentNode;dtd.$inline[pN.tagName]||"A"==pN.tagName;)pN=pN.parentNode;if(tmpNode=pN,"P"==tmpNode.tagName&&"center"==domUtils.getStyle(tmpNode,"text-align")&&!domUtils.isBody(tmpNode)&&1==domUtils.getChildCount(tmpNode,function(node){return!domUtils.isBr(node)&&!domUtils.isWhitespace(node)}))if(pre=tmpNode.previousSibling,next=tmpNode.nextSibling,pre&&next&&1==pre.nodeType&&1==next.nodeType&&pre.tagName==next.tagName&&domUtils.isBlockElm(pre)){for(pre.appendChild(tmpNode.firstChild);next.firstChild;)pre.appendChild(next.firstChild);domUtils.remove(tmpNode),domUtils.remove(next)}else domUtils.setStyle(tmpNode,"text-align","");domUtils.setStyle(img,"float",opt.imageBlockLine);break;case"center":if("center"!=me.queryCommandValue("imagefloat")){for(pN=img.parentNode,domUtils.setStyle(img,"float","none"),tmpNode=img;pN&&1==domUtils.getChildCount(pN,function(node){return!domUtils.isBr(node)&&!domUtils.isWhitespace(node)})&&(dtd.$inline[pN.tagName]||"A"==pN.tagName);)tmpNode=pN,pN=pN.parentNode;var pNode=me.document.createElement("p");domUtils.setAttributes(pNode,{style:"text-align:center"}),tmpNode.parentNode.insertBefore(pNode,tmpNode),pNode.appendChild(tmpNode),domUtils.setStyle(tmpNode,"float","")}}}else{var range=me.selection.getRange();range.selectNode(ci).select(),me.execCommand("imagefloat",opt.imageBlockLine)}opt.removeEmptyNode&&opt.removeTagNames[ci.tagName.toLowerCase()]&&domUtils.hasNoAttributes(ci)&&domUtils.isEmptyBlock(ci)&&domUtils.remove(ci)}html&&(html.html=cont.innerHTML)}this.setOpt({autotypeset:{mergeEmptyline:!0,removeClass:!0,removeEmptyline:!1,textAlign:"left",imageBlockLine:"center",pasteFilter:!1,clearFontSize:!1,clearFontFamily:!1,removeEmptyNode:!1,removeTagNames:utils.extend({div:1},dtd.$removeEmpty),indent:!1,indentValue:"2em"}});var highlightCont,me=this,opt=me.options.autotypeset,remainClass={selectTdClass:1,pagebreak:1,anchorclass:1},remainTag={li:1},tags={div:1,p:1,blockquote:1,center:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,span:1};opt&&(opt.pasteFilter&&me.addListener("beforepaste",autotype),me.commands.autotypeset={execCommand:function(){me.removeListener("beforepaste",autotype),opt.pasteFilter&&me.addListener("beforepaste",autotype),autotype.call(me)}})},UE.plugins.autoheight=function(){function adjustHeight(){var me=this;clearTimeout(timer),isFullscreen||(timer=setTimeout(function(){me.queryCommandState&&1!=me.queryCommandState("source")&&(span||(span=me.document.createElement("span"),span.style.cssText="display:block;width:0;margin:0;padding:0;border:0;clear:both;",span.innerHTML="."),tmpNode=span.cloneNode(!0),me.body.appendChild(tmpNode),currentHeight=Math.max(domUtils.getXY(tmpNode).y+tmpNode.offsetHeight,Math.max(options.minFrameHeight,options.initialFrameHeight)),currentHeight!=lastHeight&&(me.setHeight(currentHeight),lastHeight=currentHeight),domUtils.remove(tmpNode))},50))}var me=this;if(me.autoHeightEnabled=me.options.autoHeightEnabled!==!1,me.autoHeightEnabled){var bakOverflow,span,tmpNode,currentHeight,timer,isFullscreen,lastHeight=0,options=me.options;me.addListener("fullscreenchanged",function(cmd,f){isFullscreen=f}),me.addListener("destroy",function(){me.removeListener("contentchange",adjustHeight),me.removeListener("afterinserthtml",adjustHeight),me.removeListener("keyup",adjustHeight),me.removeListener("mouseup",adjustHeight)}),me.enableAutoHeight=function(){if(me.autoHeightEnabled){var doc=me.document;me.autoHeightEnabled=!0,bakOverflow=doc.body.style.overflowY,doc.body.style.overflowY="hidden",me.addListener("contentchange",adjustHeight),me.addListener("afterinserthtml",adjustHeight),me.addListener("keyup",adjustHeight),me.addListener("mouseup",adjustHeight),setTimeout(function(){adjustHeight.call(this)},browser.gecko?100:0),me.fireEvent("autoheightchanged",me.autoHeightEnabled)}},me.disableAutoHeight=function(){me.body.style.overflowY=bakOverflow||"",me.removeListener("contentchange",adjustHeight),me.removeListener("keyup",adjustHeight),me.removeListener("mouseup",adjustHeight),me.autoHeightEnabled=!1,me.fireEvent("autoheightchanged",me.autoHeightEnabled)},me.addListener("ready",function(){me.enableAutoHeight();var timer;domUtils.on(browser.ie?me.body:me.document,browser.webkit?"dragover":"drop",function(){clearTimeout(timer),timer=setTimeout(function(){adjustHeight.call(this)},100)})})}},UE.plugins.autofloat=function(){function checkHasUI(editor){return editor.ui?1:(alert(lang.autofloatMsg),0)}function fixIE6FixedPos(){var docStyle=document.body.style;docStyle.backgroundImage='url("about:blank")',docStyle.backgroundAttachment="fixed"}function setFloating(){var toobarBoxPos=domUtils.getXY(toolbarBox),origalFloat=domUtils.getComputedStyle(toolbarBox,"position"),origalLeft=domUtils.getComputedStyle(toolbarBox,"left");toolbarBox.style.width=toolbarBox.offsetWidth+"px",toolbarBox.style.zIndex=1*me.options.zIndex+1,toolbarBox.parentNode.insertBefore(placeHolder,toolbarBox),LteIE6||quirks&&browser.ie?("absolute"!=toolbarBox.style.position&&(toolbarBox.style.position="absolute"),toolbarBox.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-orgTop+topOffset+"px"):(browser.ie7Compat&&flag&&(flag=!1,toolbarBox.style.left=domUtils.getXY(toolbarBox).x-document.documentElement.getBoundingClientRect().left+2+"px"),"fixed"!=toolbarBox.style.position&&(toolbarBox.style.position="fixed",toolbarBox.style.top=topOffset+"px",("absolute"==origalFloat||"relative"==origalFloat)&&parseFloat(origalLeft)&&(toolbarBox.style.left=toobarBoxPos.x+"px")))}function unsetFloating(){flag=!0,placeHolder.parentNode&&placeHolder.parentNode.removeChild(placeHolder),toolbarBox.style.cssText=bakCssText}function updateFloating(){var rect3=getPosition(me.container),offset=me.options.toolbarTopOffset||0;rect3.top<0&&rect3.bottom-toolbarBox.offsetHeight>offset?setFloating():unsetFloating()}var me=this,lang=me.getLang();me.setOpt({topOffset:0});var optsAutoFloatEnabled=me.options.autoFloatEnabled!==!1,topOffset=me.options.topOffset;if(optsAutoFloatEnabled){var bakCssText,toolbarBox,orgTop,getPosition,uiUtils=UE.ui.uiUtils,LteIE6=browser.ie&&browser.version<=6,quirks=browser.quirks,placeHolder=document.createElement("div"),flag=!0,defer_updateFloating=utils.defer(function(){updateFloating()},browser.ie?200:100,!0);me.addListener("destroy",function(){domUtils.un(window,["scroll","resize"],updateFloating),me.removeListener("keydown",defer_updateFloating)}),me.addListener("ready",function(){checkHasUI(me)&&(getPosition=uiUtils.getClientRect,toolbarBox=me.ui.getDom("toolbarbox"),orgTop=getPosition(toolbarBox).top,bakCssText=toolbarBox.style.cssText,placeHolder.style.height=toolbarBox.offsetHeight+"px",LteIE6&&fixIE6FixedPos(),domUtils.on(window,["scroll","resize"],updateFloating),me.addListener("keydown",defer_updateFloating),me.addListener("beforefullscreenchange",function(t,enabled){enabled&&unsetFloating()
}),me.addListener("fullscreenchanged",function(t,enabled){enabled||updateFloating()}),me.addListener("sourcemodechanged",function(){setTimeout(function(){updateFloating()},0)}),me.addListener("clearDoc",function(){setTimeout(function(){updateFloating()},0)}))})}};var baidu=baidu||{};baidu.editor=baidu.editor||{},baidu.editor.ui={},function(){function updateFixedOffset(){var layer=document.getElementById("edui_fixedlayer");uiUtils.setViewportOffset(layer,{left:0,top:0})}function bindFixedLayer(){domUtils.on(window,"scroll",updateFixedOffset),domUtils.on(window,"resize",baidu.editor.utils.defer(updateFixedOffset,0,!0))}var browser=baidu.editor.browser,domUtils=baidu.editor.dom.domUtils,magic="$EDITORUI",root=window[magic]={},uidMagic="ID"+magic,uidCount=0,uiUtils=baidu.editor.ui.uiUtils={uid:function(obj){return obj?obj[uidMagic]||(obj[uidMagic]=++uidCount):++uidCount},hook:function(fn,callback){var dg;return fn&&fn._callbacks?dg=fn:(dg=function(){var q;fn&&(q=fn.apply(this,arguments));for(var callbacks=dg._callbacks,k=callbacks.length;k--;){var r=callbacks[k].apply(this,arguments);void 0===q&&(q=r)}return q},dg._callbacks=[]),dg._callbacks.push(callback),dg},createElementByHtml:function(html){var el=document.createElement("div");return el.innerHTML=html,el=el.firstChild,el.parentNode.removeChild(el),el},getViewportElement:function(){return browser.ie&&browser.quirks?document.body:document.documentElement},getClientRect:function(element){var bcr;try{bcr=element.getBoundingClientRect()}catch(e){bcr={left:0,top:0,height:0,width:0}}for(var doc,rect={left:Math.round(bcr.left),top:Math.round(bcr.top),height:Math.round(bcr.bottom-bcr.top),width:Math.round(bcr.right-bcr.left)};(doc=element.ownerDocument)!==document&&(element=domUtils.getWindow(doc).frameElement);)bcr=element.getBoundingClientRect(),rect.left+=bcr.left,rect.top+=bcr.top;return rect.bottom=rect.top+rect.height,rect.right=rect.left+rect.width,rect},getViewportRect:function(){var viewportEl=uiUtils.getViewportElement(),width=0|(window.innerWidth||viewportEl.clientWidth),height=0|(window.innerHeight||viewportEl.clientHeight);return{left:0,top:0,height:height,width:width,bottom:height,right:width}},setViewportOffset:function(element,offset){var fixedLayer=uiUtils.getFixedLayer();element.parentNode===fixedLayer?(element.style.left=offset.left+"px",element.style.top=offset.top+"px"):domUtils.setViewportOffset(element,offset)},getEventOffset:function(evt){var el=evt.target||evt.srcElement,rect=uiUtils.getClientRect(el),offset=uiUtils.getViewportOffsetByEvent(evt);return{left:offset.left-rect.left,top:offset.top-rect.top}},getViewportOffsetByEvent:function(evt){var el=evt.target||evt.srcElement,frameEl=domUtils.getWindow(el).frameElement,offset={left:evt.clientX,top:evt.clientY};if(frameEl&&el.ownerDocument!==document){var rect=uiUtils.getClientRect(frameEl);offset.left+=rect.left,offset.top+=rect.top}return offset},setGlobal:function(id,obj){return root[id]=obj,magic+'["'+id+'"]'},unsetGlobal:function(id){delete root[id]},copyAttributes:function(tgt,src){for(var attributes=src.attributes,k=attributes.length;k--;){var attrNode=attributes[k];"style"==attrNode.nodeName||"class"==attrNode.nodeName||browser.ie&&!attrNode.specified||tgt.setAttribute(attrNode.nodeName,attrNode.nodeValue)}src.className&&domUtils.addClass(tgt,src.className),src.style.cssText&&(tgt.style.cssText+=";"+src.style.cssText)},removeStyle:function(el,styleName){if(el.style.removeProperty)el.style.removeProperty(styleName);else{if(!el.style.removeAttribute)throw"";el.style.removeAttribute(styleName)}},contains:function(elA,elB){return elA&&elB&&(elA===elB?!1:elA.contains?elA.contains(elB):16&elA.compareDocumentPosition(elB))},startDrag:function(evt,callbacks,doc){function handleMouseMove(evt){var x=evt.clientX-startX,y=evt.clientY-startY;callbacks.ondragmove(x,y,evt),evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0}function handleMouseUp(){doc.removeEventListener("mousemove",handleMouseMove,!0),doc.removeEventListener("mouseup",handleMouseUp,!0),window.removeEventListener("mouseup",handleMouseUp,!0),callbacks.ondragstop()}function releaseCaptrue(){elm.releaseCapture(),elm.detachEvent("onmousemove",handleMouseMove),elm.detachEvent("onmouseup",releaseCaptrue),elm.detachEvent("onlosecaptrue",releaseCaptrue),callbacks.ondragstop()}var doc=doc||document,startX=evt.clientX,startY=evt.clientY;if(doc.addEventListener)doc.addEventListener("mousemove",handleMouseMove,!0),doc.addEventListener("mouseup",handleMouseUp,!0),window.addEventListener("mouseup",handleMouseUp,!0),evt.preventDefault();else{var elm=evt.srcElement;elm.setCapture(),elm.attachEvent("onmousemove",handleMouseMove),elm.attachEvent("onmouseup",releaseCaptrue),elm.attachEvent("onlosecaptrue",releaseCaptrue),evt.returnValue=!1}callbacks.ondragstart()},getFixedLayer:function(){var layer=document.getElementById("edui_fixedlayer");return null==layer&&(layer=document.createElement("div"),layer.id="edui_fixedlayer",document.body.appendChild(layer),browser.ie&&browser.version<=8?(layer.style.position="absolute",bindFixedLayer(),setTimeout(updateFixedOffset)):layer.style.position="fixed",layer.style.left="0",layer.style.top="0",layer.style.width="0",layer.style.height="0"),layer},makeUnselectable:function(element){if(browser.opera||browser.ie&&browser.version<9){if(element.unselectable="on",element.hasChildNodes())for(var i=0;i<element.childNodes.length;i++)1==element.childNodes[i].nodeType&&uiUtils.makeUnselectable(element.childNodes[i])}else void 0!==element.style.MozUserSelect?element.style.MozUserSelect="none":void 0!==element.style.WebkitUserSelect?element.style.WebkitUserSelect="none":void 0!==element.style.KhtmlUserSelect&&(element.style.KhtmlUserSelect="none")}}}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,EventBase=baidu.editor.EventBase,UIBase=baidu.editor.ui.UIBase=function(){};UIBase.prototype={className:"",uiName:"",initOptions:function(options){var me=this;for(var k in options)me[k]=options[k];this.id=this.id||"edui"+uiUtils.uid()},initUIBase:function(){this._globalKey=utils.unhtml(uiUtils.setGlobal(this.id,this))},render:function(holder){for(var node,html=this.renderHtml(),el=uiUtils.createElementByHtml(html),list=domUtils.getElementsByTagName(el,"*"),theme="edui-"+(this.theme||this.editor.options.theme),layer=document.getElementById("edui_fixedlayer"),i=0;node=list[i++];)domUtils.addClass(node,theme);domUtils.addClass(el,theme),layer&&(layer.className="",domUtils.addClass(layer,theme));var seatEl=this.getDom();null!=seatEl?(seatEl.parentNode.replaceChild(el,seatEl),uiUtils.copyAttributes(el,seatEl)):("string"==typeof holder&&(holder=document.getElementById(holder)),holder=holder||uiUtils.getFixedLayer(),domUtils.addClass(holder,theme),holder.appendChild(el)),this.postRender()},getDom:function(name){return name?document.getElementById(this.id+"_"+name):document.getElementById(this.id)},postRender:function(){this.fireEvent("postrender")},getHtmlTpl:function(){return""},formatHtml:function(tpl){var prefix="edui-"+this.uiName;return tpl.replace(/##/g,this.id).replace(/%%-/g,this.uiName?prefix+"-":"").replace(/%%/g,(this.uiName?prefix:"")+" "+this.className).replace(/\$\$/g,this._globalKey)},renderHtml:function(){return this.formatHtml(this.getHtmlTpl())},dispose:function(){var box=this.getDom();box&&baidu.editor.dom.domUtils.remove(box),uiUtils.unsetGlobal(this.id)}},utils.inherits(UIBase,EventBase)}(),function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Separator=baidu.editor.ui.Separator=function(options){this.initOptions(options),this.initSeparator()};Separator.prototype={uiName:"separator",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"></div>'}},utils.inherits(Separator,UIBase)}(),function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,uiUtils=baidu.editor.ui.uiUtils,Mask=baidu.editor.ui.Mask=function(options){this.initOptions(options),this.initUIBase()};Mask.prototype={getHtmlTpl:function(){return'<div id="##" class="edui-mask %%" onmousedown="return $$._onMouseDown(event, this);"></div>'},postRender:function(){var me=this;domUtils.on(window,"resize",function(){setTimeout(function(){me.isHidden()||me._fill()})})},show:function(zIndex){this._fill(),this.getDom().style.display="",this.getDom().style.zIndex=zIndex},hide:function(){this.getDom().style.display="none",this.getDom().style.zIndex=""},isHidden:function(){return"none"==this.getDom().style.display},_onMouseDown:function(){return!1},_fill:function(){var el=this.getDom(),vpRect=uiUtils.getViewportRect();el.style.width=vpRect.width+"px",el.style.height=vpRect.height+"px"}},utils.inherits(Mask,UIBase)}(),function(){function closeAllPopup(evt,el){for(var i=0;i<allPopups.length;i++){var pop=allPopups[i];if(!pop.isHidden()&&pop.queryAutoHide(el)!==!1){if(evt&&/scroll/gi.test(evt.type)&&"edui-wordpastepop"==pop.className)return;pop.hide()}}}var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,Popup=baidu.editor.ui.Popup=function(options){this.initOptions(options),this.initPopup()},allPopups=[];Popup.postHide=closeAllPopup;var ANCHOR_CLASSES=["edui-anchor-topleft","edui-anchor-topright","edui-anchor-bottomleft","edui-anchor-bottomright"];Popup.prototype={SHADOW_RADIUS:5,content:null,_hidden:!1,autoRender:!0,canSideLeft:!0,canSideUp:!0,initPopup:function(){this.initUIBase(),allPopups.push(this)},getHtmlTpl:function(){return'<div id="##" class="edui-popup %%"> <div id="##_body" class="edui-popup-body"> <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe> <div class="edui-shadow"></div> <div id="##_content" class="edui-popup-content">'+this.getContentHtmlTpl()+"  </div>"+" </div>"+"</div>"},getContentHtmlTpl:function(){return this.content?"string"==typeof this.content?this.content:this.content.renderHtml():""},_UIBase_postRender:UIBase.prototype.postRender,postRender:function(){this.content instanceof UIBase&&this.content.postRender(),this.fireEvent("postRenderAfter"),this.hide(!0),this._UIBase_postRender()},_doAutoRender:function(){!this.getDom()&&this.autoRender&&this.render()},mesureSize:function(){var box=this.getDom("content");return uiUtils.getClientRect(box)},fitSize:function(){var popBodyEl=this.getDom("body");popBodyEl.style.width="",popBodyEl.style.height="";var size=this.mesureSize();return popBodyEl.style.width=size.width+"px",popBodyEl.style.height=size.height+"px",size},showAnchor:function(element,hoz){this.showAnchorRect(uiUtils.getClientRect(element),hoz)},showAnchorRect:function(rect,hoz){this._doAutoRender();var vpRect=uiUtils.getViewportRect();this._show();var sideLeft,sideUp,left,top,popSize=this.fitSize();hoz?(sideLeft=this.canSideLeft&&rect.right+popSize.width>vpRect.right&&rect.left>popSize.width,sideUp=this.canSideUp&&rect.top+popSize.height>vpRect.bottom&&rect.bottom>popSize.height,left=sideLeft?rect.left-popSize.width:rect.right,top=sideUp?rect.bottom-popSize.height:rect.top):(sideLeft=this.canSideLeft&&rect.right+popSize.width>vpRect.right&&rect.left>popSize.width,sideUp=this.canSideUp&&rect.top+popSize.height>vpRect.bottom&&rect.bottom>popSize.height,left=sideLeft?rect.right-popSize.width:rect.left,top=sideUp?rect.top-popSize.height:rect.bottom);var popEl=this.getDom();uiUtils.setViewportOffset(popEl,{left:left,top:top}),domUtils.removeClasses(popEl,ANCHOR_CLASSES),popEl.className+=" "+ANCHOR_CLASSES[2*(sideUp?1:0)+(sideLeft?1:0)],this.editor&&(popEl.style.zIndex=1*this.editor.container.style.zIndex+10,baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=popEl.style.zIndex-1)},showAt:function(offset){var left=offset.left,top=offset.top,rect={left:left,top:top,right:left,bottom:top,height:0,width:0};this.showAnchorRect(rect,!1,!0)},_show:function(){if(this._hidden){var box=this.getDom();box.style.display="",this._hidden=!1,this.fireEvent("show")}},isHidden:function(){return this._hidden},show:function(){this._doAutoRender(),this._show()},hide:function(notNofity){!this._hidden&&this.getDom()&&(this.getDom().style.display="none",this._hidden=!0,notNofity||this.fireEvent("hide"))},queryAutoHide:function(el){return!el||!uiUtils.contains(this.getDom(),el)}},utils.inherits(Popup,UIBase),domUtils.on(document,"mousedown",function(evt){var el=evt.target||evt.srcElement;closeAllPopup(evt,el)}),domUtils.on(window,"scroll",function(evt,el){closeAllPopup(evt,el)})}(),function(){function genColorPicker(noColorText,editor){for(var html='<div id="##" class="edui-colorpicker %%"><div class="edui-colorpicker-topbar edui-clearfix"><div unselectable="on" id="##_preview" class="edui-colorpicker-preview"></div><div unselectable="on" class="edui-colorpicker-nocolor" onclick="$$._onPickNoColor(event, this);">'+noColorText+"</div>"+"</div>"+'<table  class="edui-box" style="border-collapse: collapse;" onmouseover="$$._onTableOver(event, this);" onmouseout="$$._onTableOut(event, this);" onclick="return $$._onTableClick(event, this);" cellspacing="0" cellpadding="0">'+'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;padding-top: 2px"><td colspan="10">'+editor.getLang("themeColor")+"</td> </tr>"+'<tr class="edui-colorpicker-tablefirstrow" >',i=0;i<COLORS.length;i++)i&&0===i%10&&(html+="</tr>"+(60==i?'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;"><td colspan="10">'+editor.getLang("standardColor")+"</td></tr>":"")+"<tr"+(60==i?' class="edui-colorpicker-tablefirstrow"':"")+">"),html+=70>i?'<td style="padding: 0 2px;"><a hidefocus title="'+COLORS[i]+'" onclick="return false;" href="javascript:" unselectable="on" class="edui-box edui-colorpicker-colorcell"'+' data-color="#'+COLORS[i]+'"'+' style="background-color:#'+COLORS[i]+";border:solid #ccc;"+(10>i||i>=60?"border-width:1px;":i>=10&&20>i?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"'+"></a></td>":"";return html+="</tr></table></div>"}var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,ColorPicker=baidu.editor.ui.ColorPicker=function(options){this.initOptions(options),this.noColorText=this.noColorText||this.editor.getLang("clearColor"),this.initUIBase()};ColorPicker.prototype={getHtmlTpl:function(){return genColorPicker(this.noColorText,this.editor)},_onTableClick:function(evt){var tgt=evt.target||evt.srcElement,color=tgt.getAttribute("data-color");color&&this.fireEvent("pickcolor",color)},_onTableOver:function(evt){var tgt=evt.target||evt.srcElement,color=tgt.getAttribute("data-color");color&&(this.getDom("preview").style.backgroundColor=color)},_onTableOut:function(){this.getDom("preview").style.backgroundColor=""},_onPickNoColor:function(){this.fireEvent("picknocolor")}},utils.inherits(ColorPicker,UIBase);var COLORS="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(",")}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,TablePicker=baidu.editor.ui.TablePicker=function(options){this.initOptions(options),this.initTablePicker()};TablePicker.prototype={defaultNumRows:10,defaultNumCols:10,maxNumRows:20,maxNumCols:20,numRows:10,numCols:10,lengthOfCellSide:22,initTablePicker:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-tablepicker %%"><div class="edui-tablepicker-body"><div class="edui-infoarea"><span id="##_label" class="edui-label"></span></div><div class="edui-pickarea" onmousemove="$$._onMouseMove(event, this);" onmouseover="$$._onMouseOver(event, this);" onmouseout="$$._onMouseOut(event, this);" onclick="$$._onClick(event, this);"><div id="##_overlay" class="edui-overlay"></div></div></div></div>'},_UIBase_render:UIBase.prototype.render,render:function(holder){this._UIBase_render(holder),this.getDom("label").innerHTML="0"+this.editor.getLang("t_row")+" x 0"+this.editor.getLang("t_col")},_track:function(numCols,numRows){var style=this.getDom("overlay").style,sideLen=this.lengthOfCellSide;style.width=numCols*sideLen+"px",style.height=numRows*sideLen+"px";var label=this.getDom("label");label.innerHTML=numCols+this.editor.getLang("t_col")+" x "+numRows+this.editor.getLang("t_row"),this.numCols=numCols,this.numRows=numRows},_onMouseOver:function(evt,el){var rel=evt.relatedTarget||evt.fromElement;uiUtils.contains(el,rel)||el===rel||(this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row"),this.getDom("overlay").style.visibility="")},_onMouseOut:function(evt,el){var rel=evt.relatedTarget||evt.toElement;uiUtils.contains(el,rel)||el===rel||(this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row"),this.getDom("overlay").style.visibility="hidden")},_onMouseMove:function(evt){this.getDom("overlay").style;var offset=uiUtils.getEventOffset(evt),sideLen=this.lengthOfCellSide,numCols=Math.ceil(offset.left/sideLen),numRows=Math.ceil(offset.top/sideLen);this._track(numCols,numRows)},_onClick:function(){this.fireEvent("picktable",this.numCols,this.numRows)}},utils.inherits(TablePicker,UIBase)}(),function(){var browser=baidu.editor.browser,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,TPL_STATEFUL='onmousedown="$$.Stateful_onMouseDown(event, this);" onmouseup="$$.Stateful_onMouseUp(event, this);"'+(browser.ie?' onmouseenter="$$.Stateful_onMouseEnter(event, this);" onmouseleave="$$.Stateful_onMouseLeave(event, this);"':' onmouseover="$$.Stateful_onMouseOver(event, this);" onmouseout="$$.Stateful_onMouseOut(event, this);"');baidu.editor.ui.Stateful={alwalysHoverable:!1,target:null,Stateful_init:function(){this._Stateful_dGetHtmlTpl=this.getHtmlTpl,this.getHtmlTpl=this.Stateful_getHtmlTpl},Stateful_getHtmlTpl:function(){var tpl=this._Stateful_dGetHtmlTpl();return tpl.replace(/stateful/g,function(){return TPL_STATEFUL})},Stateful_onMouseEnter:function(evt,el){this.target=el,(!this.isDisabled()||this.alwalysHoverable)&&(this.addState("hover"),this.fireEvent("over"))},Stateful_onMouseLeave:function(){(!this.isDisabled()||this.alwalysHoverable)&&(this.removeState("hover"),this.removeState("active"),this.fireEvent("out"))},Stateful_onMouseOver:function(evt,el){var rel=evt.relatedTarget;uiUtils.contains(el,rel)||el===rel||this.Stateful_onMouseEnter(evt,el)},Stateful_onMouseOut:function(evt,el){var rel=evt.relatedTarget;uiUtils.contains(el,rel)||el===rel||this.Stateful_onMouseLeave(evt,el)},Stateful_onMouseDown:function(){this.isDisabled()||this.addState("active")},Stateful_onMouseUp:function(){this.isDisabled()||this.removeState("active")},Stateful_postRender:function(){this.disabled&&!this.hasState("disabled")&&this.addState("disabled")},hasState:function(state){return domUtils.hasClass(this.getStateDom(),"edui-state-"+state)},addState:function(state){this.hasState(state)||(this.getStateDom().className+=" edui-state-"+state)},removeState:function(state){this.hasState(state)&&domUtils.removeClasses(this.getStateDom(),["edui-state-"+state])},getStateDom:function(){return this.getDom("state")},isChecked:function(){return this.hasState("checked")},setChecked:function(checked){!this.isDisabled()&&checked?this.addState("checked"):this.removeState("checked")},isDisabled:function(){return this.hasState("disabled")},setDisabled:function(disabled){disabled?(this.removeState("hover"),this.removeState("checked"),this.removeState("active"),this.addState("disabled")):this.removeState("disabled")}}}(),function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Stateful=baidu.editor.ui.Stateful,Button=baidu.editor.ui.Button=function(options){this.initOptions(options),this.initButton()};Button.prototype={uiName:"button",label:"",title:"",showIcon:!0,showText:!0,initButton:function(){this.initUIBase(),this.Stateful_init()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div id="##_state" stateful><div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onmousedown="return false;" onclick="return $$._onClick();">'+(this.showIcon?'<div class="edui-box edui-icon"></div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"</div>":"")+"</div>"+"</div>"+"</div></div>"},postRender:function(){this.Stateful_postRender(),this.setDisabled(this.disabled)},_onClick:function(){this.isDisabled()||this.fireEvent("click")}},utils.inherits(Button,UIBase),utils.extend(Button.prototype,Stateful)}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=(baidu.editor.dom.domUtils,baidu.editor.ui.UIBase),Stateful=baidu.editor.ui.Stateful,SplitButton=baidu.editor.ui.SplitButton=function(options){this.initOptions(options),this.initSplitButton()};SplitButton.prototype={popup:null,uiName:"splitbutton",title:"",initSplitButton:function(){if(this.initUIBase(),this.Stateful_init(),null!=this.popup){var popup=this.popup;this.popup=null,this.setPopup(popup)}},_UIBase_postRender:UIBase.prototype.postRender,postRender:function(){this.Stateful_postRender(),this._UIBase_postRender()},setPopup:function(popup){this.popup!==popup&&(null!=this.popup&&this.popup.dispose(),popup.addListener("show",utils.bind(this._onPopupShow,this)),popup.addListener("hide",utils.bind(this._onPopupHide,this)),popup.addListener("postrender",utils.bind(function(){popup.getDom("body").appendChild(uiUtils.createElementByHtml('<div id="'+this.popup.id+'_bordereraser" class="edui-bordereraser edui-background" style="width:'+(uiUtils.getClientRect(this.getDom()).width-2)+'px"></div>')),popup.getDom().className+=" "+this.className},this)),this.popup=popup)},_onPopupShow:function(){this.addState("opened")},_onPopupHide:function(){this.removeState("opened")},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body">'+'<div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);">'+'<div class="edui-box edui-icon"></div>'+"</div>"+'<div class="edui-box edui-splitborder"></div>'+'<div class="edui-box edui-arrow" onclick="$$._onArrowClick();"></div>'+"</div></div></div>"},showPopup:function(){var rect=uiUtils.getClientRect(this.getDom());rect.top-=this.popup.SHADOW_RADIUS,rect.height+=this.popup.SHADOW_RADIUS,this.popup.showAnchorRect(rect)},_onArrowClick:function(){this.isDisabled()||this.showPopup()},_onButtonClick:function(){this.isDisabled()||this.fireEvent("buttonclick")}},utils.inherits(SplitButton,UIBase),utils.extend(SplitButton.prototype,Stateful,!0)}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,ColorPicker=baidu.editor.ui.ColorPicker,Popup=baidu.editor.ui.Popup,SplitButton=baidu.editor.ui.SplitButton,ColorButton=baidu.editor.ui.ColorButton=function(options){this.initOptions(options),this.initColorButton()};ColorButton.prototype={initColorButton:function(){var me=this;this.popup=new Popup({content:new ColorPicker({noColorText:me.editor.getLang("clearColor"),editor:me.editor,onpickcolor:function(t,color){me._onPickColor(color)},onpicknocolor:function(t,color){me._onPickNoColor(color)}}),editor:me.editor}),this.initSplitButton()},_SplitButton_postRender:SplitButton.prototype.postRender,postRender:function(){this._SplitButton_postRender(),this.getDom("button_body").appendChild(uiUtils.createElementByHtml('<div id="'+this.id+'_colorlump" class="edui-colorlump"></div>')),this.getDom().className+=" edui-colorbutton"},setColor:function(color){this.getDom("colorlump").style.backgroundColor=color,this.color=color},_onPickColor:function(color){this.fireEvent("pickcolor",color)!==!1&&(this.setColor(color),this.popup.hide())},_onPickNoColor:function(){this.fireEvent("picknocolor")!==!1&&this.popup.hide()}},utils.inherits(ColorButton,SplitButton)}(),function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,TablePicker=baidu.editor.ui.TablePicker,SplitButton=baidu.editor.ui.SplitButton,TableButton=baidu.editor.ui.TableButton=function(options){this.initOptions(options),this.initTableButton()};TableButton.prototype={initTableButton:function(){var me=this;this.popup=new Popup({content:new TablePicker({editor:me.editor,onpicktable:function(t,numCols,numRows){me._onPickTable(numCols,numRows)}}),editor:me.editor}),this.initSplitButton()},_onPickTable:function(numCols,numRows){this.fireEvent("picktable",numCols,numRows)!==!1&&this.popup.hide()}},utils.inherits(TableButton,SplitButton)}(),function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,AutoTypeSetPicker=baidu.editor.ui.AutoTypeSetPicker=function(options){this.initOptions(options),this.initAutoTypeSetPicker()};AutoTypeSetPicker.prototype={initAutoTypeSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){var me=this.editor,opt=me.options.autotypeset,lang=me.getLang("autoTypeSet"),textAlignInputName="textAlignValue"+me.uid,imageBlockInputName="imageBlockLineValue"+me.uid;return'<div id="##" class="edui-autotypesetpicker %%"><div class="edui-autotypesetpicker-body"><table ><tr><td nowrap colspan="2"><input type="checkbox" name="mergeEmptyline" '+(opt.mergeEmptyline?"checked":"")+">"+lang.mergeLine+'</td><td colspan="2"><input type="checkbox" name="removeEmptyline" '+(opt.removeEmptyline?"checked":"")+">"+lang.delLine+"</td></tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="removeClass" '+(opt.removeClass?"checked":"")+">"+lang.removeFormat+'</td><td colspan="2"><input type="checkbox" name="indent" '+(opt.indent?"checked":"")+">"+lang.indent+"</td></tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="textAlign" '+(opt.textAlign?"checked":"")+">"+lang.alignment+'</td><td colspan="2" id="'+textAlignInputName+'"><input type="radio" name="'+textAlignInputName+'" value="left" '+(opt.textAlign&&"left"==opt.textAlign?"checked":"")+">"+me.getLang("justifyleft")+'<input type="radio" name="'+textAlignInputName+'" value="center" '+(opt.textAlign&&"center"==opt.textAlign?"checked":"")+">"+me.getLang("justifycenter")+'<input type="radio" name="'+textAlignInputName+'" value="right" '+(opt.textAlign&&"right"==opt.textAlign?"checked":"")+">"+me.getLang("justifyright")+" </tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="imageBlockLine" '+(opt.imageBlockLine?"checked":"")+">"+lang.imageFloat+"</td>"+'<td nowrap colspan="2" id="'+imageBlockInputName+'">'+'<input type="radio" name="'+imageBlockInputName+'" value="none" '+(opt.imageBlockLine&&"none"==opt.imageBlockLine?"checked":"")+">"+me.getLang("default")+'<input type="radio" name="'+imageBlockInputName+'" value="left" '+(opt.imageBlockLine&&"left"==opt.imageBlockLine?"checked":"")+">"+me.getLang("justifyleft")+'<input type="radio" name="'+imageBlockInputName+'" value="center" '+(opt.imageBlockLine&&"center"==opt.imageBlockLine?"checked":"")+">"+me.getLang("justifycenter")+'<input type="radio" name="'+imageBlockInputName+'" value="right" '+(opt.imageBlockLine&&"right"==opt.imageBlockLine?"checked":"")+">"+me.getLang("justifyright")+"</tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="clearFontSize" '+(opt.clearFontSize?"checked":"")+">"+lang.removeFontsize+'</td><td colspan="2"><input type="checkbox" name="clearFontFamily" '+(opt.clearFontFamily?"checked":"")+">"+lang.removeFontFamily+"</td></tr>"+'<tr><td nowrap colspan="4"><input type="checkbox" name="removeEmptyNode" '+(opt.removeEmptyNode?"checked":"")+">"+lang.removeHtml+"</td></tr>"+'<tr><td nowrap colspan="4"><input type="checkbox" name="pasteFilter" '+(opt.pasteFilter?"checked":"")+">"+lang.pasteFilter+"</td></tr>"+'<tr><td nowrap colspan="4" align="right"><button >'+lang.run+"</button></td></tr>"+"</table>"+"</div>"+"</div>"},_UIBase_render:UIBase.prototype.render},utils.inherits(AutoTypeSetPicker,UIBase)}(),function(){function getPara(me){for(var ipt,opt=me.editor.options.autotypeset,cont=me.getDom(),editorId=me.editor.uid,inputType=null,attrName=null,ipts=domUtils.getElementsByTagName(cont,"input"),i=ipts.length-1;ipt=ipts[i--];)if(inputType=ipt.getAttribute("type"),"checkbox"==inputType&&(attrName=ipt.getAttribute("name"),opt[attrName]&&delete opt[attrName],ipt.checked)){var attrValue=document.getElementById(attrName+"Value"+editorId);if(attrValue){if(/input/gi.test(attrValue.tagName))opt[attrName]=attrValue.value;else for(var iptchild,iptChilds=attrValue.getElementsByTagName("input"),j=iptChilds.length-1;iptchild=iptChilds[j--];)if(iptchild.checked){opt[attrName]=iptchild.value;break}}else opt[attrName]=!0}for(var si,selects=domUtils.getElementsByTagName(cont,"select"),i=0;si=selects[i++];){var attr=si.getAttribute("name");opt[attr]=opt[attr]?si.value:""}me.editor.options.autotypeset=opt}var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,AutoTypeSetPicker=baidu.editor.ui.AutoTypeSetPicker,SplitButton=baidu.editor.ui.SplitButton,AutoTypeSetButton=baidu.editor.ui.AutoTypeSetButton=function(options){this.initOptions(options),this.initAutoTypeSetButton()};AutoTypeSetButton.prototype={initAutoTypeSetButton:function(){var me=this;this.popup=new Popup({content:new AutoTypeSetPicker({editor:me.editor}),editor:me.editor,hide:function(){!this._hidden&&this.getDom()&&(getPara(this),this.getDom().style.display="none",this._hidden=!0,this.fireEvent("hide"))}});var flag=0;this.popup.addListener("postRenderAfter",function(){var popupUI=this;if(!flag){var cont=this.getDom(),btn=cont.getElementsByTagName("button")[0];btn.onclick=function(){getPara(popupUI),me.editor.execCommand("autotypeset"),popupUI.hide()},flag=1}}),this.initSplitButton()}},utils.inherits(AutoTypeSetButton,SplitButton)}(),function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,Stateful=baidu.editor.ui.Stateful,UIBase=baidu.editor.ui.UIBase,CellAlignPicker=baidu.editor.ui.CellAlignPicker=function(options){this.initOptions(options),this.initSelected(),this.initCellAlignPicker()};CellAlignPicker.prototype={initSelected:function(){var status={valign:{top:0,middle:1,bottom:2},align:{left:0,center:1,right:2},count:3};this.selected&&(this.selectedIndex=status.valign[this.selected.valign]*status.count+status.align[this.selected.align])},initCellAlignPicker:function(){this.initUIBase(),this.Stateful_init()},getHtmlTpl:function(){for(var alignType=["left","center","right"],COUNT=9,tempClassName=null,tempIndex=-1,tmpl=[],i=0;COUNT>i;i++)tempClassName=this.selectedIndex===i?' class="edui-cellalign-selected" ':"",tempIndex=i%3,0===tempIndex&&tmpl.push("<tr>"),tmpl.push('<td index="'+i+'" '+tempClassName+' stateful><div class="edui-icon edui-'+alignType[tempIndex]+'"></div></td>'),2===tempIndex&&tmpl.push("</tr>");return'<div id="##" class="edui-cellalignpicker %%"><div class="edui-cellalignpicker-body"><table onclick="$$._onClick(event);">'+tmpl.join("")+"</table>"+"</div>"+"</div>"},getStateDom:function(){return this.target},_onClick:function(evt){var target=evt.target||evt.srcElement;/icon/.test(target.className)&&(this.items[target.parentNode.getAttribute("index")].onclick(),Popup.postHide(evt))},_UIBase_render:UIBase.prototype.render},utils.inherits(CellAlignPicker,UIBase),utils.extend(CellAlignPicker.prototype,Stateful,!0)}(),function(){var utils=baidu.editor.utils,Stateful=baidu.editor.ui.Stateful,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,PastePicker=baidu.editor.ui.PastePicker=function(options){this.initOptions(options),this.initPastePicker()};PastePicker.prototype={initPastePicker:function(){this.initUIBase(),this.Stateful_init()},getHtmlTpl:function(){return'<div class="edui-pasteicon" onclick="$$._onClick(this)"></div><div class="edui-pastecontainer"><div class="edui-title">'+this.editor.getLang("pasteOpt")+"</div>"+'<div class="edui-button">'+'<div title="'+this.editor.getLang("pasteSourceFormat")+'" onclick="$$.format(false)" stateful>'+'<div class="edui-richtxticon"></div></div>'+'<div title="'+this.editor.getLang("tagFormat")+'" onclick="$$.format(2)" stateful>'+'<div class="edui-tagicon"></div></div>'+'<div title="'+this.editor.getLang("pasteTextFormat")+'" onclick="$$.format(true)" stateful>'+'<div class="edui-plaintxticon"></div></div>'+"</div>"+"</div>"+"</div>"
},getStateDom:function(){return this.target},format:function(param){this.editor.ui._isTransfer=!0,this.editor.fireEvent("pasteTransfer",param)},_onClick:function(cur){var node=domUtils.getNextDomNode(cur),screenHt=uiUtils.getViewportRect().height,subPop=uiUtils.getClientRect(node);node.style.top=subPop.top+subPop.height>screenHt?-subPop.height-cur.offsetHeight+"px":"",/hidden/gi.test(domUtils.getComputedStyle(node,"visibility"))?(node.style.visibility="visible",domUtils.addClass(cur,"edui-state-opened")):(node.style.visibility="hidden",domUtils.removeClasses(cur,"edui-state-opened"))},_UIBase_render:UIBase.prototype.render},utils.inherits(PastePicker,UIBase),utils.extend(PastePicker.prototype,Stateful,!0)}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,Toolbar=baidu.editor.ui.Toolbar=function(options){this.initOptions(options),this.initToolbar()};Toolbar.prototype={items:null,initToolbar:function(){this.items=this.items||[],this.initUIBase()},add:function(item){this.items.push(item)},getHtmlTpl:function(){for(var buff=[],i=0;i<this.items.length;i++)buff[i]=this.items[i].renderHtml();return'<div id="##" class="edui-toolbar %%" onselectstart="return false;" onmousedown="return $$._onMouseDown(event, this);">'+buff.join("")+"</div>"},postRender:function(){for(var box=this.getDom(),i=0;i<this.items.length;i++)this.items[i].postRender();uiUtils.makeUnselectable(box)},_onMouseDown:function(){return!1}},utils.inherits(Toolbar,UIBase)}(),function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,Popup=baidu.editor.ui.Popup,Stateful=baidu.editor.ui.Stateful,CellAlignPicker=baidu.editor.ui.CellAlignPicker,Menu=baidu.editor.ui.Menu=function(options){this.initOptions(options),this.initMenu()},menuSeparator={renderHtml:function(){return'<div class="edui-menuitem edui-menuseparator"><div class="edui-menuseparator-inner"></div></div>'},postRender:function(){},queryAutoHide:function(){return!0}};Menu.prototype={items:null,uiName:"menu",initMenu:function(){this.items=this.items||[],this.initPopup(),this.initItems()},initItems:function(){for(var i=0;i<this.items.length;i++){var item=this.items[i];"-"==item?this.items[i]=this.getSeparator():item instanceof MenuItem||(item.editor=this.editor,item.theme=this.editor.options.theme,this.items[i]=this.createItem(item))}},getSeparator:function(){return menuSeparator},createItem:function(item){return item.menu=this,new MenuItem(item)},_Popup_getContentHtmlTpl:Popup.prototype.getContentHtmlTpl,getContentHtmlTpl:function(){if(0==this.items.length)return this._Popup_getContentHtmlTpl();for(var buff=[],i=0;i<this.items.length;i++){var item=this.items[i];buff[i]=item.renderHtml()}return'<div class="%%-body">'+buff.join("")+"</div>"},_Popup_postRender:Popup.prototype.postRender,postRender:function(){for(var me=this,i=0;i<this.items.length;i++){var item=this.items[i];item.ownerMenu=this,item.postRender()}domUtils.on(this.getDom(),"mouseover",function(evt){evt=evt||event;var rel=evt.relatedTarget||evt.fromElement,el=me.getDom();uiUtils.contains(el,rel)||el===rel||me.fireEvent("over")}),this._Popup_postRender()},queryAutoHide:function(el){if(el){if(uiUtils.contains(this.getDom(),el))return!1;for(var i=0;i<this.items.length;i++){var item=this.items[i];if(item.queryAutoHide(el)===!1)return!1}}},clearItems:function(){for(var i=0;i<this.items.length;i++){var item=this.items[i];clearTimeout(item._showingTimer),clearTimeout(item._closingTimer),item.subMenu&&item.subMenu.destroy()}this.items=[]},destroy:function(){this.getDom()&&domUtils.remove(this.getDom()),this.clearItems()},dispose:function(){this.destroy()}},utils.inherits(Menu,Popup);var MenuItem=baidu.editor.ui.MenuItem=function(options){if(this.initOptions(options),this.initUIBase(),this.Stateful_init(),this.subMenu&&!(this.subMenu instanceof Menu))if(options.className&&-1!=options.className.indexOf("aligntd")){var me=this;this.subMenu.selected=this.editor.queryCommandValue("cellalignment"),this.subMenu=new Popup({content:new CellAlignPicker(this.subMenu),parentMenu:me,editor:me.editor,destroy:function(){this.getDom()&&domUtils.remove(this.getDom())}}),this.subMenu.addListener("postRenderAfter",function(){domUtils.on(this.getDom(),"mouseover",function(){me.addState("opened")})})}else this.subMenu=new Menu(this.subMenu)};MenuItem.prototype={label:"",subMenu:null,ownerMenu:null,uiName:"menuitem",alwalysHoverable:!0,getHtmlTpl:function(){return'<div id="##" class="%%" stateful onclick="$$._onClick(event, this);"><div class="%%-body">'+this.renderLabelHtml()+"</div>"+"</div>"},postRender:function(){var me=this;this.addListener("over",function(){me.ownerMenu.fireEvent("submenuover",me),me.subMenu&&me.delayShowSubMenu()}),this.subMenu&&(this.getDom().className+=" edui-hassubmenu",this.subMenu.render(),this.addListener("out",function(){me.delayHideSubMenu()}),this.subMenu.addListener("over",function(){clearTimeout(me._closingTimer),me._closingTimer=null,me.addState("opened")}),this.ownerMenu.addListener("hide",function(){me.hideSubMenu()}),this.ownerMenu.addListener("submenuover",function(t,subMenu){subMenu!==me&&me.delayHideSubMenu()}),this.subMenu._bakQueryAutoHide=this.subMenu.queryAutoHide,this.subMenu.queryAutoHide=function(el){return el&&uiUtils.contains(me.getDom(),el)?!1:this._bakQueryAutoHide(el)}),this.getDom().style.tabIndex="-1",uiUtils.makeUnselectable(this.getDom()),this.Stateful_postRender()},delayShowSubMenu:function(){var me=this;me.isDisabled()||(me.addState("opened"),clearTimeout(me._showingTimer),clearTimeout(me._closingTimer),me._closingTimer=null,me._showingTimer=setTimeout(function(){me.showSubMenu()},250))},delayHideSubMenu:function(){var me=this;me.isDisabled()||(me.removeState("opened"),clearTimeout(me._showingTimer),me._closingTimer||(me._closingTimer=setTimeout(function(){me.hasState("opened")||me.hideSubMenu(),me._closingTimer=null},400)))},renderLabelHtml:function(){return'<div class="edui-arrow"></div><div class="edui-box edui-icon"></div><div class="edui-box edui-label %%-label">'+(this.label||"")+"</div>"},getStateDom:function(){return this.getDom()},queryAutoHide:function(el){return this.subMenu&&this.hasState("opened")?this.subMenu.queryAutoHide(el):void 0},_onClick:function(event,this_){this.hasState("disabled")||this.fireEvent("click",event,this_)!==!1&&(this.subMenu?this.showSubMenu():Popup.postHide(event))},showSubMenu:function(){var rect=uiUtils.getClientRect(this.getDom());rect.right-=5,rect.left+=2,rect.width-=7,rect.top-=4,rect.bottom+=4,rect.height+=8,this.subMenu.showAnchorRect(rect,!0,!0)},hideSubMenu:function(){this.subMenu.hide()}},utils.inherits(MenuItem,UIBase),utils.extend(MenuItem.prototype,Stateful,!0)}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,Menu=baidu.editor.ui.Menu,SplitButton=baidu.editor.ui.SplitButton,Combox=baidu.editor.ui.Combox=function(options){this.initOptions(options),this.initCombox()};Combox.prototype={uiName:"combox",initCombox:function(){var me=this;this.items=this.items||[];for(var i=0;i<this.items.length;i++){var item=this.items[i];item.uiName="listitem",item.index=i,item.onclick=function(){me.selectByIndex(this.index)}}this.popup=new Menu({items:this.items,uiName:"list",editor:this.editor}),this.initSplitButton()},_SplitButton_postRender:SplitButton.prototype.postRender,postRender:function(){this._SplitButton_postRender(),this.setLabel(this.label||""),this.setValue(this.initValue||"")},showPopup:function(){var rect=uiUtils.getClientRect(this.getDom());rect.top+=1,rect.bottom-=1,rect.height-=2,this.popup.showAnchorRect(rect)},getValue:function(){return this.value},setValue:function(value){var index=this.indexByValue(value);-1!=index?(this.selectedIndex=index,this.setLabel(this.items[index].label),this.value=this.items[index].value):(this.selectedIndex=-1,this.setLabel(this.getLabelForUnknowValue(value)),this.value=value)},setLabel:function(label){this.getDom("button_body").innerHTML=label,this.label=label},getLabelForUnknowValue:function(value){return value},indexByValue:function(value){for(var i=0;i<this.items.length;i++)if(value==this.items[i].value)return i;return-1},getItem:function(index){return this.items[index]},selectByIndex:function(index){index<this.items.length&&this.fireEvent("select",index)!==!1&&(this.selectedIndex=index,this.value=this.items[index].value,this.setLabel(this.items[index].label))}},utils.inherits(Combox,SplitButton)}(),function(){var modalMask,dragMask,utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,Mask=baidu.editor.ui.Mask,UIBase=baidu.editor.ui.UIBase,Button=baidu.editor.ui.Button,Dialog=baidu.editor.ui.Dialog=function(options){this.initOptions(utils.extend({autoReset:!0,draggable:!0,onok:function(){},oncancel:function(){},onclose:function(t,ok){return ok?this.onok():this.oncancel()},holdScroll:!1},options)),this.initDialog()};Dialog.prototype={draggable:!1,uiName:"dialog",initDialog:function(){var me=this,theme=this.editor.options.theme;if(this.initUIBase(),this.modalMask=modalMask||(modalMask=new Mask({className:"edui-dialog-modalmask",theme:theme})),this.dragMask=dragMask||(dragMask=new Mask({className:"edui-dialog-dragmask",theme:theme})),this.closeButton=new Button({className:"edui-dialog-closebutton",title:me.closeDialog,theme:theme,onclick:function(){me.close(!1)}}),this.buttons)for(var i=0;i<this.buttons.length;i++)this.buttons[i]instanceof Button||(this.buttons[i]=new Button(this.buttons[i]))},fitSize:function(){var popBodyEl=this.getDom("body"),size=this.mesureSize();return popBodyEl.style.width=size.width+"px",popBodyEl.style.height=size.height+"px",size},safeSetOffset:function(offset){var me=this,el=me.getDom(),vpRect=uiUtils.getViewportRect(),rect=uiUtils.getClientRect(el),left=offset.left;left+rect.width>vpRect.right&&(left=vpRect.right-rect.width);var top=offset.top;top+rect.height>vpRect.bottom&&(top=vpRect.bottom-rect.height),el.style.left=Math.max(left,0)+"px",el.style.top=Math.max(top,0)+"px"},showAtCenter:function(){this.getDom().style.display="";var vpRect=uiUtils.getViewportRect(),popSize=this.fitSize(),titleHeight=0|this.getDom("titlebar").offsetHeight,left=vpRect.width/2-popSize.width/2,top=vpRect.height/2-(popSize.height-titleHeight)/2-titleHeight,popEl=this.getDom();this.safeSetOffset({left:Math.max(0|left,0),top:Math.max(0|top,0)}),domUtils.hasClass(popEl,"edui-state-centered")||(popEl.className+=" edui-state-centered"),this._show()},getContentHtml:function(){var contentHtml="";return"string"==typeof this.content?contentHtml=this.content:this.iframeUrl&&(contentHtml='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><iframe id="'+this.id+'_iframe" class="%%-iframe" height="100%" width="100%" frameborder="0" src="'+this.iframeUrl+'"></iframe>'),contentHtml},getHtmlTpl:function(){var footHtml="";if(this.buttons){for(var buff=[],i=0;i<this.buttons.length;i++)buff[i]=this.buttons[i].renderHtml();footHtml='<div class="%%-foot"><div id="##_buttons" class="%%-buttons">'+buff.join("")+"</div>"+"</div>"}return'<div id="##" class="%%"><div class="%%-wrap"><div id="##_body" class="%%-body"><div class="%%-shadow"></div><div id="##_titlebar" class="%%-titlebar"><div class="%%-draghandle" onmousedown="$$._onTitlebarMouseDown(event, this);"><span class="%%-caption">'+(this.title||"")+"</span>"+"</div>"+this.closeButton.renderHtml()+"</div>"+'<div id="##_content" class="%%-content">'+(this.autoReset?"":this.getContentHtml())+"</div>"+footHtml+"</div></div></div>"},postRender:function(){this.modalMask.getDom()||(this.modalMask.render(),this.modalMask.hide()),this.dragMask.getDom()||(this.dragMask.render(),this.dragMask.hide());var me=this;if(this.addListener("show",function(){me.modalMask.show(this.getDom().style.zIndex-2)}),this.addListener("hide",function(){me.modalMask.hide()}),this.buttons)for(var i=0;i<this.buttons.length;i++)this.buttons[i].postRender();domUtils.on(window,"resize",function(){setTimeout(function(){me.isHidden()||me.safeSetOffset(uiUtils.getClientRect(me.getDom()))})}),this.holdScroll&&(me.iframeUrl?me.addListener("dialogafterreset",function(){window.setTimeout(function(){var iframeWindow=document.getElementById(me.id+"_iframe").contentWindow;if(browser.ie)var timer=window.setInterval(function(){iframeWindow.document&&iframeWindow.document.body&&(window.clearInterval(timer),timer=null,domUtils.on(iframeWindow.document.body,browser.gecko?"DOMMouseScroll":"mousewheel",function(e){domUtils.preventDefault(e)}))},100);else domUtils.on(iframeWindow,browser.gecko?"DOMMouseScroll":"mousewheel",function(e){domUtils.preventDefault(e)})},1)}):domUtils.on(document.getElementById(me.id+"_iframe"),browser.gecko?"DOMMouseScroll":"mousewheel",function(e){domUtils.preventDefault(e)})),this._hide()},mesureSize:function(){var body=this.getDom("body"),width=uiUtils.getClientRect(this.getDom("content")).width,dialogBodyStyle=body.style;return dialogBodyStyle.width=width,uiUtils.getClientRect(body)},_onTitlebarMouseDown:function(evt){if(this.draggable){var rect;uiUtils.getViewportRect();var me=this;uiUtils.startDrag(evt,{ondragstart:function(){rect=uiUtils.getClientRect(me.getDom()),me.getDom("contmask").style.visibility="visible",me.dragMask.show(me.getDom().style.zIndex-1)},ondragmove:function(x,y){var left=rect.left+x,top=rect.top+y;me.safeSetOffset({left:left,top:top})},ondragstop:function(){me.getDom("contmask").style.visibility="hidden",domUtils.removeClasses(me.getDom(),["edui-state-centered"]),me.dragMask.hide()}})}},reset:function(){this.getDom("content").innerHTML=this.getContentHtml(),this.fireEvent("dialogafterreset")},_show:function(){this._hidden&&(this.getDom().style.display="",this.editor.container.style.zIndex&&(this.getDom().style.zIndex=1*this.editor.container.style.zIndex+10),this._hidden=!1,this.fireEvent("show"),baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=this.getDom().style.zIndex-4)},isHidden:function(){return this._hidden},_hide:function(){this._hidden||(this.getDom().style.display="none",this.getDom().style.zIndex="",this._hidden=!0,this.fireEvent("hide"))},open:function(){if(this.autoReset)try{this.reset()}catch(e){this.render(),this.open()}if(this.showAtCenter(),this.iframeUrl)try{this.getDom("iframe").focus()}catch(ex){}},_onCloseButtonClick:function(){this.close(!1)},close:function(ok){this.fireEvent("close",ok)!==!1&&this._hide()}},utils.inherits(Dialog,UIBase)}(),function(){var utils=baidu.editor.utils,Menu=baidu.editor.ui.Menu,SplitButton=baidu.editor.ui.SplitButton,MenuButton=baidu.editor.ui.MenuButton=function(options){this.initOptions(options),this.initMenuButton()};MenuButton.prototype={initMenuButton:function(){var me=this;this.uiName="menubutton",this.popup=new Menu({items:me.items,className:me.className,editor:me.editor}),this.popup.addListener("show",function(){for(var list=this,i=0;i<list.items.length;i++)list.items[i].removeState("checked"),list.items[i].value==me._value&&(list.items[i].addState("checked"),this.value=me._value)}),this.initSplitButton()},setValue:function(value){this._value=value}},utils.inherits(MenuButton,SplitButton)}(),function(){var utils=baidu.editor.utils,editorui=baidu.editor.ui,_Dialog=editorui.Dialog;editorui.buttons={},editorui.Dialog=function(options){var dialog=new _Dialog(options);return dialog.addListener("hide",function(){if(dialog.editor){var editor=dialog.editor;try{if(browser.gecko){var y=editor.window.scrollY,x=editor.window.scrollX;editor.body.focus(),editor.window.scrollTo(x,y)}else editor.focus()}catch(ex){}}}),dialog};for(var ci,iframeUrlMap={anchor:"~/dialogs/anchor/anchor.html",insertimage:"~/dialogs/image/image.html",link:"~/dialogs/link/link.html",spechars:"~/dialogs/spechars/spechars.html",searchreplace:"~/dialogs/searchreplace/searchreplace.html",map:"~/dialogs/map/map.html",gmap:"~/dialogs/gmap/gmap.html",insertvideo:"~/dialogs/video/video.html",help:"~/dialogs/help/help.html",emotion:"~/dialogs/emotion/emotion.html",wordimage:"~/dialogs/wordimage/wordimage.html",attachment:"~/dialogs/attachment/attachment.html",insertframe:"~/dialogs/insertframe/insertframe.html",edittip:"~/dialogs/table/edittip.html",edittable:"~/dialogs/table/edittable.html",edittd:"~/dialogs/table/edittd.html",webapp:"~/dialogs/webapp/webapp.html",snapscreen:"~/dialogs/snapscreen/snapscreen.html",scrawl:"~/dialogs/scrawl/scrawl.html",music:"~/dialogs/music/music.html",template:"~/dialogs/template/template.html",background:"~/dialogs/background/background.html"},btnCmds=["undo","redo","formatmatch","bold","italic","underline","fontborder","touppercase","tolowercase","strikethrough","subscript","superscript","source","indent","outdent","blockquote","pasteplain","pagebreak","selectall","print","preview","horizontal","removeformat","time","date","unlink","insertparagraphbeforetable","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","mergecells","deletetable"],i=0;ci=btnCmds[i++];)ci=ci.toLowerCase(),editorui[ci]=function(cmd){return function(editor){var ui=new editorui.Button({className:"edui-for-"+cmd,title:editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"",onclick:function(){editor.execCommand(cmd)},theme:editor.options.theme,showText:!1});return editorui.buttons[cmd]=ui,editor.addListener("selectionchange",function(type,causeByUi,uiReady){var state=editor.queryCommandState(cmd);-1==state?(ui.setDisabled(!0),ui.setChecked(!1)):uiReady||(ui.setDisabled(!1),ui.setChecked(state))}),ui}}(ci);editorui.cleardoc=function(editor){var ui=new editorui.Button({className:"edui-for-cleardoc",title:editor.options.labelMap.cleardoc||editor.getLang("labelMap.cleardoc")||"",theme:editor.options.theme,onclick:function(){confirm(editor.getLang("confirmClear"))&&editor.execCommand("cleardoc")}});return editorui.buttons.cleardoc=ui,editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState("cleardoc"))}),ui};var typeset={justify:["left","right","center","justify"],imagefloat:["none","left","center","right"],directionality:["ltr","rtl"]};for(var p in typeset)!function(cmd,val){for(var ci,i=0;ci=val[i++];)!function(cmd2){editorui[cmd.replace("float","")+cmd2]=function(editor){var ui=new editorui.Button({className:"edui-for-"+cmd.replace("float","")+cmd2,title:editor.options.labelMap[cmd.replace("float","")+cmd2]||editor.getLang("labelMap."+cmd.replace("float","")+cmd2)||"",theme:editor.options.theme,onclick:function(){editor.execCommand(cmd,cmd2)}});return editorui.buttons[cmd]=ui,editor.addListener("selectionchange",function(type,causeByUi,uiReady){ui.setDisabled(-1==editor.queryCommandState(cmd)),ui.setChecked(editor.queryCommandValue(cmd)==cmd2&&!uiReady)}),ui}}(ci)}(p,typeset[p]);for(var ci,i=0;ci=["backcolor","forecolor"][i++];)editorui[ci]=function(cmd){return function(editor){var ui=new editorui.ColorButton({className:"edui-for-"+cmd,color:"default",title:editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"",editor:editor,onpickcolor:function(t,color){editor.execCommand(cmd,color)},onpicknocolor:function(){editor.execCommand(cmd,"default"),this.setColor("transparent"),this.color="default"},onbuttonclick:function(){editor.execCommand(cmd,this.color)}});return editorui.buttons[cmd]=ui,editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState(cmd))}),ui}}(ci);var dialogBtns={noOk:["searchreplace","help","spechars","webapp"],ok:["attachment","anchor","link","insertimage","map","gmap","insertframe","wordimage","insertvideo","insertframe","edittip","edittable","edittd","scrawl","template","music","background"]};for(var p in dialogBtns)!function(type,vals){for(var ci,i=0;ci=vals[i++];)browser.opera&&"searchreplace"===ci||function(cmd){editorui[cmd]=function(editor,iframeUrl,title){iframeUrl=iframeUrl||(editor.options.iframeUrlMap||{})[cmd]||iframeUrlMap[cmd],title=editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"";var dialog;iframeUrl&&(dialog=new editorui.Dialog(utils.extend({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:"edui-for-"+cmd,title:title,holdScroll:"insertimage"===cmd,closeDialog:editor.getLang("closeDialog")},"ok"==type?{buttons:[{className:"edui-okbutton",label:editor.getLang("ok"),editor:editor,onclick:function(){dialog.close(!0)}},{className:"edui-cancelbutton",label:editor.getLang("cancel"),editor:editor,onclick:function(){dialog.close(!1)}}]}:{})),editor.ui._dialogs[cmd+"Dialog"]=dialog);var ui=new editorui.Button({className:"edui-for-"+cmd,title:title,onclick:function(){if(dialog)switch(cmd){case"wordimage":editor.execCommand("wordimage","word_img"),editor.word_img&&(dialog.render(),dialog.open());break;case"scrawl":-1!=editor.queryCommandState("scrawl")&&(dialog.render(),dialog.open());break;default:dialog.render(),dialog.open()}},theme:editor.options.theme,disabled:"scrawl"==cmd&&-1==editor.queryCommandState("scrawl")});return editorui.buttons[cmd]=ui,editor.addListener("selectionchange",function(){var unNeedCheckState={edittable:1};if(!(cmd in unNeedCheckState)){var state=editor.queryCommandState(cmd);ui.getDom()&&(ui.setDisabled(-1==state),ui.setChecked(state))}}),ui}}(ci.toLowerCase())}(p,dialogBtns[p]);editorui.snapscreen=function(editor,iframeUrl,title){title=editor.options.labelMap.snapscreen||editor.getLang("labelMap.snapscreen")||"";var ui=new editorui.Button({className:"edui-for-snapscreen",title:title,onclick:function(){editor.execCommand("snapscreen")},theme:editor.options.theme});if(editorui.buttons.snapscreen=ui,iframeUrl=iframeUrl||(editor.options.iframeUrlMap||{}).snapscreen||iframeUrlMap.snapscreen){var dialog=new editorui.Dialog({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:"edui-for-snapscreen",title:title,buttons:[{className:"edui-okbutton",label:editor.getLang("ok"),editor:editor,onclick:function(){dialog.close(!0)}},{className:"edui-cancelbutton",label:editor.getLang("cancel"),editor:editor,onclick:function(){dialog.close(!1)}}]});dialog.render(),editor.ui._dialogs.snapscreenDialog=dialog}return editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState("snapscreen"))}),ui},editorui.insertcode=function(editor,list,title){list=editor.options.insertcode||[],title=editor.options.labelMap.insertcode||editor.getLang("labelMap.insertcode")||"";var items=[];utils.each(list,function(key,val){items.push({label:key,value:val,theme:editor.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" >'+(this.label||"")+"</div>"}})});var ui=new editorui.Combox({editor:editor,items:items,onselect:function(t,index){editor.execCommand("insertcode",this.items[index].value)},onbuttonclick:function(){this.showPopup()},title:title,initValue:title,className:"edui-for-insertcode",indexByValue:function(value){if(value)for(var ci,i=0;ci=this.items[i];i++)if(-1!=ci.value.indexOf(value))return i;return-1}});return editorui.buttons.insertcode=ui,editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("insertcode");if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("insertcode");if(!value)return ui.setValue(title),void 0;value&&(value=value.replace(/['"]/g,"").split(",")[0]),ui.setValue(value)}}}),ui},editorui.fontfamily=function(editor,list,title){if(list=editor.options.fontfamily||[],title=editor.options.labelMap.fontfamily||editor.getLang("labelMap.fontfamily")||"",list.length){for(var ci,i=0,items=[];ci=list[i];i++){var langLabel=editor.getLang("fontfamily")[ci.name]||"";!function(key,val){items.push({label:key,value:val,theme:editor.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="font-family:'+utils.unhtml(this.value)+'">'+(this.label||"")+"</div>"}})}(ci.label||langLabel,ci.val)}var ui=new editorui.Combox({editor:editor,items:items,onselect:function(t,index){editor.execCommand("FontFamily",this.items[index].value)},onbuttonclick:function(){this.showPopup()},title:title,initValue:title,className:"edui-for-fontfamily",indexByValue:function(value){if(value)for(var ci,i=0;ci=this.items[i];i++)if(-1!=ci.value.indexOf(value))return i;return-1}});return editorui.buttons.fontfamily=ui,editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("FontFamily");if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("FontFamily");value&&(value=value.replace(/['"]/g,"").split(",")[0]),ui.setValue(value)}}}),ui}},editorui.fontsize=function(editor,list,title){if(title=editor.options.labelMap.fontsize||editor.getLang("labelMap.fontsize")||"",list=list||editor.options.fontsize||[],list.length){for(var items=[],i=0;i<list.length;i++){var size=list[i]+"px";items.push({label:size,value:size,theme:editor.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="line-height:1;font-size:'+this.value+'">'+(this.label||"")+"</div>"}})}var ui=new editorui.Combox({editor:editor,items:items,title:title,initValue:title,onselect:function(t,index){editor.execCommand("FontSize",this.items[index].value)},onbuttonclick:function(){this.showPopup()},className:"edui-for-fontsize"});return editorui.buttons.fontsize=ui,editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("FontSize");-1==state?ui.setDisabled(!0):(ui.setDisabled(!1),ui.setValue(editor.queryCommandValue("FontSize")))}}),ui}},editorui.paragraph=function(editor,list,title){if(title=editor.options.labelMap.paragraph||editor.getLang("labelMap.paragraph")||"",list=editor.options.paragraph||[],!utils.isEmptyObject(list)){var items=[];for(var i in list)items.push({value:i,label:list[i]||editor.getLang("paragraph")[i],theme:editor.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><span class="edui-for-'+this.value+'">'+(this.label||"")+"</span></div>"}});var ui=new editorui.Combox({editor:editor,items:items,title:title,initValue:title,className:"edui-for-paragraph",onselect:function(t,index){editor.execCommand("Paragraph",this.items[index].value)},onbuttonclick:function(){this.showPopup()}});return editorui.buttons.paragraph=ui,editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("Paragraph");if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("Paragraph"),index=ui.indexByValue(value);-1!=index?ui.setValue(value):ui.setValue(ui.initValue)}}}),ui}},editorui.customstyle=function(editor){var list=editor.options.customstyle||[],title=editor.options.labelMap.customstyle||editor.getLang("labelMap.customstyle")||"";if(list.length){for(var t,langCs=editor.getLang("customstyle"),i=0,items=[];t=list[i++];)!function(t){var ck={};ck.label=t.label?t.label:langCs[t.name],ck.style=t.style,ck.className=t.className,ck.tag=t.tag,items.push({label:ck.label,value:ck,theme:editor.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><'+ck.tag+" "+(ck.className?' class="'+ck.className+'"':"")+(ck.style?' style="'+ck.style+'"':"")+">"+ck.label+"</"+ck.tag+">"+"</div>"}})}(t);var ui=new editorui.Combox({editor:editor,items:items,title:title,initValue:title,className:"edui-for-customstyle",onselect:function(t,index){editor.execCommand("customstyle",this.items[index].value)},onbuttonclick:function(){this.showPopup()},indexByValue:function(value){for(var ti,i=0;ti=this.items[i++];)if(ti.label==value)return i-1;return-1}});return editorui.buttons.customstyle=ui,editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("customstyle");if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("customstyle"),index=ui.indexByValue(value);-1!=index?ui.setValue(value):ui.setValue(ui.initValue)}}}),ui}},editorui.inserttable=function(editor,iframeUrl,title){title=editor.options.labelMap.inserttable||editor.getLang("labelMap.inserttable")||"";var ui=new editorui.TableButton({editor:editor,title:title,className:"edui-for-inserttable",onpicktable:function(t,numCols,numRows){editor.execCommand("InsertTable",{numRows:numRows,numCols:numCols,border:1})},onbuttonclick:function(){this.showPopup()}});return editorui.buttons.inserttable=ui,editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState("inserttable"))}),ui},editorui.lineheight=function(editor){var val=editor.options.lineheight||[];if(val.length){for(var ci,i=0,items=[];ci=val[i++];)items.push({label:ci,value:ci,theme:editor.options.theme,onclick:function(){editor.execCommand("lineheight",this.value)}});var ui=new editorui.MenuButton({editor:editor,className:"edui-for-lineheight",title:editor.options.labelMap.lineheight||editor.getLang("labelMap.lineheight")||"",items:items,onbuttonclick:function(){var value=editor.queryCommandValue("LineHeight")||this.value;editor.execCommand("LineHeight",value)}});return editorui.buttons.lineheight=ui,editor.addListener("selectionchange",function(){var state=editor.queryCommandState("LineHeight");if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("LineHeight");value&&ui.setValue((value+"").replace(/cm/,"")),ui.setChecked(state)}}),ui}};for(var ri,rowspacings=["top","bottom"],r=0;ri=rowspacings[r++];)!function(cmd){editorui["rowspacing"+cmd]=function(editor){var val=editor.options["rowspacing"+cmd]||[];if(!val.length)return null;for(var ci,i=0,items=[];ci=val[i++];)items.push({label:ci,value:ci,theme:editor.options.theme,onclick:function(){editor.execCommand("rowspacing",this.value,cmd)}});var ui=new editorui.MenuButton({editor:editor,className:"edui-for-rowspacing"+cmd,title:editor.options.labelMap["rowspacing"+cmd]||editor.getLang("labelMap.rowspacing"+cmd)||"",items:items,onbuttonclick:function(){var value=editor.queryCommandValue("rowspacing",cmd)||this.value;editor.execCommand("rowspacing",value,cmd)}});return editorui.buttons[cmd]=ui,editor.addListener("selectionchange",function(){var state=editor.queryCommandState("rowspacing",cmd);if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("rowspacing",cmd);value&&ui.setValue((value+"").replace(/%/,"")),ui.setChecked(state)}}),ui}}(ri);for(var cl,lists=["insertorderedlist","insertunorderedlist"],l=0;cl=lists[l++];)!function(cmd){editorui[cmd]=function(editor){var vals=editor.options[cmd],_onMenuClick=function(){editor.execCommand(cmd,this.value)},items=[];for(var i in vals)items.push({label:vals[i]||editor.getLang()[cmd][i]||"",value:i,theme:editor.options.theme,onclick:_onMenuClick});var ui=new editorui.MenuButton({editor:editor,className:"edui-for-"+cmd,title:editor.getLang("labelMap."+cmd)||"",items:items,onbuttonclick:function(){var value=editor.queryCommandValue(cmd)||this.value;editor.execCommand(cmd,value)}});return editorui.buttons[cmd]=ui,editor.addListener("selectionchange",function(){var state=editor.queryCommandState(cmd);if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue(cmd);ui.setValue(value),ui.setChecked(state)}}),ui}}(cl);editorui.fullscreen=function(editor,title){title=editor.options.labelMap.fullscreen||editor.getLang("labelMap.fullscreen")||"";var ui=new editorui.Button({className:"edui-for-fullscreen",title:title,theme:editor.options.theme,onclick:function(){editor.ui&&editor.ui.setFullScreen(!editor.ui.isFullScreen()),this.setChecked(editor.ui.isFullScreen())}});return editorui.buttons.fullscreen=ui,editor.addListener("selectionchange",function(){var state=editor.queryCommandState("fullscreen");ui.setDisabled(-1==state),ui.setChecked(editor.ui.isFullScreen())}),ui},editorui.emotion=function(editor,iframeUrl){var cmd="emotion",ui=new editorui.MultiMenuPop({title:editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"",editor:editor,className:"edui-for-"+cmd,iframeUrl:editor.ui.mapUrl(iframeUrl||(editor.options.iframeUrlMap||{})[cmd]||iframeUrlMap[cmd])});
return editorui.buttons[cmd]=ui,editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState(cmd))}),ui},editorui.autotypeset=function(editor){var ui=new editorui.AutoTypeSetButton({editor:editor,title:editor.options.labelMap.autotypeset||editor.getLang("labelMap.autotypeset")||"",className:"edui-for-autotypeset",onbuttonclick:function(){editor.execCommand("autotypeset")}});return editorui.buttons.autotypeset=ui,editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState("autotypeset"))}),ui}}(),function(){function EditorUI(options){this.initOptions(options),this.initEditorUI()}var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,domUtils=baidu.editor.dom.domUtils,nodeStack=[];EditorUI.prototype={uiName:"editor",initEditorUI:function(){function setCount(editor,ui){editor.setOpt({wordCount:!0,maximumWords:1e4,wordCountMsg:editor.options.wordCountMsg||editor.getLang("wordCountMsg"),wordOverFlowMsg:editor.options.wordOverFlowMsg||editor.getLang("wordOverFlowMsg")});var opt=editor.options,max=opt.maximumWords,msg=opt.wordCountMsg,errMsg=opt.wordOverFlowMsg,countDom=ui.getDom("wordcount");if(opt.wordCount){var count=editor.getContentLength(!0);count>max?(countDom.innerHTML=errMsg,editor.fireEvent("wordcountoverflow")):countDom.innerHTML=msg.replace("{#leave}",max-count).replace("{#count}",count)}}this.editor.ui=this,this._dialogs={},this.initUIBase(),this._initToolbars();var editor=this.editor,me=this;editor.addListener("ready",function(){function countFn(){setCount(editor,me),domUtils.un(editor.document,"click",arguments.callee)}editor.getDialog=function(name){return editor.ui._dialogs[name+"Dialog"]},domUtils.on(editor.window,"scroll",function(evt){baidu.editor.ui.Popup.postHide(evt)}),editor.ui._actualFrameWidth=editor.options.initialFrameWidth,editor.options.elementPathEnabled&&(editor.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+editor.getLang("elementPathTip")+":</div>"),editor.options.wordCount&&(domUtils.on(editor.document,"click",countFn),editor.ui.getDom("wordcount").innerHTML=editor.getLang("wordCountTip")),editor.ui._scale(),editor.options.scaleEnabled?(editor.autoHeightEnabled&&editor.disableAutoHeight(),me.enableScale()):me.disableScale(),editor.options.elementPathEnabled||editor.options.wordCount||editor.options.scaleEnabled||(editor.ui.getDom("elementpath").style.display="none",editor.ui.getDom("wordcount").style.display="none",editor.ui.getDom("scale").style.display="none"),editor.selection.isFocus()&&editor.fireEvent("selectionchange",!1,!0)}),editor.addListener("mousedown",function(t,evt){var el=evt.target||evt.srcElement;baidu.editor.ui.Popup.postHide(evt,el)}),editor.addListener("delcells",function(){UE.ui.edittip&&new UE.ui.edittip(editor),editor.getDialog("edittip").open()});var pastePop,timer,isPaste=!1;editor.addListener("afterpaste",function(){editor.queryCommandState("pasteplain")||(baidu.editor.ui.PastePicker&&(pastePop=new baidu.editor.ui.Popup({content:new baidu.editor.ui.PastePicker({editor:editor}),editor:editor,className:"edui-wordpastepop"}),pastePop.render()),isPaste=!0)}),editor.addListener("afterinserthtml",function(){clearTimeout(timer),timer=setTimeout(function(){if(pastePop&&(isPaste||editor.ui._isTransfer)){var span=domUtils.createElement(editor.document,"span",{style:"line-height:0px;",innerHTML:"﻿"}),range=editor.selection.getRange();range.insertNode(span);var tmp=getDomNode(span,"firstChild","previousSibling");pastePop.showAnchor(3==tmp.nodeType?tmp.parentNode:tmp),domUtils.remove(span),delete editor.ui._isTransfer,isPaste=!1}},200)}),editor.addListener("contextmenu",function(t,evt){baidu.editor.ui.Popup.postHide(evt)}),editor.addListener("keydown",function(t,evt){pastePop&&pastePop.dispose(evt);var keyCode=evt.keyCode||evt.which;evt.altKey&&90==keyCode&&UE.ui.buttons.fullscreen.onclick()}),editor.addListener("wordcount",function(){setCount(this,me)}),editor.addListener("selectionchange",function(){editor.options.elementPathEnabled&&me[(-1==editor.queryCommandState("elementpath")?"dis":"en")+"ableElementPath"](),editor.options.scaleEnabled&&me[(-1==editor.queryCommandState("scale")?"dis":"en")+"ableScale"]()});var popup=new baidu.editor.ui.Popup({editor:editor,content:"",className:"edui-bubble",_onEditButtonClick:function(){this.hide(),editor.ui._dialogs.linkDialog.open()},_onImgEditButtonClick:function(name){this.hide(),editor.ui._dialogs[name]&&editor.ui._dialogs[name].open()},_onImgSetFloat:function(value){this.hide(),editor.execCommand("imagefloat",value)},_setIframeAlign:function(value){var frame=popup.anchorEl,newFrame=frame.cloneNode(!0);switch(value){case-2:newFrame.setAttribute("align","");break;case-1:newFrame.setAttribute("align","left");break;case 1:newFrame.setAttribute("align","right")}frame.parentNode.insertBefore(newFrame,frame),domUtils.remove(frame),popup.anchorEl=newFrame,popup.showAnchor(popup.anchorEl)},_updateIframe:function(){editor._iframe=popup.anchorEl,editor.ui._dialogs.insertframeDialog.open(),popup.hide()},_onRemoveButtonClick:function(cmdName){editor.execCommand(cmdName),this.hide()},queryAutoHide:function(el){return el&&el.ownerDocument==editor.document&&("img"==el.tagName.toLowerCase()||domUtils.findParentByTagName(el,"a",!0))?el!==popup.anchorEl:baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,el)}});popup.render(),editor.options.imagePopup&&(editor.addListener("mouseover",function(t,evt){evt=evt||window.event;var el=evt.target||evt.srcElement;if(editor.ui._dialogs.insertframeDialog&&/iframe/gi.test(el.tagName)){var html=popup.formatHtml("<nobr>"+editor.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+editor.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+editor.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+editor.getLang("justifyright")+"</span>&nbsp;&nbsp;"+' <span onclick="$$._updateIframe( this);" class="edui-clickable">'+editor.getLang("modify")+"</span></nobr>");html?(popup.getDom("content").innerHTML=html,popup.anchorEl=el,popup.showAnchor(popup.anchorEl)):popup.hide()}}),editor.addListener("selectionchange",function(t,causeByUi){if(causeByUi){var html="",str="",img=editor.selection.getRange().getClosedNode(),dialogs=editor.ui._dialogs;if(img&&"IMG"==img.tagName){var dialogName="insertimageDialog";if(-1!=img.className.indexOf("edui-faked-video")&&(dialogName="insertvideoDialog"),-1!=img.className.indexOf("edui-faked-webapp")&&(dialogName="webappDialog"),-1!=img.src.indexOf("http://api.map.baidu.com")&&(dialogName="mapDialog"),-1!=img.className.indexOf("edui-faked-music")&&(dialogName="musicDialog"),-1!=img.src.indexOf("http://maps.google.com/maps/api/staticmap")&&(dialogName="gmapDialog"),img.getAttribute("anchorname")&&(dialogName="anchorDialog",html=popup.formatHtml("<nobr>"+editor.getLang("property")+': <span onclick=$$._onImgEditButtonClick("anchorDialog") class="edui-clickable">'+editor.getLang("modify")+"</span>&nbsp;&nbsp;"+"<span onclick=$$._onRemoveButtonClick('anchor') class=\"edui-clickable\">"+editor.getLang("delete")+"</span></nobr>")),img.getAttribute("word_img")&&(editor.word_img=[img.getAttribute("word_img")],dialogName="wordimageDialog"),!dialogs[dialogName])return;str="<nobr>"+editor.getLang("property")+": "+'<span onclick=$$._onImgSetFloat("none") class="edui-clickable">'+editor.getLang("default")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("left") class="edui-clickable">'+editor.getLang("justifyleft")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("right") class="edui-clickable">'+editor.getLang("justifyright")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("center") class="edui-clickable">'+editor.getLang("justifycenter")+"</span>&nbsp;&nbsp;"+"<span onclick=\"$$._onImgEditButtonClick('"+dialogName+'\');" class="edui-clickable">'+editor.getLang("modify")+"</span></nobr>",!html&&(html=popup.formatHtml(str))}if(editor.ui._dialogs.linkDialog){var url,link=editor.queryCommandValue("link");if(link&&(url=link.getAttribute("_href")||link.getAttribute("href",2))){var txt=url;url.length>30&&(txt=url.substring(0,20)+"..."),html&&(html+='<div style="height:5px;"></div>'),html+=popup.formatHtml("<nobr>"+editor.getLang("anthorMsg")+': <a target="_blank" href="'+url+'" title="'+url+'" >'+txt+"</a>"+' <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+editor.getLang("modify")+"</span>"+' <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+editor.getLang("clear")+"</span></nobr>"),popup.showAnchor(link)}}html?(popup.getDom("content").innerHTML=html,popup.anchorEl=img||link,popup.showAnchor(popup.anchorEl)):popup.hide()}}))},_initToolbars:function(){for(var editor=this.editor,toolbars=this.toolbars||[],toolbarUis=[],i=0;i<toolbars.length;i++){for(var toolbar=toolbars[i],toolbarUi=new baidu.editor.ui.Toolbar({theme:editor.options.theme}),j=0;j<toolbar.length;j++){var toolbarItem=toolbar[j],toolbarItemUi=null;if("string"==typeof toolbarItem){if(toolbarItem=toolbarItem.toLowerCase(),"|"==toolbarItem&&(toolbarItem="Separator"),baidu.editor.ui[toolbarItem]&&(toolbarItemUi=new baidu.editor.ui[toolbarItem](editor)),"fullscreen"==toolbarItem){toolbarUis&&toolbarUis[0]?toolbarUis[0].items.splice(0,0,toolbarItemUi):toolbarItemUi&&toolbarUi.items.splice(0,0,toolbarItemUi);continue}}else toolbarItemUi=toolbarItem;toolbarItemUi&&toolbarItemUi.id&&toolbarUi.add(toolbarItemUi)}toolbarUis[i]=toolbarUi}this.toolbars=toolbarUis},getHtmlTpl:function(){return'<div id="##" class="%%"><div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"</div></div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;">'+'<div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+"</div>"+'<div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x</div>'+'<div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"></div>'+'<div style="height:0;overflow:hidden;clear:both;"></div>'+"</div>"+"</div>"+'<div id="##_iframeholder" class="%%-iframeholder"></div>'+'<div id="##_bottombar" class="%%-bottomContainer"><table><tr>'+'<td id="##_elementpath" class="%%-bottombar"></td>'+'<td id="##_wordcount" class="%%-wordcount"></td>'+'<td id="##_scale" class="%%-scale"><div class="%%-icon"></div></td>'+"</tr></table></div>"+'<div id="##_scalelayer"></div>'+"</div>"},showWordImageDialog:function(){this.editor.execCommand("wordimage","word_img"),this._dialogs.wordimageDialog.open()},renderToolbarBoxHtml:function(){for(var buff=[],i=0;i<this.toolbars.length;i++)buff.push(this.toolbars[i].renderHtml());return buff.join("")},setFullScreen:function(fullscreen){var editor=this.editor,container=editor.container.parentNode.parentNode;if(this._fullscreen!=fullscreen){if(this._fullscreen=fullscreen,this.editor.fireEvent("beforefullscreenchange",fullscreen),baidu.editor.browser.gecko)var bk=editor.selection.getRange().createBookmark();if(fullscreen){for(;"BODY"!=container.tagName;){var position=baidu.editor.dom.domUtils.getComputedStyle(container,"position");nodeStack.push(position),container.style.position="static",container=container.parentNode}this._bakHtmlOverflow=document.documentElement.style.overflow,this._bakBodyOverflow=document.body.style.overflow,this._bakAutoHeight=this.editor.autoHeightEnabled,this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop),this._bakEditorContaninerWidth=editor.iframe.parentNode.offsetWidth,this._bakAutoHeight&&(editor.autoHeightEnabled=!1,this.editor.disableAutoHeight()),document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",this._bakCssText=this.getDom().style.cssText,this._bakCssText1=this.getDom("iframeholder").style.cssText,editor.iframe.parentNode.style.width="",this._updateFullScreen()}else{for(;"BODY"!=container.tagName;)container.style.position=nodeStack.shift(),container=container.parentNode;this.getDom().style.cssText=this._bakCssText,this.getDom("iframeholder").style.cssText=this._bakCssText1,this._bakAutoHeight&&(editor.autoHeightEnabled=!0,this.editor.enableAutoHeight()),document.documentElement.style.overflow=this._bakHtmlOverflow,document.body.style.overflow=this._bakBodyOverflow,editor.iframe.parentNode.style.width=this._bakEditorContaninerWidth+"px",window.scrollTo(0,this._bakScrollTop)}if(baidu.editor.browser.gecko&&"true"===editor.body.contentEditable){var input=document.createElement("input");document.body.appendChild(input),editor.body.contentEditable=!1,setTimeout(function(){input.focus(),setTimeout(function(){editor.body.contentEditable=!0,editor.selection.getRange().moveToBookmark(bk).select(!0),baidu.editor.dom.domUtils.remove(input),fullscreen&&window.scroll(0,0)},0)},0)}"true"===editor.body.contentEditable&&(this.editor.fireEvent("fullscreenchanged",fullscreen),this.triggerLayout())}},_updateFullScreen:function(){if(this._fullscreen){var vpRect=uiUtils.getViewportRect();this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+vpRect.width+"px;height:"+vpRect.height+"px;z-index:"+(1*this.getDom().style.zIndex+100),uiUtils.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0}),this.editor.setHeight(vpRect.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0)),browser.gecko&&window.onresize()}},_updateElementPath:function(){var list,bottom=this.getDom("elementpath");if(this.elementPathEnabled&&(list=this.editor.queryCommandValue("elementpath"))){for(var ci,buff=[],i=0;ci=list[i];i++)buff[i]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+i+'&quot;);">'+ci+"</span>");bottom.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+buff.join(" &gt; ")+"</div>"}else bottom.style.display="none"},disableElementPath:function(){var bottom=this.getDom("elementpath");bottom.innerHTML="",bottom.style.display="none",this.elementPathEnabled=!1},enableElementPath:function(){var bottom=this.getDom("elementpath");bottom.style.display="",this.elementPathEnabled=!0,this._updateElementPath()},_scale:function(){function down(){position=domUtils.getXY(editorHolder),minEditorHeight||(minEditorHeight=editor.options.minFrameHeight+toolbarBox.offsetHeight+bottombar.offsetHeight),scalelayer.style.cssText="position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:"+editorHolder.offsetWidth+"px;height:"+editorHolder.offsetHeight+"px;z-index:"+(editor.options.zIndex+1),domUtils.on(doc,"mousemove",move),domUtils.on(editorDocument,"mouseup",up),domUtils.on(doc,"mouseup",up)}function move(event){clearSelection();var e=event||window.event;pageX=e.pageX||doc.documentElement.scrollLeft+e.clientX,pageY=e.pageY||doc.documentElement.scrollTop+e.clientY,scaleWidth=pageX-position.x,scaleHeight=pageY-position.y,scaleWidth>=minEditorWidth&&(isMouseMove=!0,scalelayer.style.width=scaleWidth+"px"),scaleHeight>=minEditorHeight&&(isMouseMove=!0,scalelayer.style.height=scaleHeight+"px")}function up(){isMouseMove&&(isMouseMove=!1,editor.ui._actualFrameWidth=scalelayer.offsetWidth-2,editorHolder.style.width=editor.ui._actualFrameWidth+"px",editor.setHeight(scalelayer.offsetHeight-bottombar.offsetHeight-toolbarBox.offsetHeight-2)),scalelayer&&(scalelayer.style.display="none"),clearSelection(),domUtils.un(doc,"mousemove",move),domUtils.un(editorDocument,"mouseup",up),domUtils.un(doc,"mouseup",up)}function clearSelection(){browser.ie?doc.selection.clear():window.getSelection().removeAllRanges()}var doc=document,editor=this.editor,editorHolder=editor.container,editorDocument=editor.document,toolbarBox=this.getDom("toolbarbox"),bottombar=this.getDom("bottombar"),scale=this.getDom("scale"),scalelayer=this.getDom("scalelayer"),isMouseMove=!1,position=null,minEditorHeight=0,minEditorWidth=editor.options.minFrameWidth,pageX=0,pageY=0,scaleWidth=0,scaleHeight=0,me=this;this.editor.addListener("fullscreenchanged",function(e,fullScreen){if(fullScreen)me.disableScale();else if(me.editor.options.scaleEnabled){me.enableScale();var tmpNode=me.editor.document.createElement("span");me.editor.body.appendChild(tmpNode),me.editor.body.style.height=Math.max(domUtils.getXY(tmpNode).y,me.editor.iframe.offsetHeight-20)+"px",domUtils.remove(tmpNode)}}),this.enableScale=function(){1!=editor.queryCommandState("source")&&(scale.style.display="",this.scaleEnabled=!0,domUtils.on(scale,"mousedown",down))},this.disableScale=function(){scale.style.display="none",this.scaleEnabled=!1,domUtils.un(scale,"mousedown",down)}},isFullScreen:function(){return this._fullscreen},postRender:function(){UIBase.prototype.postRender.call(this);for(var i=0;i<this.toolbars.length;i++)this.toolbars[i].postRender();var timerId,me=this,domUtils=baidu.editor.dom.domUtils,updateFullScreenTime=function(){clearTimeout(timerId),timerId=setTimeout(function(){me._updateFullScreen()})};domUtils.on(window,"resize",updateFullScreenTime),me.addListener("destroy",function(){domUtils.un(window,"resize",updateFullScreenTime),clearTimeout(timerId)})},showToolbarMsg:function(msg,flag){if(this.getDom("toolbarmsg_label").innerHTML=msg,this.getDom("toolbarmsg").style.display="",!flag){var w=this.getDom("upload_dialog");w.style.display="none"}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none"},mapUrl:function(url){return url?url.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):""},triggerLayout:function(){var dom=this.getDom();dom.style.zoom="1"==dom.style.zoom?"100%":"1"}},utils.inherits(EditorUI,baidu.editor.ui.UIBase);var instances={};UE.ui.Editor=function(options){var editor=new baidu.editor.Editor(options);editor.options.editor=editor,utils.loadFile(document,{href:editor.options.themePath+editor.options.theme+"/css/ueditor.css",tag:"link",type:"text/css",rel:"stylesheet"});var oldRender=editor.render;return editor.render=function(holder){holder.constructor===String&&(editor.key=holder,instances[holder]=editor),utils.domReady(function(){function renderUI(){if(editor.setOpt({labelMap:editor.options.labelMap||editor.getLang("labelMap")}),new EditorUI(editor.options),holder&&(holder.constructor===String&&(holder=document.getElementById(holder)),holder&&holder.getAttribute("name")&&(editor.options.textarea=holder.getAttribute("name")),holder&&/script|textarea/gi.test(holder.tagName))){var newDiv=document.createElement("div");holder.parentNode.insertBefore(newDiv,holder);var cont=holder.value||holder.innerHTML;editor.options.initialContent=/^[\t\r\n ]*$/.test(cont)?editor.options.initialContent:cont.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><"),holder.className&&(newDiv.className=holder.className),holder.style.cssText&&(newDiv.style.cssText=holder.style.cssText),/textarea/i.test(holder.tagName)?(editor.textarea=holder,editor.textarea.style.display="none"):(holder.parentNode.removeChild(holder),holder.id&&(newDiv.id=holder.id)),holder=newDiv,holder.innerHTML=""}domUtils.addClass(holder,"edui-"+editor.options.theme),editor.ui.render(holder);var opt=editor.options;editor.container=editor.ui.getDom();for(var ci,parents=domUtils.findParents(holder,!0),displays=[],i=0;ci=parents[i];i++)displays[i]=ci.style.display,ci.style.display="block";opt.minFrameWidth=opt.initialFrameWidth?opt.initialFrameWidth:opt.initialFrameWidth=holder.offsetWidth,opt.initialFrameHeight?opt.minFrameHeight=opt.initialFrameHeight:opt.initialFrameHeight=opt.minFrameHeight=holder.offsetHeight;for(var ci,i=0;ci=parents[i];i++)ci.style.display=displays[i];holder.style.height&&(holder.style.height=""),editor.container.style.width=opt.initialFrameWidth+"px",editor.container.style.zIndex=opt.zIndex,oldRender.call(editor,editor.ui.getDom("iframeholder"))}editor.langIsReady?renderUI():editor.addListener("langReady",renderUI)})},editor},UE.getEditor=function(id,opt){var editor=instances[id];return editor||(editor=instances[id]=new UE.ui.Editor(opt),editor.render(id)),editor},UE.delEditor=function(id){var editor;(editor=instances[id])&&(editor.key&&editor.destroy(),delete instances[id])}}(),function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,SplitButton=baidu.editor.ui.SplitButton,MultiMenuPop=baidu.editor.ui.MultiMenuPop=function(options){this.initOptions(options),this.initMultiMenu()};MultiMenuPop.prototype={initMultiMenu:function(){var me=this;this.popup=new Popup({content:"",editor:me.editor,iframe_rendered:!1,onshow:function(){this.iframe_rendered||(this.iframe_rendered=!0,this.getDom("content").innerHTML='<iframe id="'+me.id+'_iframe" src="'+me.iframeUrl+'" frameborder="0"></iframe>',me.editor.container.style.zIndex&&(this.getDom().style.zIndex=1*me.editor.container.style.zIndex+1))}}),this.onbuttonclick=function(){this.showPopup()},this.initSplitButton()}},utils.inherits(MultiMenuPop,SplitButton)}()}();