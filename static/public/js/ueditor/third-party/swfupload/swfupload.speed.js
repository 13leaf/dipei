/*! depei 2013-07-11 */
var SWFUpload;"function"==typeof SWFUpload&&(SWFUpload.speed={},SWFUpload.prototype.initSettings=function(oldInitSettings){return function(userSettings){"function"==typeof oldInitSettings&&oldInitSettings.call(this,userSettings),this.ensureDefault=function(settingName,defaultValue){this.settings[settingName]=void 0==userSettings[settingName]?defaultValue:userSettings[settingName]},this.fileSpeedStats={},this.speedSettings={},this.ensureDefault("moving_average_history_size","10"),this.speedSettings.user_file_queued_handler=this.settings.file_queued_handler,this.speedSettings.user_file_queue_error_handler=this.settings.file_queue_error_handler,this.speedSettings.user_upload_start_handler=this.settings.upload_start_handler,this.speedSettings.user_upload_error_handler=this.settings.upload_error_handler,this.speedSettings.user_upload_progress_handler=this.settings.upload_progress_handler,this.speedSettings.user_upload_success_handler=this.settings.upload_success_handler,this.speedSettings.user_upload_complete_handler=this.settings.upload_complete_handler,this.settings.file_queued_handler=SWFUpload.speed.fileQueuedHandler,this.settings.file_queue_error_handler=SWFUpload.speed.fileQueueErrorHandler,this.settings.upload_start_handler=SWFUpload.speed.uploadStartHandler,this.settings.upload_error_handler=SWFUpload.speed.uploadErrorHandler,this.settings.upload_progress_handler=SWFUpload.speed.uploadProgressHandler,this.settings.upload_success_handler=SWFUpload.speed.uploadSuccessHandler,this.settings.upload_complete_handler=SWFUpload.speed.uploadCompleteHandler,delete this.ensureDefault}}(SWFUpload.prototype.initSettings),SWFUpload.speed.fileQueuedHandler=function(file){return"function"==typeof this.speedSettings.user_file_queued_handler?(file=SWFUpload.speed.extendFile(file),this.speedSettings.user_file_queued_handler.call(this,file)):void 0},SWFUpload.speed.fileQueueErrorHandler=function(file,errorCode,message){return"function"==typeof this.speedSettings.user_file_queue_error_handler?(file=SWFUpload.speed.extendFile(file),this.speedSettings.user_file_queue_error_handler.call(this,file,errorCode,message)):void 0},SWFUpload.speed.uploadStartHandler=function(file){return"function"==typeof this.speedSettings.user_upload_start_handler?(file=SWFUpload.speed.extendFile(file,this.fileSpeedStats),this.speedSettings.user_upload_start_handler.call(this,file)):void 0},SWFUpload.speed.uploadErrorHandler=function(file,errorCode,message){return file=SWFUpload.speed.extendFile(file,this.fileSpeedStats),SWFUpload.speed.removeTracking(file,this.fileSpeedStats),"function"==typeof this.speedSettings.user_upload_error_handler?this.speedSettings.user_upload_error_handler.call(this,file,errorCode,message):void 0},SWFUpload.speed.uploadProgressHandler=function(file,bytesComplete,bytesTotal){return this.updateTracking(file,bytesComplete),file=SWFUpload.speed.extendFile(file,this.fileSpeedStats),"function"==typeof this.speedSettings.user_upload_progress_handler?this.speedSettings.user_upload_progress_handler.call(this,file,bytesComplete,bytesTotal):void 0},SWFUpload.speed.uploadSuccessHandler=function(file,serverData){return"function"==typeof this.speedSettings.user_upload_success_handler?(file=SWFUpload.speed.extendFile(file,this.fileSpeedStats),this.speedSettings.user_upload_success_handler.call(this,file,serverData)):void 0},SWFUpload.speed.uploadCompleteHandler=function(file){return file=SWFUpload.speed.extendFile(file,this.fileSpeedStats),SWFUpload.speed.removeTracking(file,this.fileSpeedStats),"function"==typeof this.speedSettings.user_upload_complete_handler?this.speedSettings.user_upload_complete_handler.call(this,file):void 0},SWFUpload.speed.extendFile=function(file,trackingList){var tracking;return file?(trackingList&&(tracking=trackingList[file.id]),tracking?(file.currentSpeed=tracking.currentSpeed,file.averageSpeed=tracking.averageSpeed,file.movingAverageSpeed=tracking.movingAverageSpeed,file.timeRemaining=tracking.timeRemaining,file.timeElapsed=tracking.timeElapsed,file.percentUploaded=tracking.percentUploaded,file.sizeUploaded=tracking.bytesUploaded):(file.currentSpeed=0,file.averageSpeed=0,file.movingAverageSpeed=0,file.timeRemaining=0,file.timeElapsed=0,file.percentUploaded=0,file.sizeUploaded=0),file):file},SWFUpload.prototype.updateTracking=function(file,bytesUploaded){var tracking=this.fileSpeedStats[file.id];tracking||(this.fileSpeedStats[file.id]=tracking={}),bytesUploaded=bytesUploaded||tracking.bytesUploaded||0,0>bytesUploaded&&(bytesUploaded=0),bytesUploaded>file.size&&(bytesUploaded=file.size);var tickTime=(new Date).getTime();if(tracking.startTime)if(tracking.startTime>tickTime)this.debug("When backwards in time");else{var now=(new Date).getTime(),lastTime=tracking.lastTime,deltaTime=now-lastTime,deltaBytes=bytesUploaded-tracking.bytesUploaded;if(0===deltaBytes||0===deltaTime)return tracking;tracking.lastTime=now,tracking.bytesUploaded=bytesUploaded,tracking.currentSpeed=8*deltaBytes/(deltaTime/1e3),tracking.averageSpeed=8*tracking.bytesUploaded/((now-tracking.startTime)/1e3),tracking.movingAverageHistory.push(tracking.currentSpeed),tracking.movingAverageHistory.length>this.settings.moving_average_history_size&&tracking.movingAverageHistory.shift(),tracking.movingAverageSpeed=SWFUpload.speed.calculateMovingAverage(tracking.movingAverageHistory),tracking.timeRemaining=8*(file.size-tracking.bytesUploaded)/tracking.movingAverageSpeed,tracking.timeElapsed=(now-tracking.startTime)/1e3,tracking.percentUploaded=100*(tracking.bytesUploaded/file.size)}else tracking.startTime=(new Date).getTime(),tracking.lastTime=tracking.startTime,tracking.currentSpeed=0,tracking.averageSpeed=0,tracking.movingAverageSpeed=0,tracking.movingAverageHistory=[],tracking.timeRemaining=0,tracking.timeElapsed=0,tracking.percentUploaded=bytesUploaded/file.size,tracking.bytesUploaded=bytesUploaded;return tracking},SWFUpload.speed.removeTracking=function(file,trackingList){try{trackingList[file.id]=null,delete trackingList[file.id]}catch(ex){}},SWFUpload.speed.formatUnits=function(baseNumber,unitDivisors,unitLabels,singleFractional){var i,unit,unitDivisor,unitLabel;if(0===baseNumber)return"0 "+unitLabels[unitLabels.length-1];if(singleFractional){for(unit=baseNumber,unitLabel=unitLabels.length>=unitDivisors.length?unitLabels[unitDivisors.length-1]:"",i=0;i<unitDivisors.length;i++)if(baseNumber>=unitDivisors[i]){unit=(baseNumber/unitDivisors[i]).toFixed(2),unitLabel=unitLabels.length>=i?" "+unitLabels[i]:"";break}return unit+unitLabel}var formattedStrings=[],remainder=baseNumber;for(i=0;i<unitDivisors.length;i++)unitDivisor=unitDivisors[i],unitLabel=unitLabels.length>i?" "+unitLabels[i]:"",unit=remainder/unitDivisor,unit=i<unitDivisors.length-1?Math.floor(unit):unit.toFixed(2),unit>0&&(remainder%=unitDivisor,formattedStrings.push(unit+unitLabel));return formattedStrings.join(" ")},SWFUpload.speed.formatBPS=function(baseNumber){var bpsUnits=[1073741824,1048576,1024,1],bpsUnitLabels=["Gbps","Mbps","Kbps","bps"];return SWFUpload.speed.formatUnits(baseNumber,bpsUnits,bpsUnitLabels,!0)},SWFUpload.speed.formatTime=function(baseNumber){var timeUnits=[86400,3600,60,1],timeUnitLabels=["d","h","m","s"];return SWFUpload.speed.formatUnits(baseNumber,timeUnits,timeUnitLabels,!1)},SWFUpload.speed.formatBytes=function(baseNumber){var sizeUnits=[1073741824,1048576,1024,1],sizeUnitLabels=["GB","MB","KB","bytes"];return SWFUpload.speed.formatUnits(baseNumber,sizeUnits,sizeUnitLabels,!0)},SWFUpload.speed.formatPercent=function(baseNumber){return baseNumber.toFixed(2)+" %"},SWFUpload.speed.calculateMovingAverage=function(history){var size,i,vals=[],sum=0,mean=0,varianceTemp=0,variance=0,standardDev=0,mSum=0,mCount=0;if(size=history.length,size>=8){for(i=0;size>i;i++)vals[i]=history[i],sum+=vals[i];for(mean=sum/size,i=0;size>i;i++)varianceTemp+=Math.pow(vals[i]-mean,2);for(variance=varianceTemp/size,standardDev=Math.sqrt(variance),i=0;size>i;i++)vals[i]=(vals[i]-mean)/standardDev;var deviationRange=2;for(i=0;size>i;i++)vals[i]<=deviationRange&&vals[i]>=-deviationRange&&(mCount++,mSum+=history[i])}else for(mCount=size,i=0;size>i;i++)mSum+=history[i];return mSum/mCount});