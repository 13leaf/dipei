/*! depei 2013-07-11 */
!!function(){var _getViewPort=function(){var doc=document,b=doc.body,de=doc.documentElement,mode=doc.compatMode,width=self.innerWidth,height=self.innerHeight;return(mode||_isIe)&&(width="CSS1Compat"==mode?de.clientWidth:b.clientWidth,_isOpera||(height="CSS1Compat"==mode?de.clientHeight:b.clientHeight)),{left:Math.max(de.scrollLeft,b.scrollLeft),top:Math.max(de.scrollTop,b.scrollTop),width:width,height:height}},_isIe=$.browser.msie,_isOpera=$.browser.opera,_isIe7=(_isIe&&8==$.browser.version,_isIe&&7==$.browser.version),_isIe6=_isIe&&6==$.browser.version,_enable_mouse_hover=!0,_enable_mouse_timer=null,_obj_cache=[],config={className:"",maxHeight:150,align:"left",height:"",width:"auto",imageWidth:16,imageHeight:16,event:"click",withImage:!1,groupClass:"beauty-select-group",optGroupClass:"beauty-select-optgroup",optClass:"beauty-select-opt",disabledClass:"beauty-select-disabled",optDisabledClass:"beauty-select-opt-disabled",optLabelClass:"beauty-select-opt-head",hoverClass:"beauty-select-hover",openedClass:"beauty-select-opened",optHoverClass:"hover"},_eventHook={click:function(){!function(t){t.$dom.click(function(e){e.preventDefault(),t.toggle()}),$(document).click(function(ev){var tar=ev.target;$.contains(t.$wrap.get(0),tar)||t.hideList()})}(this)},hover:function(){!function(t){var timer;t.$wrap.hover(function(){clearTimeout(timer),timer=setTimeout(function(){t.showList()},150)},function(){clearTimeout(timer),timer=setTimeout(function(){t.hideList()},150)})}(this)}},SelectBeautify=function(dom,o){this.version=1.02,this.$select=$(dom),this.config=$.extend(config,o),this._create()};SelectBeautify.prototype={_destroy:function(){this.$wrap.remove()},_create:function(){var t=this,o=t.config,$select=t.$select,dataName="__beauty_plugin__",outerHeight=parseInt(o.height)||$select.outerHeight();$select.outerWidth()+10+(o.withImage?o.imageWidth:0),$select.data(dataName)&&$select.data(dataName)._destroy(),$select.data(dataName,t),t.width=o.width,t.height=outerHeight-2,t.disabled=!!$select.attr("disabled"),$select.hide(),t.$wrap=$('<div class="beauty-select-plugin"></div>').addClass(o.className).css({verticalAlign:"middle",display:_isIe6||_isIe7?"inline":"inline-block",width:t.width,lineHeight:t.height+"px",position:"relative",zoom:1,zIndex:0}).insertBefore($select),t.disabled&&t.$wrap.addClass(o.disabledClass),t.$curr=$("<label></label>"),t.$sprite=$('<a href="javascript:void(0);" hidefocus=true class="beauty-select-sprite"></a>'),t.$dom=$('<div class="beauty-select-curr"></div>').append(t.$sprite).append(t.$curr).appendTo(t.$wrap).css({"white-space":"nowrap",height:t.height}),_isIe&&t.$sprite.css({lineHeight:"0px"});var $listWrap=$('<div class="beauty-select-list"><ul></ul></div>').css({position:"absolute",left:0,zoom:1,zIndex:1,cursor:"default",overflowY:"auto"}).delegate("li","mouseenter",function(){_enable_mouse_hover&&t.mouseover($(this))}).delegate("li","click",function(){t.select($(this),!0)}),$ul=$listWrap.find("ul"),selectIndex=0,currIndex=0,createOption=function(option,bInGroup){var $t=$(option),$li=$("<li></li>").attr({index:currIndex++,title:$(option).attr("title")}).html(['<span class="',o.optLabelClass,'"></span><label>',$t.html(),"</label>"].join("")).addClass(o.optClass);bInGroup?$li.addClass(o.optGroupClass):"",option.disabled?$li.attr("disabled","disabled").addClass(o.optDisabledClass):"";var $img=$li.find("span"),bg=$t.attr("image"),cssObj={"float":"left",width:o.imageWidth,height:o.imageHeight,margin:(t.height-o.imageHeight)/2};return bg?$.extend(cssObj,{background:bg},!0):"",o.withImage?$img.css(cssObj):$img.remove(),option.selected&&(selectIndex=currIndex-1),$li},createGroup=function(option){var $t=$(option),$li=$("<li></li>").html(["<span></span><label>",$t.attr("label"),"</label>"].join("")).addClass(o.groupClass);return $li},initListWrap=function(){selectIndex=0,currIndex=0,$ul.html(""),$select.children().each(function(i,option){var $t=$(option);"optgroup"===option.tagName.toLowerCase()?($ul.append(createGroup(option)),$t.children().each(function(i,option){$ul.append(createOption(option,!0))})):$ul.append(createOption(option))});var $li=t.$listWrap.find("."+o.optClass).eq(selectIndex);t.select($li,!1),"auto"==t.width&&(t.width=t.$wrap.outerWidth()),"right"==o.align&&t.$listWrap.css({left:"",right:0})};t.$wrap.append($listWrap),t.$listWrap=$listWrap,t.$ul=$ul,initListWrap(),t.disabled||(t.$wrap.hover(function(){t.$wrap.addClass(o.hoverClass)},function(){t.$wrap.removeClass(o.hoverClass)}),t.$sprite.focus(function(){t.$wrap.addClass(o.hoverClass)}).blur(function(){t.$wrap.removeClass(o.hoverClass)})),$(document).keydown(function(ev){if(!t.$listWrap.is(":hidden")){switch(ev.keyCode){case 13:t.select(null,!0);break;case 38:t.prev();break;case 40:t.next()}return!1}}),_eventHook[o.event||"click"].apply(t),$select.bind("beautify-update",function(){initListWrap()})},select:function($li,triggerChange){var t=this,o=t.config;if($li=$li||t.$currLi,this.isActive($li)){if($li&&t.$selectLi&&t.$selectLi.get(0)==$li.get(0))return t.hideList(),void 0;t.$currLi=$li,t.$selectLi=$li;var option=t.$select.find("option").get($li.attr("index")),html=$(option).html(),bg=$(option).attr("image");if(option.selected=!0,t.$curr.html(html).attr("title",html),o.withImage){t.$curr.prevAll("span").remove();var cssObj={"float":"left",width:o.imageWidth,height:o.imageHeight,margin:(t.height-o.imageHeight)/2};bg?$.extend(cssObj,{background:bg},!0):"",$("<span></span>").css(cssObj).insertBefore(t.$curr)}else t.$curr.css("padding-left","3px");var allWidth=0;if(t.$dom.children().each(function(){var $t=$(this);allWidth+=$t.outerWidth(),allWidth+=parseInt($t.css("margin-left"))||0,allWidth+=parseInt($t.css("margin-right"))||0}),o.width&&"auto"!=o.width){var width=o.width-2,currWidth=t.$curr.outerWidth(),paddLeft=parseInt(t.$curr.css("padding-left")),paddRight=parseInt(t.$curr.css("padding-right")),extendWidth=paddLeft+paddRight+10;t.$curr.css({width:width-(allWidth-currWidth)-extendWidth,overflow:"hidden"})}else(_isIe7||_isIe6)&&t.$wrap.css("width",allWidth);t.hideList(),t.$wrap.removeClass(o.hoverClass),triggerChange&&t.$select.trigger("change")}},mouseover:function($li){if($li&&$li.length&&this.isActive($li)){var t=this,className=t.config.optHoverClass;t.$listWrap.find("li").removeClass(className),t.$currLi=$li.addClass(className),t.scrollIntoView($li)}},scrollIntoView:function($li){$li=$li||this.$currLi;var t=this,$listWrap=t.$listWrap,scrollTop=$listWrap.scrollTop(),height=$listWrap.height(),position=$li.position(),liHeight=$li.height(),posTop=position.top-scrollTop;0>posTop?$listWrap.scrollTop(scrollTop+posTop):posTop+liHeight>=height&&$listWrap.scrollTop(scrollTop+posTop+liHeight-height),clearTimeout(_enable_mouse_timer),_enable_mouse_timer=setTimeout(function(){_enable_mouse_hover=!0},200)},toggle:function(){var t=this;t[t.$listWrap.is(":hidden")?"showList":"hideList"]()},showList:function(){var t=this,o=t.config;if($.each(_obj_cache,function(i,obj){obj!=t&&obj.hideList()}),!t.disabled){t.$listWrap.css({zoom:1,width:"auto",height:"auto",top:"",bottom:""}).show();var $tmpDom=_isIe7||_isIe6?t.$ul:t.$listWrap,listWrapWidth=$tmpDom.outerWidth()>t.$dom.outerWidth()?"auto":t.$dom.outerWidth()-2,listWrapHeight=t.$listWrap.height();listWrapHeight=listWrapHeight>o.maxHeight+30?o.maxHeight:listWrapHeight,t.$listWrap.css({top:t.height+2,height:listWrapHeight<o.maxHeight?"auto":listWrapHeight,width:listWrapWidth,overflowY:"auto",overflowX:"hidden"}).show(),(_isIe7||_isIe6)&&"auto"==listWrapWidth&&t.$listWrap.width(t.$ul.outerWidth());var port=_getViewPort(),off=t.$wrap.offset(),h=listWrapHeight,$ul=t.$ul.css({position:"relative",bottom:0});off.top+h+t.height>port.top+port.height&&off.top-h>0?($ul.css({top:0,bottom:""}),t.$listWrap.css({top:"",bottom:t.height+2})):$ul.css({bottom:0,top:""}),t.$wrap.css({position:"relative"}),t.scrollIntoView(t.$selectLi),t.$wrap.addClass(o.openedClass).css("z-index",1)}},hideList:function(){var t=this,o=t.config,className=(t.$listWrap,_getViewPort(),t.$listWrap.offset(),t.$listWrap.height(),t.config.optHoverClass);t.$listWrap.hide(),t.$currLi&&t.$currLi.length&&t.$currLi.removeClass(className),t.$selectLi&&t.$selectLi.length&&t.$selectLi.addClass(className),t.$wrap.removeClass(o.openedClass).css("z-index",0)},isActive:function($li){return!(!$li.length||$li.attr("disabled")||$li.hasClass(this.config.groupClass))},next:function(){for(var t=this,$next=t.$currLi.next();$next.length&&!t.isActive($next);)$next=$next.next();t.mouseover($next)},prev:function(){for(var t=this,$prev=t.$currLi.prev();$prev.length&&!t.isActive($prev);)$prev=$prev.prev();t.mouseover($prev)}},$.fn.beautySelect=function(o){return $(this).each(function(i,select){_obj_cache.push(new SelectBeautify(select,o))}),this}}();