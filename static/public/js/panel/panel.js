/*! depei 2013-06-16 */
define(function(require,exports){"use strict";function PanelConfig(panelObj,o){var t=this;t.type="panel",t.content="",t.title=_e("Message Tip"),t.url="",t.mask=!0,t.style="default",t.className="",t.overClassName="",t.destroy=!1,t.useText=!1,t.closeAble=!0,t.submitButton=!1,t.cancelButton=!1,t.closeText=_e("close"),t.refreshText=_e("refresh"),t.submitText=_e("OK"),t.cancelText=_e("cancel"),t.onInit=null,t.onBeforeShow=null,t.onLoad=null,t.onShow=null,t.onFocus=null,t.onSubmit=null,t.onCancel=null,t.onClose=null,t.onReisze=null,t.onBeforeClose=null,t.width=-1,t.height=-1,t.iframeScrolling=!1,t.handleElement=null,t.iframe=!1,t.handleElementClassName="",t.paramsForChild={},LP.mix(this,o||{},!0),$.extend(t.handlersForChild,{setTitle:function(title){panelObj.setTitle(title)},close:function(seconds){panelObj.close(seconds)},resize:function(width,height){panelObj.resize(width,height)}}),"#"==t.url&&(t.url=""),t.width=parseInt(t.width),t.height=parseInt(t.height),o.hideHead&&(t.title=""),-1!=t.style.indexOf("text")&&(t.useText=!0),("alert"==t.type||"confirm"==t.type||"loading"==t.type)&&(t.mask=!0),("alert"==t.type||"confirm"==t.type)&&(t.submitButton=!0,"confirm"==t.type&&(t.cancelButton=!0))}var $=require("jquery");require("./panel.css");var isIE6=$.browser.msie&&$.browser.version<7,P={zIndex:3e6,panels:{},showCount:0,maskCount:0,onWinResize:function(){$.each(P.panels,function(id,panel){panel.isVisible!==!1&&panel.resize()})}},_getFullUrl=function(url){return url?url+(-1==url.indexOf("?")?"?":"&")+"_="+(+new Date+Math.random()):""},Panel=function(o){var t=this,o=o||{};t.id=o.id||LP.guid();var old=P.panels[t.id];if(old)return old;P.panels[t.id]=t,o=t.config=new PanelConfig(t,o),t._styleClassName=t.config.style?"lpn_panel_"+t.config.style:"",t.$panel=null,t.$wrapper=null,t.$head=null,t.$content=null,t.$foot=null,t.$loader=null,t.$btnGroup=null,t.$headerBtnGroup=null,t.$btnClose=null,t.iframeObj=null,t.isVisible=!1,t.loaded=!1,t.$panel=$('<div><span class="lpn_ghost"></span></div>').data("id",t.id),t.setMask(o.mask);var CName="lpn_panel";o.type&&(CName+=" lpn_panel_"+o.type),t._styleClassName&&(CName+=" "+t._styleClassName),o.className&&(CName+=" "+o.className);var topP=$('<div class="'+CName+'"></div>').appendTo(t.$panel);t.$wrapper=$('<div class="lpn_wrapper" id="'+t.id+'"></div>').appendTo(topP),t.$content=$('<div class="lpn_canvas"></div>').appendTo(t.$wrapper),t.setContent(o.content),t.setTitle(o.title),o.submitButton&&t.addSubmitButton(),o.cancelButton&&t.addCancelButton(),t.setCloseAble(o.closeAble),t.$panel.hide().appendTo("body"),o.onInit&&o.onInit.call(t)};Panel.prototype={setMask:function(showMask){var t=this;t.config.mask=showMask,showMask?t.$panel.addClass("lpn_mask").css(isIE6?{position:"absolute"}:{position:"fixed",top:0,left:0}):t.$panel.removeClass("lpn_mask")},setTitle:function(title){var t=this,o=t.config;return o.title=title,title?(t.createHead(),"object"==typeof title?(t.$head.replaceWith(title),t.$head=$(title)):t.$head.html(title)):t.$head&&(t.$head.remove(),t.$head=null),this},createHead:function(){!this.$head&&(this.$head=$('<div class="hd"></div>').insertBefore(this.$content))},createFoot:function(){!this.$foot&&(this.$foot=$('<div class="ft"></div>').insertAfter(this.$content))},createBtnGroup:function(){this.$btnGroup||(this.createFoot(),this.$btnGroup=$('<div class="lpn_button_group"></div>').appendTo(this.$foot))},addSubmitButton:function(){var t=this,o=t.config,handler=function(){return o.onSubmit&&o.onSubmit.call(t)===!1?!1:(t.close(0,"Submmited"),void 0)};return t.createBtnGroup(),$('<button class="lpn_submit" type="button"><span>'+o.submitText+"</span></button>").appendTo(t.$btnGroup).bind("click",handler).bind("keypress",function(e){13==e.keyCode&&handler()}),this},addCancelButton:function(){var t=this,o=t.config;return t.createBtnGroup(),$('<button type="button" class="lpn_cancel"><span>'+o.cancelText+"</span></button>").appendTo(t.$btnGroup).bind("click",function(){return o.onCancel&&o.onCancel.call(t)===!1?!1:(t.close("Canceled"),void 0)}),this},addHeaderButton:function(html,callback){var t=this,h=t.$headerBtnGroup;h||(t.$headerBtnGroup=h=$('<div class="lpn_ctrl_group"></div>').appendTo(t.$wrapper));var $btn=$(html).appendTo(h).bind("focus",function(){this.blur()});return callback&&$btn.bind("click",function(e){return callback.call(t,e),!1}),$btn},setCloseAble:function(bool,text){var t=this,o=t.config;return"boolean"==typeof bool&&(o.closeAble=bool),text&&(o.closeText=text),o.closeAble?(t.$btnClose=t.$btnClose||t.addHeaderButton('<a class="lpn_close" href="#">'+(o.useText&&o.closeText||"&nbsp;")+"</a>",function(){t.close()}),t.$btnClose.show()):t.$btnClose&&t.$btnClose.hide(),this},show:function(){var t=this,o=t.config;return t.isVisible?t:o.onBeforeShow&&o.onBeforeShow.call(t)===!1?t:(t.isVisible=!0,o.url&&(t.loaded=!1),t.loadContent(),-1!=o.width&&(t.$wrapper.width(o.width),t.$content.width(o.width)),-1!=o.height&&t.$content.height(o.height),$(".lpn_mask").addClass("lpn_mask_tr"),t.resize(-1==o.width?void 0:o.width,-1==o.height?void 0:o.height).$panel.css("z-index",P.zIndex).show().removeClass("lpn_mask_tr"),++P.zIndex,++P.showCount,o.mask&&++P.maskCount,1==P.showCount&&$(window).bind("resize",P.onWinResize),o.onShow&&o.onShow.call(t),t)},_closeTimer:null,close:function(seconds,status){var t=this;if(t._closeTimer&&(t._closeTimer.cancel(),t._closeTimer=null),!t.isVisible)return t;var o=t.config;status=status||"string"!=typeof seconds?status:seconds,seconds="number"==typeof seconds?parseInt(seconds):0;var hide=function(){if(t.isVisible&&(!o.onBeforeClose||o.onBeforeClose.call(t)===!1)){t.isVisible=!1,t.$panel.hide();for(var $panels=$(".lpn_mask"),i=$panels.length;i>=0;--i){var p=$panels.eq(i);if(p.is(":visible")){p.removeClass("lpn_mask_tr");break}}--P.showCount,1==P.showCount&&$(window).unbind("resize",P.onWinResize),o.mask&&(--P.maskCount,0==P.maskCount&&$("body").remove("lpn_masked")),o.handleElement&&o.overClassName&&o.handleElement.removeClass(o.overClassName),o.destroy&&t.$panel.remove(),o.onClose&&o.onClose.call(t,status)}};return 0==seconds?hide():t._closeTimer=setTimeout(hide,1e3*seconds),t},resize:function(dw,dh){var t=this,o=t.config,width=$(window).width(),height=$(window).height(),w=isIE6?Math.min(width,$(document.body).width()):width,h=isIE6?Math.min(height,$(document.body).height()):height;return t.$panel.css({width:w,height:h}),dw&&(o.width=dw,this.$wrapper.width(dw),this.$content.width(dw)),dh&&(o.height=dh,this.$content.height(dh)),t},setUrl:function(url,iframe){if(url){var t=this,o=t.config;o.url=url,o.content="",t.loaded=!1,"boolean"==typeof iframe&&(o.iframe=iframe),t.isVisible===!0&&t.loadContent()}return this},setContent:function(content){var t=this,o=t.config;if(content)if("string"==typeof content)o.content=content;else{var ct=$(content).get(0);o.content="object"==typeof ct?ct:null}return o.content&&(o.url=null,o.iframe=!1,t.loaded=!1,t.isVisible===!0&&t.loadContent()),this},showLoading:function(){return this.config.url&&(this.$loader=this.$loader||$('<div class="lpn_load">&nbsp;</div>').prependTo(this.$content),this.$loader.show()),this},hideLoading:function(){return this.$loader&&this.$loader.hide(),this},loadContent:function(){var t=this,o=t.config;return t.loaded?this:(t.loaded=!0,o.url&&"#"!=o.url||o.content||"loading"==o.type?o.url&&o.iframe?(t.resize(o.width||320,o.height||200),t.showLoading(),t.iframeObj?t.iframeObj.redirect(o.url):(t.iframeObj=GJ.createIframe({containerId:t.$content,url:o.url,scrolling:o.iframeScrolling,onLoad:function(){t.hideLoading(),t.iframeObj&&t.iframeObj.iframe&&$(t.iframeObj.iframe).css({position:"static",width:"100%",height:"100%"}).show(),"alert"!=o.type&&"confirm"!=o.type&&o.onLoad&&o.onLoad.call(t)},autoSetHeight:!1,useBrowseCache:!1,paramsForChild:o.paramsForChild,handlersForChild:o.handlersForChild}),$(t.iframeObj.iframe).hide()),this):(t.iframeObj&&(t.iframeObj.destroy(),t.iframeObj=null),o.url?(t.showLoading(),t.$content.load(_getFullUrl(o.url),null,function(){t.hideLoading()})):"string"==typeof o.content?t.$content.html(o.content):$(o.content).show().appendTo(t.$content.empty()),t.resize(),o.onload&&o.onload.call(t),this):(alert("No content or URL"),this))}},LP.mix(exports,{alert:function(content,type,time,o){var config,type,gid=LP.guid();"number"==typeof type?(o=time,time=type,type=void 0):"object"==typeof type?(o=type,type=void 0):"object"==typeof time&&(o=time,time=void 0),type=type||"infos_warn",time=void 0===time?4e3:parseInt(time),"number"!=typeof time&&(time=0);var config=$.extend({content:'<div class="systemInfos"><p class="infos '+type+'">'+content+"</p></div>",width:400,submitButton:!0,mask:!0,destroy:!0},o||{});time&&(config.title||(config.title=_e("Message Tip")),config.title+='<span style="margin-left:5px;color:#aaa;font-size:12px;">( '+_e('close after <em id="#[gid]">#[time]</em> seconds',{gid:gid,time:time/1e3})+" )</span>");var p=new Panel(config).show();if(time)var temp=time,_t=setInterval(function(){temp-=1e3,$("#"+gid).html(Math.max(temp,0)/1e3),0>=temp&&(clearInterval(_t),p.$panel.animate({opacity:0},200,"",function(){p.close()}))},1e3);return p},warn:function(content,time,o){this.alert(content,"infos_warn",time,o)},error:function(content,time,o){this.alert(content,"infos_error",time,o)},right:function(content,time,o){this.alert(content,"infos_correct",time,o)},confirm:function(content,onOk,onCancel,o){var config={content:'<div class="systemInfos"><p class="infos infos_question">'+content+"</p></div>",width:300,submitButton:!0,cancelButton:!0,onSubmit:onOk,mask:!0,destroy:!0,onCancel:onCancel};return LP.panel($.extend(config,o||{}))},panel:function(options){return options=LP.mix({destroy:!0},options),new Panel(options).show()}},!0)});